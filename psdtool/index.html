<!DOCTYPE html>
<html lang="ja">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PSDTool</title>
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
<link href="css/main.css" rel="stylesheet">

<body>
	<div id="file-open-ui" class="container">
		<div class="row">
			<div class="col-xs-12">
				<h1>
					PSDTool
					<small>Photoshop 形式のファイルを読み込む奴</small>
				</h1>
			</div>
		</div>
		<div id="error-report-ui" class="row">
			<div class="col-xs-12">
				<div id="error-message" class="alert alert-danger" role="alert"></div>
			</div>
		</div>
		<div class="row">
			<div class="col-sm-6">
				<div class="panel panel-default">
					<div class="panel-heading">
						<h2 class="panel-title">*.psd ファイルを選択して開く</h2>
					</div>
					<div class="panel-body">
						<div id="dropzone">
							<input type="file" id="inputfile" accept=".psd">
							<p>この辺にファイルをドロップして読み込むこともできます。</p>
						</div>
					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="panel panel-default">
					<div class="panel-heading">
						<h2 class="panel-title">サンプルファイルで試す</h2>
					</div>
					<div class="panel-body">
						<div id="try-sample">
							<img src="img/sample.png" width="140" height="240" class="psdtool-sampleimg img-thumbnail pull-left" alt="">
							<p>
								<button class="btn btn-default" id="samplefile" data-filename="im5467479.psd">サンプルファイルで試す</button>
							</p>
							<small>
								<p>
									このイラストは<a href="https://twitter.com/hrowl">水梟る</a>さんが投稿されている 「<a href="http://seiga.nicovideo.jp/seiga/im5467479">さとうささら立ち絵集5</a>」を 許可をいただいて PSDTool 用のサンプルファイルとして使用させて頂いています。
								</p>
								<p>
									<a href="http://seiga.nicovideo.jp/seiga/im5467479">ニコニコ静画で配布されている *.psd ファイル</a> は PSDTool が持つ <a href="#original-feature">独自拡張機能</a> のサンプルにもなっています。
								</p>
								<p>
									「<a href="http://satosasara.com/">さとうささら</a>」はトーク・ソング対応音声合成ソフトウェア「<a href="http://cevio.jp/">CeVIO Creative Studio</a>」のキャラクターです。
								</p>
							</small>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div id="file-loading-ui" class="container">
		<div class="progress">
			<div id="progress-bar" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
				<span class="psdtool-progress-bar-caption sr-only"></span>
			</div>
		</div>
		<div id="progress-caption"></div>
	</div>
	<div id="manual" class="container">
		<h1>説明書</h1>
		<h2>PSDTool とは？</h2>
		<img src="img/about.png" class="img-thumbnail" alt="PSDTool のスクリーンショット">
		<p>
			PSDTool は Photoshop 形式(*.psd) のファイルをブラウザで読み込んでレイヤーの表示／非表示を切り替えたり、合成された画像に名前を付けて保存したりできるツールです。
			<br>「ファイルを選択して開く」で読み込む画像はサーバーには一切送信されず完全にブラウザだけで処理されるため、プライベートな用途にも使用できます。
		</p>
		<p>
			このツールは「イラストを描く人がレイヤーの表示／非表示を切り替えた様々なパターンを PNG で書き出したものを配布する」といった時間の浪費と手間を減らすために、 また配布されているイラストを利用したい人がソフトウェアを何も用意しなくても最新のブラウザさえあれば *.psd ファイルを扱えるようにすることを目的に作りました。
		</p>
		<p>
			Photoshop 形式は sai、CLIP STUDIO PAINT、Krita、メディバンペイント、FireAlpaca など様々なペイントソフトで保存可能な共通の保存フォーマットです。
			<br>これを機に、是非 Photoshop 形式での配布を検討してみてください。
		</p>
		<h2>動作環境</h2>
		<p>
			Microsoft Edge / Google Chrome / Mozilla Firefox で動作確認しています。
			<br>Mac を持っていないので Apple Safari ではテストしていません。
		</p>
		<p>
			Microsoft Internet Explorer 11 でも基本的には動作しますが、対応しているレイヤーの合成モードの種類が少ないようです。
		</p>
		<p>
			ブラウザは常に最新版をお使いください。
		</p>
		<h2>機能の説明</h2>
		<p>ファイルを開くと画面の上部には以下の様なインターフェイスが現れます。</p>
		<p><img src="img/head.png" class="img-thumbnail" alt="PSDTool の画面上部にあるインターフェイス"></p>
		<dl>
			<dt>左右反転</dt>
			<dd>
				<p>
					画像を左右反転します。
					<br>画像内に文字やアクセサリー、髪型や服の装飾など反転すると問題がある場合もあるため、使用には注意が必要です。
				</p>
			</dd>
			<dt>縮小</dt>
			<dd>
				<p>
					読み込んだ画像が大きすぎる場合、ここで保存前に縮小することができます。
					<br>縦か横のどちらかの最大ピクセル数を指定すると、その大きさに合わせてサイズが決定されます。この設定によって元のサイズより画像が拡大されることはありません。
				</p>
			</dd>
			<dt>連番DL</dt>
			<dd>
				<p>
					画像を通し番号付きで保存するための機能です。
					<br>スクリーンショットのように入力欄がそれぞれ「file_」「0」の状態で「.png」ボタンを押すと、「file_0000.png」というファイル名で保存され、「0」が「1」に変わります。
				</p>
			</dd>
		</dl>
		<h2>読み込める *.psd ファイル</h2>
		<p>非対応の機能が色々あります。</p>
		<ul>
			<li>RGB カラー（8bit/チャンネル）以外には対応していません。</li>
			<li>
				レイヤーの合成モードは 通常、比較（暗）、乗算、焼き込みカラー、比較（明）、スクリーン、覆い焼きカラー、覆い焼き（リニア）、オーバーレイ、ソフトライト、ハードライト、差の絶対値、除外、色相、彩度、カラー、輝度 に対応しているはずです（動作未確認、ブラウザ側での実装に依存します）。
				<br>ただし「覆い焼き（リニア）」など特定の合成モードは JavaScript による実装のため処理速度が遅いです。
			</li>
			<li>テキストレイヤー、調整レイヤー、シェイプレイヤーなどには対応していません。</li>
		</ul>
		<h2 id="original-feature">独自機能</h2>
		<p>
			レイヤー名の先頭に特定の記号を付けることで、レイヤーの表示／非表示の使い勝手を改善することができます。
			<br>これらの機能を使用しても画像編集ソフトで開く際には今まで通り使用でき、編集が不便になることはありません。
		</p>
		<h3>アスタリスク「*」</h3>
		<p><img src="img/asterisk.png" class="img-rounded" alt="アスタリスクの使用例"></p>
		<p>
			レイヤー名の先頭に半角のアスタリスク「*」をつけると、選択項目がチェックボックスでははなくラジオボタンになります。
			<br>ラジオボタンは親のグループレイヤー（画像例では「口」）に所属するようになります。
		</p>
		<ul>
			<li>グループ内でひとつのみ選択できるため、二種類の表情が同時に表示されたりするのを防ぐことができます。</li>
			<li>項目を選択すると前に選択されていた項目の選択解除も行われるため、切り替えのクリック数が半分で済みます。</li>
			<li>ラジオボタンは選択解除できませんが、親のグループレイヤーで非表示にもできます。</li>
		</ul>
		<p>
			ラジオボタン内のレイヤーが複数表示されたまま *.psd ファイルが保存されていた場合、その中で一番上のものがデフォルト表示されます。
		</p>
		<h3>エクスクラメーションマーク「!」</h3>
		<p><img src="img/exclamation.png" class="img-rounded" alt="エクスクラメーションマークの使用例"></p>
		<p>
			レイヤー名の先頭に半角のエクスクラメーションマーク「!」をつけると、選択項目からチェックボックスが消えます。
			<br>チェックボックスがない項目は表示状態になり、非表示にできなくなります。
		</p>
		<ul>
			<li>必須のパーツが外れるのを防ぐことができます。</li>
			<li>選択項目を減らせるので、使う時に迷う要素を画面から減らすことができます。</li>
		</ul>
		<p>
			強制表示設定にしたレイヤーを非表示にして *.psd ファイルを保存しても、強制的に表示状態になります。
		</p>
		<h2>変更履歴</h2>
		<dl>
			<dt>2016-02-02</dt>
			<dd>操作性の改善</dd>
			<dt>2016-02-01</dt>
			<dd>描画負荷の軽減</dd>
			<dd>縮小処理中にUIが硬直しないように</dd>
			<dt>2016-01-29</dt>
			<dd>透過領域でアニメーション</dd>
			<dd>縮小機能を追加</dd>
			<dd>連番ダウンロード機能を追加</dd>
			<dd>バグ修正</dd>
			<dt>2016-01-28</dt>
			<dd>合成モード「覆い焼き（リニア）」に対応</dd>
			<dd>レイヤーマスク、ベクトルマスクに対応</dd>
			<dd>バグ修正</dd>
			<dt>2016-01-26</dt>
			<dd>クリッピングマスクに対応</dd>
			<dd>読み込み状況の進捗表示</dd>
			<dd>バグ修正</dd>
			<dt>2016-01-22</dt>
			<dd>初版</dd>
		</dl>

		<div class="well text-center">
			<small>
				Created by <a href="https://github.com/oov/psdtool" target="_blank">oov</a> | Powered by <a href="http://www.gopherjs.org/" target="_blank">GopherJS</a> | Please use a <a href="https://whatbrowser.org/" target="_blank">modern browser</a> | Please listen to <a href="https://www.youtube.com/watch?v=SldjqJz3thA" target="_blank">my song</a>
			</small>
		</div>
	</div>
	<div id="main">
		<div id="side-container">
			<ul id="layer-tree"></ul>
		</div>
		<div id="main-container">
			<div id="misc-ui" class="container-fluid">
				<div class="row">
					<div class="col-sm-3 col-md-2">
						<label for="invert-input">
							<input id="invert-input" type="checkbox"> 左右反転
						</label>
					</div>
					<div class="col-sm-6 col-md-4">
						<div class="form-inline">
							<div class="form-group">
								<label for="fixed-side">縮小</label>
								<select class="form-control" id="fixed-side">
									<option value="h" selected="selected">縦</option>
									<option value="w">横</option>
								</select>
								<label class="sr-only" for="max-size">サイズ</label>
								<div class="input-group">
									<div class="input-group-addon">最大</div>
									<input type="text" class="form-control" id="max-pixels" inputmode="numeric" value="1200">
									<div class="input-group-addon">px</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-sm-12 col-md-6">
						<div class="form-inline">
							<div class="form-group">
								<label for="seq-dl-prefix">連番DL</label>
								<input id="seq-dl-prefix" type="text" class="form-control" value="file_">
								<label class="sr-only" for="seq-dl-num">番号</label>
								<input type="number" class="form-control" id="seq-dl-num" inputmode="numeric" value="0">
								<button id="seq-dl" class="btn btn-primary">.png</button>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div id="preview-container"></div>
		</div>
	</div>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/mithril/0.2.2-rc.1/mithril.min.js"></script>
	<script src="js/FileSaver.min.js"></script>
	<script src="js/psdtool.js"></script>
	<script src="js/main.js"></script>
</body>

</html>

!function e(t,i,n){function r(o,s){if(!i[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var d=i[o]={exports:{}};t[o][0].call(d.exports,function(e){var i=t[o][1][e];return r(i?i:e)},d,d.exports,e,t,i,n)}return i[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(e,t,i){(function(n,r){!function(e,n){"object"==typeof i&&"undefined"!=typeof t?t.exports=n():"function"==typeof define&&define.amd?define(n):e.ES6Promise=n()}(this,function(){"use strict";function t(e){return"function"==typeof e||"object"==typeof e&&null!==e}function i(e){return"function"==typeof e}function a(e){G=e}function o(e){K=e}function s(){return function(){return n.nextTick(u)}}function l(){return"undefined"!=typeof Y?function(){Y(u)}:h()}function c(){var e=0,t=new $(u),i=document.createTextNode("");return t.observe(i,{characterData:!0}),function(){i.data=e=++e%2}}function d(){var e=new MessageChannel;return e.port1.onmessage=u,function(){return e.port2.postMessage(0)}}function h(){var e=setTimeout;return function(){return e(u,1)}}function u(){for(var e=0;X>e;e+=2){var t=ie[e],i=ie[e+1];t(i),ie[e]=void 0,ie[e+1]=void 0}X=0}function f(){try{var t=e,i=t("vertx");return Y=i.runOnLoop||i.runOnContext,l()}catch(n){return h()}}function p(e,t){var i=arguments,n=this,r=new this.constructor(m);void 0===r[re]&&R(r);var a=n._state;return a?!function(){var e=i[a-1];K(function(){return j(a,r,e,n._result)})}():_(n,r,e,t),r}function v(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var i=new t(m);return A(i,e),i}function m(){}function g(){return new TypeError("You cannot resolve a promise with itself")}function w(){return new TypeError("A promises callback cannot return that same promise.")}function y(e){try{return e.then}catch(t){return le.error=t,le}}function b(e,t,i,n){try{e.call(t,i,n)}catch(r){return r}}function x(e,t,i){K(function(e){var n=!1,r=b(i,t,function(i){n||(n=!0,t!==i?A(e,i):L(e,i))},function(t){n||(n=!0,C(e,t))},"Settle: "+(e._label||" unknown promise"));!n&&r&&(n=!0,C(e,r))},e)}function k(e,t){t._state===oe?L(e,t._result):t._state===se?C(e,t._result):_(t,void 0,function(t){return A(e,t)},function(t){return C(e,t)})}function S(e,t,n){t.constructor===e.constructor&&n===p&&t.constructor.resolve===v?k(e,t):n===le?C(e,le.error):void 0===n?L(e,t):i(n)?x(e,t,n):L(e,t)}function A(e,i){e===i?C(e,g()):t(i)?S(e,i,y(i)):L(e,i)}function E(e){e._onerror&&e._onerror(e._result),T(e)}function L(e,t){e._state===ae&&(e._result=t,e._state=oe,0!==e._subscribers.length&&K(T,e))}function C(e,t){e._state===ae&&(e._state=se,e._result=t,K(E,e))}function _(e,t,i,n){var r=e._subscribers,a=r.length;e._onerror=null,r[a]=t,r[a+oe]=i,r[a+se]=n,0===a&&e._state&&K(T,e)}function T(e){var t=e._subscribers,i=e._state;if(0!==t.length){for(var n=void 0,r=void 0,a=e._result,o=0;o<t.length;o+=3)n=t[o],r=t[o+i],n?j(i,n,r,a):r(a);e._subscribers.length=0}}function M(){this.error=null}function U(e,t){try{return e(t)}catch(i){return ce.error=i,ce}}function j(e,t,n,r){var a=i(n),o=void 0,s=void 0,l=void 0,c=void 0;if(a){if(o=U(n,r),o===ce?(c=!0,s=o.error,o=null):l=!0,t===o)return void C(t,w())}else o=r,l=!0;t._state!==ae||(a&&l?A(t,o):c?C(t,s):e===oe?L(t,o):e===se&&C(t,o))}function z(e,t){try{t(function(t){A(e,t)},function(t){C(e,t)})}catch(i){C(e,i)}}function F(){return de++}function R(e){e[re]=de++,e._state=void 0,e._result=void 0,e._subscribers=[]}function D(e,t){this._instanceConstructor=e,this.promise=new e(m),this.promise[re]||R(this.promise),V(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?L(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&L(this.promise,this._result))):C(this.promise,I())}function I(){return new Error("Array Methods must be provided an Array")}function N(e){return new D(this,e).promise}function B(e){var t=this;return new t(V(e)?function(i,n){for(var r=e.length,a=0;r>a;a++)t.resolve(e[a]).then(i,n)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function H(e){var t=this,i=new t(m);return C(i,e),i}function P(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function O(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function q(e){this[re]=F(),this._result=this._state=void 0,this._subscribers=[],m!==e&&("function"!=typeof e&&P(),this instanceof q?z(this,e):O())}function Z(){var e=void 0;if("undefined"!=typeof r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var i=e.Promise;if(i){var n=null;try{n=Object.prototype.toString.call(i.resolve())}catch(t){}if("[object Promise]"===n&&!i.cast)return}e.Promise=q}var W=void 0;W=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var V=W,X=0,Y=void 0,G=void 0,K=function(e,t){ie[X]=e,ie[X+1]=t,X+=2,2===X&&(G?G(u):ne())},J="undefined"!=typeof window?window:void 0,Q=J||{},$=Q.MutationObserver||Q.WebKitMutationObserver,ee="undefined"==typeof self&&"undefined"!=typeof n&&"[object process]"==={}.toString.call(n),te="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,ie=new Array(1e3),ne=void 0;ne=ee?s():$?c():te?d():void 0===J&&"function"==typeof e?f():h();var re=Math.random().toString(36).substring(16),ae=void 0,oe=1,se=2,le=new M,ce=new M,de=0;return D.prototype._enumerate=function(){for(var e=this.length,t=this._input,i=0;this._state===ae&&e>i;i++)this._eachEntry(t[i],i)},D.prototype._eachEntry=function(e,t){var i=this._instanceConstructor,n=i.resolve;if(n===v){var r=y(e);if(r===p&&e._state!==ae)this._settledAt(e._state,t,e._result);else if("function"!=typeof r)this._remaining--,this._result[t]=e;else if(i===q){var a=new i(m);S(a,e,r),this._willSettleAt(a,t)}else this._willSettleAt(new i(function(t){return t(e)}),t)}else this._willSettleAt(n(e),t)},D.prototype._settledAt=function(e,t,i){var n=this.promise;n._state===ae&&(this._remaining--,e===se?C(n,i):this._result[t]=i),0===this._remaining&&L(n,this._result)},D.prototype._willSettleAt=function(e,t){var i=this;_(e,void 0,function(e){return i._settledAt(oe,t,e)},function(e){return i._settledAt(se,t,e)})},q.all=N,q.race=B,q.resolve=v,q.reject=H,q._setScheduler=a,q._setAsap=o,q._asap=K,q.prototype={constructor:q,then:p,"catch":function(e){return this.then(null,e)}},q.polyfill=Z,q.Promise=q,q})}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:2}],2:[function(e,t,i){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function a(e){if(h===setTimeout)return setTimeout(e,0);if((h===n||!h)&&setTimeout)return h=setTimeout,setTimeout(e,0);try{return h(e,0)}catch(t){try{return h.call(null,e,0)}catch(t){return h.call(this,e,0)}}}function o(e){if(u===clearTimeout)return clearTimeout(e);if((u===r||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(e);try{return u(e)}catch(t){try{return u.call(null,e)}catch(t){return u.call(this,e)}}}function s(){m&&p&&(m=!1,p.length?v=p.concat(v):g=-1,v.length&&l())}function l(){if(!m){var e=a(s);m=!0;for(var t=v.length;t;){for(p=v,v=[];++g<t;)p&&p[g].run();g=-1,t=v.length}p=null,m=!1,o(e)}}function c(e,t){this.fun=e,this.array=t}function d(){}var h,u,f=t.exports={};!function(){try{h="function"==typeof setTimeout?setTimeout:n}catch(e){h=n}try{u="function"==typeof clearTimeout?clearTimeout:r}catch(e){u=r}}();var p,v=[],m=!1,g=-1;f.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];v.push(new c(e,t)),1!==v.length||m||a(l)},c.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=d,f.addListener=d,f.once=d,f.off=d,f.removeListener=d,f.removeAllListeners=d,f.emit=d,f.binding=function(e){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(e){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},{}],3:[function(e,t,i){"use strict";function n(e,t,i){return 77*e+151*t+28*i>>8}function r(e,t,i,r){return r-=n(e,t,i),a(e+r,t+r,i+r)}function a(e,t,i){var r=n(e,t,i),a=Math.min(e,t,i),o=Math.max(e,t,i);return 0>a&&(e=r+(e-r)*r/(r-a),t=r+(t-r)*r/(r-a),i=r+(i-r)*r/(r-a)),o>255&&(e=r+(e-r)*(255-r)/(o-r),t=r+(t-r)*(255-r)/(o-r),i=r+(i-r)*(255-r)/(o-r)),e<<16|t<<8|i}function o(e,t,i){return Math.max(e,t,i)-Math.min(e,t,i)}function s(e,t,i,n){return t>=e?i>=t?l(e,t,i,n):i>=e?(n=l(e,i,t,n),16711680&n|(255&n)<<8|(65280&n)>>8):(n=l(i,e,t,n),(65535&n)<<8|(16711680&n)>>16):i>=e?(n=l(t,e,i,n),(65280&n)<<8|(16711680&n)>>8|255&n):i>=t?(n=l(t,i,e,n),(255&n)<<16|(16776960&n)>>8):(n=l(i,t,e,n),(255&n)<<16|65280&n|(16711680&n)>>16)}function l(e,t,i,n){return i>e?(t-e)*n/(i-e)<<8|n:0}function c(e,t,i,n,r){for(var a=0,o=i*n<<2;o>a;a+=4)e[a+3]=t[a+3]*r}function d(e,t,i,n,r){for(var a=255*r,o=0,s=i*n<<2;s>o;o+=4)e[o+0]=t[o+0],e[o+1]=t[o+1],e[o+2]=t[o+2],e[o+3]=a}function h(e,t,i,n,r){for(var a=0,o=i*n<<2;o>a;a+=4)e[a+0]=t[a+0],e[a+1]=t[a+1],e[a+2]=t[a+2],e[a+3]=t[a+3]}function u(e,t,i,n,r){for(var a,o,s,l,c,d,h,u,f,p,v,m,g,w,y,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],c=e[x],d=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,v=(8388735-b)*u>>23,y=f+p+v,e[x+3]=y,y&&(m=a,g=o,w=s,e[x]=(m*f+a*p+c*v)/y,e[x+1]=(g*f+o*p+d*v)/y,e[x+2]=(w*f+s*p+h*v)/y)}function f(e,t,i,n,r){for(var a,o,s,l,c,d,h,u,f,p,v,m,g,w,y,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],c=e[x],d=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,v=(8388735-b)*u>>23,y=f+p+v,e[x+3]=y,y&&(m=c>a?a:c,g=d>o?o:d,w=h>s?s:h,e[x]=(m*f+a*p+c*v)/y,e[x+1]=(g*f+o*p+d*v)/y,e[x+2]=(w*f+s*p+h*v)/y)}function p(e,t,i,n,r){for(var a,o,s,l,c,d,h,u,f,p,v,m,g,w,y,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],c=e[x],d=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,v=(8388735-b)*u>>23,y=f+p+v,e[x+3]=y,y&&(m=a*c*32897>>23,g=o*d*32897>>23,w=s*h*32897>>23,e[x]=(m*f+a*p+c*v)/y,e[x+1]=(g*f+o*p+d*v)/y,e[x+2]=(w*f+s*p+h*v)/y)}function v(e,t,i,n,r){for(var a,o,s,l,c,d,h,u,f,p,v,m,g,w,y,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],c=e[x],d=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,v=(8388735-b)*u>>23,y=f+p+v,e[x+3]=y,y&&(m=255===c?255:0===a?0:255-Math.min(255,(255-c)/a*255),g=255===d?255:0===o?0:255-Math.min(255,(255-d)/o*255),w=255===h?255:0===s?0:255-Math.min(255,(255-h)/s*255),e[x]=(m*f+a*p+c*v)/y,e[x+1]=(g*f+o*p+d*v)/y,e[x+2]=(w*f+s*p+h*v)/y)}function m(e,t,i,n,r){for(var a,o,s,l,c,d,h,u,f,p,v,m,g,w,y,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],c=e[x],d=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,v=(8388735-b)*u>>23,y=f+p+v,e[x+3]=y,y&&(m=Math.max(0,c+a-255),g=Math.max(0,d+o-255),w=Math.max(0,h+s-255),e[x]=(m*f+a*p+c*v)/y,e[x+1]=(g*f+o*p+d*v)/y,e[x+2]=(w*f+s*p+h*v)/y)}function g(e,t,i,r,a){for(var o,s,l,c,d,h,u,f,p,v,m,g,w,y,b,x,k=0,S=i*r<<2;S>k;k+=4)o=t[k],s=t[k+1],l=t[k+2],c=t[k+3],d=e[k],h=e[k+1],u=e[k+2],f=e[k+3],x=0|c*a*32897,p=x*f>>23,v=x*(255-f)>>23,m=(8388735-x)*f>>23,b=p+v+m,e[k+3]=b,b&&(n(o,s,l)<n(d,h,u)?(g=o,w=s,y=l):(g=d,w=h,y=u),e[k]=(g*p+o*v+d*m)/b,e[k+1]=(w*p+s*v+h*m)/b,e[k+2]=(y*p+l*v+u*m)/b)}function w(e,t,i,n,r){for(var a,o,s,l,c,d,h,u,f,p,v,m,g,w,y,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],c=e[x],d=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,v=(8388735-b)*u>>23,y=f+p+v,e[x+3]=y,y&&(m=a>c?a:c,g=o>d?o:d,w=s>h?s:h,e[x]=(m*f+a*p+c*v)/y,e[x+1]=(g*f+o*p+d*v)/y,e[x+2]=(w*f+s*p+h*v)/y)}function y(e,t,i,n,r){for(var a,o,s,l,c,d,h,u,f,p,v,m,g,w,y,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],c=e[x],d=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,v=(8388735-b)*u>>23,y=f+p+v,e[x+3]=y,y&&(m=a+c-(a*c*32897>>23),g=o+d-(o*d*32897>>23),w=s+h-(s*h*32897>>23),e[x]=(m*f+a*p+c*v)/y,e[x+1]=(g*f+o*p+d*v)/y,e[x+2]=(w*f+s*p+h*v)/y)}function b(e,t,i,n,r){for(var a,o,s,l,c,d,h,u,f,p,v,m,g,w,y,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],c=e[x],d=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,v=(8388735-b)*u>>23,y=f+p+v,e[x+3]=y,y&&(m=0===c?0:255===a?255:Math.min(255,255*c/(255-a)),g=0===d?0:255===o?255:Math.min(255,255*d/(255-o)),w=0===h?0:255===s?255:Math.min(255,255*h/(255-s)),e[x]=(m*f+a*p+c*v)/y,e[x+1]=(g*f+o*p+d*v)/y,e[x+2]=(w*f+s*p+h*v)/y)}function x(e,t,i,n,r){for(var a,o,s,l,c,d,h,u,f,p,v,m,g,w,y,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],c=e[x],d=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,v=(8388735-b)*u>>23,y=f+p+v,e[x+3]=y,y&&(m=a+c,g=o+d,w=s+h,e[x]=(m*f+a*p+c*v)/y,e[x+1]=(g*f+o*p+d*v)/y,e[x+2]=(w*f+s*p+h*v)/y)}function k(e,t,i,r,a){for(var o,s,l,c,d,h,u,f,p,v,m,g,w,y,b,x,k=0,S=i*r<<2;S>k;k+=4)o=t[k],s=t[k+1],l=t[k+2],c=t[k+3],d=e[k],h=e[k+1],u=e[k+2],f=e[k+3],x=0|c*a*32897,p=x*f>>23,v=x*(255-f)>>23,m=(8388735-x)*f>>23,b=p+v+m,e[k+3]=b,b&&(n(o,s,l)>n(d,h,u)?(g=o,w=s,y=l):(g=d,w=h,y=u),e[k]=(g*p+o*v+d*m)/b,e[k+1]=(w*p+s*v+h*m)/b,e[k+2]=(y*p+l*v+u*m)/b)}function S(e,t,i,n,r){for(var a,o,s,l,c,d,h,u,f,p,v,m,g,w,y,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],c=e[x],d=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,v=(8388735-b)*u>>23,y=f+p+v,e[x+3]=y,y&&(m=128>c?a*c*32897>>22:255-((255-(c-128<<1))*(255-a)*32897>>23),g=128>d?o*d*32897>>22:255-((255-(d-128<<1))*(255-o)*32897>>23),w=128>h?s*h*32897>>22:255-((255-(h-128<<1))*(255-s)*32897>>23),e[x]=(m*f+a*p+c*v)/y,e[x+1]=(g*f+o*p+d*v)/y,e[x+2]=(w*f+s*p+h*v)/y)}function A(e,t,i,n,r){for(var a,o,s,l,c,d,h,u,f,p,v,m,g,w,y,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],c=e[x],d=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,v=(8388735-b)*u>>23,y=f+p+v,e[x+3]=y,y&&(128>a?m=c-(((255-(a<<1))*c*32897>>23)*(255-c)*32897>>23):(b=64>c?((32897*((c<<4)-3060)>>23)*c+1020)*c*32897>>23:255*Math.sqrt(c/255),m=c+(((a<<1)-255)*(b-c)*32897>>23)),128>o?g=d-(((255-(o<<1))*d*32897>>23)*(255-d)*32897>>23):(b=64>d?((32897*((d<<4)-3060)>>23)*d+1020)*d*32897>>23:255*Math.sqrt(d/255),g=d+(((o<<1)-255)*(b-d)*32897>>23)),128>s?w=h-(((255-(s<<1))*h*32897>>23)*(255-h)*32897>>23):(b=64>h?((32897*((h<<4)-3060)>>23)*h+1020)*h*32897>>23:255*Math.sqrt(h/255),w=h+(((s<<1)-255)*(b-h)*32897>>23)),e[x]=(m*f+a*p+c*v)/y,e[x+1]=(g*f+o*p+d*v)/y,e[x+2]=(w*f+s*p+h*v)/y)}function E(e,t,i,n,r){for(var a,o,s,l,c,d,h,u,f,p,v,m,g,w,y,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],c=e[x],d=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,v=(8388735-b)*u>>23,y=f+p+v,e[x+3]=y,y&&(128>a?m=c*a*32897>>22:(b=(a<<1)-255,m=c+b-(c*b*32897>>23)),128>o?g=d*o*32897>>22:(b=(o<<1)-255,g=d+b-(d*b*32897>>23)),128>s?w=h*s*32897>>22:(b=(s<<1)-255,w=h+b-(h*b*32897>>23)),e[x]=(m*f+a*p+c*v)/y,e[x+1]=(g*f+o*p+d*v)/y,e[x+2]=(w*f+s*p+h*v)/y)}function L(e,t,i,n,r){for(var a,o,s,l,c,d,h,u,f,p,v,m,g,w,y,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],c=e[x],d=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,v=(8388735-b)*u>>23,y=f+p+v,e[x+3]=y,y&&(128>a?(b=a<<1,m=0===a?b:Math.max(0,255-255*(255-c)/b)):(b=(a-128<<1)+1,m=255===b?b:Math.min(255,255*c/(255-b))),128>o?(b=o<<1,g=0===o?b:Math.max(0,255-255*(255-d)/b)):(b=(o-128<<1)+1,g=255===b?b:Math.min(255,255*d/(255-b))),128>s?(b=s<<1,w=0===s?b:Math.max(0,255-255*(255-h)/b)):(b=(s-128<<1)+1,w=255===b?b:Math.min(255,255*h/(255-b))),e[x]=(m*f+a*p+c*v)/y,e[x+1]=(g*f+o*p+d*v)/y,e[x+2]=(w*f+s*p+h*v)/y)}function C(e,t,i,n,r){for(var a,o,s,l,c,d,h,u,f,p,v,m,g,w,y,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],c=e[x],d=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,v=(8388735-b)*u>>23,y=f+p+v,e[x+3]=y,y&&(m=128>a?c+(a<<1)-255:c+(a-128<<1),g=128>o?d+(o<<1)-255:d+(o-128<<1),w=128>s?h+(s<<1)-255:h+(s-128<<1),e[x]=(m*f+a*p+c*v)/y,e[x+1]=(g*f+o*p+d*v)/y,e[x+2]=(w*f+s*p+h*v)/y)}function _(e,t,i,n,r){for(var a,o,s,l,c,d,h,u,f,p,v,m,g,w,y,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],c=e[x],d=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,v=(8388735-b)*u>>23,y=f+p+v,e[x+3]=y,y&&(128>a?(b=a<<1,m=c>b?b:c):(b=a-128<<1,m=b>c?b:c),128>o?(b=o<<1,g=d>b?b:d):(b=o-128<<1,g=b>d?b:d),128>s?(b=s<<1,w=h>b?b:h):(b=s-128<<1,w=b>h?b:h),e[x]=(m*f+a*p+c*v)/y,e[x+1]=(g*f+o*p+d*v)/y,e[x+2]=(w*f+s*p+h*v)/y)}function T(e,t,i,n,r){for(var a,o,s,l,c,d,h,u,f,p,v,m,g,w,y,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],c=e[x],d=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,v=(8388735-b)*u>>23,y=f+p+v,e[x+3]=y,y&&(128>a?(b=a<<1,0!==a&&(b=Math.max(0,255-255*(255-c)/b))):0===c?b=0:(b=(a-128<<1)+1,255!==b&&(b=Math.min(255,255*c/(255-b)))),m=128>b?0:255,128>o?(b=o<<1,0!==o&&(b=Math.max(0,255-255*(255-d)/b))):0===d?b=0:(b=(o-128<<1)+1,255!==b&&(b=Math.min(255,255*d/(255-b)))),g=128>b?0:255,128>s?(b=s<<1,0!==s&&(b=Math.max(0,255-255*(255-h)/b))):0===h?b=0:(b=(s-128<<1)+1,255!==b&&(b=Math.min(255,255*h/(255-b)))),w=128>b?0:255,e[x]=(m*f+a*p+c*v)/y,e[x+1]=(g*f+o*p+d*v)/y,e[x+2]=(w*f+s*p+h*v)/y)}function M(e,t,i,n,r){for(var a,o,s,l,c,d,h,u,f,p,v,m,g,w,y,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],c=e[x],d=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,v=(8388735-b)*u>>23,y=f+p+v,e[x+3]=y,y&&(b=c-a,m=0>b?-b:b,b=d-o,g=0>b?-b:b,b=h-s,w=0>b?-b:b,e[x]=(m*f+a*p+c*v)/y,e[x+1]=(g*f+o*p+d*v)/y,e[x+2]=(w*f+s*p+h*v)/y)}function U(e,t,i,n,r){for(var a,o,s,l,c,d,h,u,f,p,v,m,g,w,y,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],c=e[x],d=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,v=(8388735-b)*u>>23,y=f+p+v,e[x+3]=y,y&&(m=c+a-(c*a*32897>>22),g=d+o-(d*o*32897>>22),w=h+s-(h*s*32897>>22),e[x]=(m*f+a*p+c*v)/y,e[x+1]=(g*f+o*p+d*v)/y,e[x+2]=(w*f+s*p+h*v)/y)}function j(e,t,i,n,r){for(var a,o,s,l,c,d,h,u,f,p,v,m,g,w,y,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],c=e[x],d=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,v=(8388735-b)*u>>23,y=f+p+v,e[x+3]=y,y&&(m=Math.max(0,c-a),g=Math.max(0,d-o),w=Math.max(0,h-s),e[x]=(m*f+a*p+c*v)/y,e[x+1]=(g*f+o*p+d*v)/y,e[x+2]=(w*f+s*p+h*v)/y)}function z(e,t,i,n,r){for(var a,o,s,l,c,d,h,u,f,p,v,m,g,w,y,b,x=0,k=i*n<<2;k>x;x+=4)a=t[x],o=t[x+1],s=t[x+2],l=t[x+3],c=e[x],d=e[x+1],h=e[x+2],u=e[x+3],b=0|l*r*32897,f=b*u>>23,p=b*(255-u)>>23,v=(8388735-b)*u>>23,y=f+p+v,e[x+3]=y,y&&(m=0===c?0:0===a?255:Math.min(255,c/a*255),g=0===d?0:0===o?255:Math.min(255,d/o*255),w=0===h?0:0===s?255:Math.min(255,h/s*255),e[x]=(m*f+a*p+c*v)/y,e[x+1]=(g*f+o*p+d*v)/y,e[x+2]=(w*f+s*p+h*v)/y)}function F(e,t,i,a,l){for(var c,d,h,u,f,p,v,m,g,w,y,b,x,k,S,A,E=0,L=i*a<<2;L>E;E+=4)c=t[E],d=t[E+1],h=t[E+2],u=t[E+3],f=e[E],p=e[E+1],v=e[E+2],m=e[E+3],A=0|u*l*32897,g=A*m>>23,w=A*(255-m)>>23,y=(8388735-A)*m>>23,S=g+w+y,e[E+3]=S,S&&(A=s(c,d,h,o(f,p,v)),b=(16711680&A)>>16,x=(65280&A)>>8,k=255&A,A=r(b,x,k,n(f,p,v)),b=(16711680&A)>>16,x=(65280&A)>>8,k=255&A,e[E]=(b*g+c*w+f*y)/S,e[E+1]=(x*g+d*w+p*y)/S,e[E+2]=(k*g+h*w+v*y)/S)}function R(e,t,i,a,l){for(var c,d,h,u,f,p,v,m,g,w,y,b,x,k,S,A,E=0,L=i*a<<2;L>E;E+=4)c=t[E],d=t[E+1],h=t[E+2],u=t[E+3],f=e[E],p=e[E+1],v=e[E+2],m=e[E+3],A=0|u*l*32897,g=A*m>>23,w=A*(255-m)>>23,y=(8388735-A)*m>>23,S=g+w+y,e[E+3]=S,S&&(A=s(f,p,v,o(c,d,h)),b=(16711680&A)>>16,x=(65280&A)>>8,k=255&A,A=r(b,x,k,n(f,p,v)),b=(16711680&A)>>16,x=(65280&A)>>8,k=255&A,e[E]=(b*g+c*w+f*y)/S,e[E+1]=(x*g+d*w+p*y)/S,e[E+2]=(k*g+h*w+v*y)/S)}function D(e,t,i,a,o){for(var s,l,c,d,h,u,f,p,v,m,g,w,y,b,x,k,S=0,A=i*a<<2;A>S;S+=4)s=t[S],l=t[S+1],c=t[S+2],d=t[S+3],h=e[S],u=e[S+1],f=e[S+2],p=e[S+3],k=0|d*o*32897,v=k*p>>23,m=k*(255-p)>>23,g=(8388735-k)*p>>23,x=v+m+g,e[S+3]=x,x&&(k=r(s,l,c,n(h,u,f)),w=(16711680&k)>>16,y=(65280&k)>>8,b=255&k,e[S]=(w*v+s*m+h*g)/x,e[S+1]=(y*v+l*m+u*g)/x,e[S+2]=(b*v+c*m+f*g)/x)}function I(e,t,i,a,o){for(var s,l,c,d,h,u,f,p,v,m,g,w,y,b,x,k,S=0,A=i*a<<2;A>S;S+=4)s=t[S],l=t[S+1],c=t[S+2],d=t[S+3],h=e[S],u=e[S+1],f=e[S+2],p=e[S+3],k=0|d*o*32897,v=k*p>>23,m=k*(255-p)>>23,g=(8388735-k)*p>>23,x=v+m+g,e[S+3]=x,x&&(k=r(h,u,f,n(s,l,c)),w=(16711680&k)>>16,y=(65280&k)>>8,b=255&k,e[S]=(w*v+s*m+h*g)/x,e[S+1]=(y*v+l*m+u*g)/x,e[S+2]=(b*v+c*m+f*g)/x)}function N(e,t,i,n,r,a,o,s){if("normal"===s&&(s="source-over"),s in O)return e.save(),e.globalAlpha=o,e.globalCompositeOperation=s,e.drawImage(t.canvas,i,n),void e.restore();var l=0,c=0;if(!(i>=e.canvas.width||n>=e.canvas.height||0>i+r||0>n+a||0===o)){r>t.canvas.width&&(r=t.canvas.width),a>t.canvas.height&&(a=t.canvas.height),0>i&&(r+=i,l-=i,i=0),0>n&&(a+=n,c-=n,n=0),i+r>e.canvas.width&&(r=e.canvas.width-i),n+a>e.canvas.height&&(a=e.canvas.height-n);var d=e.getImageData(i,n,r,a),h=d.data,u=t.getImageData(l,c,r,a).data;if(!(s in P))throw new Error("unimplemeneted blend mode: "+s);P[s](h,u,r,a,o),e.putImageData(d,i,n)}}function B(){var e={},t=document.createElement("canvas"),i=t.getContext("2d");if(!i)throw new Error("cannot get CanvasRenderingContext2D");for(var n=0,r=Object.keys(P);n<r.length;n++){var a=r[n];i.globalCompositeOperation=a,i.globalCompositeOperation===a&&(e[a]=void 0)}return e}function H(){return new Promise(function(e){var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAYAAABytg0kAAAAGUlEQVQI1wXBAQEAAAgCIOz/5TJI20UGhz5D2wX8PWbkFQAAAABJRU5ErkJggg==",t.onload=function(i){var n=document.createElement("canvas");n.width=257,n.height=256;var r=n.getContext("2d");if(!r)throw new Error("cannot get CanvasRenderingContext2D");r.fillStyle="rgb(255, 255, 255)",r.fillRect(0,0,n.width,n.height),r.globalAlpha=.5,r.globalCompositeOperation="color-dodge",r.drawImage(t,0,0);var a=r.getImageData(0,0,1,1);e(a.data[0]<128)}})}var P={"copy-alpha":c,"copy-opaque":d,"copy-all":h,"source-over":u,darken:f,multiply:p,"color-burn":v,"linear-burn":m,"darker-color":g,lighten:w,screen:y,"color-dodge":b,"linear-dodge":x,"lighter-color":k,overlay:S,"soft-light":A,"hard-light":E,"vivid-light":L,"linear-light":C,"pin-light":_,"hard-mix":T,difference:M,exclusion:U,subtract:j,divide:z,hue:F,saturation:R,color:D,luminosity:I},O=B();i.blend=N,H().then(function(e){e&&delete O["color-dodge"]})},{}],4:[function(e,t,i){"use strict";function n(){return a}function r(e,t){t||(t=a);for(var i=new Uint8Array(e),n=-1,r=0;r<i.length;r++)n=n>>>8^t[255&(n^i[r])];return(-1^n)>>>0}var a=new Uint32Array([0,1996959894,-301047508,-1727442502,124634137,1886057615,-379345611,-1637575261,249268274,2044508324,-522852066,-1747789432,162941995,2125561021,-407360249,-1866523247,498536548,1789927666,-205950648,-2067906082,450548861,1843258603,-187386543,-2083289657,325883990,1684777152,-43845254,-1973040660,335633487,1661365465,-99664541,-1928851979,997073096,1281953886,-715111964,-1570279054,1006888145,1258607687,-770865667,-1526024853,901097722,1119000684,-608450090,-1396901568,853044451,1172266101,-589951537,-1412350631,651767980,1373503546,-925412992,-1076862698,565507253,1454621731,-809855591,-1195530993,671266974,1594198024,-972236366,-1324619484,795835527,1483230225,-1050600021,-1234817731,1994146192,31158534,-1731059524,-271249366,1907459465,112637215,-1614814043,-390540237,2013776290,251722036,-1777751922,-519137256,2137656763,141376813,-1855689577,-429695999,1802195444,476864866,-2056965928,-228458418,1812370925,453092731,-2113342271,-183516073,1706088902,314042704,-1950435094,-54949764,1658658271,366619977,-1932296973,-69972891,1303535960,984961486,-1547960204,-725929758,1256170817,1037604311,-1529756563,-740887301,1131014506,879679996,-1385723834,-631195440,1141124467,855842277,-1442165665,-586318647,1342533948,654459306,-1106571248,-921952122,1466479909,544179635,-1184443383,-832445281,1591671054,702138776,-1328506846,-942167884,1504918807,783551873,-1212326853,-1061524307,-306674912,-1698712650,62317068,1957810842,-355121351,-1647151185,81470997,1943803523,-480048366,-1805370492,225274430,2053790376,-468791541,-1828061283,167816743,2097651377,-267414716,-2029476910,503444072,1762050814,-144550051,-2140837941,426522225,1852507879,-19653770,-1982649376,282753626,1742555852,-105259153,-1900089351,397917763,1622183637,-690576408,-1580100738,953729732,1340076626,-776247311,-1497606297,1068828381,1219638859,-670225446,-1358292148,906185462,1090812512,-547295293,-1469587627,829329135,1181335161,-882789492,-1134132454,628085408,1382605366,-871598187,-1156888829,570562233,1426400815,-977650754,-1296233688,733239954,1555261956,-1026031705,-1244606671,752459403,1541320221,-1687895376,-328994266,1969922972,40735498,-1677130071,-351390145,1913087877,83908371,-1782625662,-491226604,2075208622,213261112,-1831694693,-438977011,2094854071,198958881,-2032938284,-237706686,1759359992,534414190,-2118248755,-155638181,1873836001,414664567,-2012718362,-15766928,1711684554,285281116,-1889165569,-127750551,1634467795,376229701,-1609899400,-686959890,1308918612,956543938,-1486412191,-799009033,1231636301,1047427035,-1362007478,-640263460,1088359270,936918e3,-1447252397,-558129467,1202900863,817233897,-1111625188,-893730166,1404277552,615818150,-1160759803,-841546093,1423857449,601450431,-1285129682,-1000256840,1567103746,711928724,-1274298825,-1022587231,1510334235,755167117]);i.getCRCTable=n,i.crc32=r},{}],5:[function(e,t,i){"use strict";var n=function(){function e(e,t,i){this.src=e,this.scale=t,this.useOld=i,this.dest=document.createElement("canvas")}return Object.defineProperty(e.prototype,"destWidth",{get:function(){return 0|Math.max(1,this.src.width*this.scale)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"destHeight",{get:function(){return 0|Math.max(1,this.src.height*this.scale)},enumerable:!0,configurable:!0}),e.prototype.fast=function(){this.adjustSize();var e=this.dest.getContext("2d");if(!e)throw new Error("cannot get CanvasRenderingContext2D from dest");return this.useOld?e.drawImage(this.src,0,0,this.src.width,this.src.height,0,0,Math.round(this.src.width*this.scale),Math.round(this.src.height*this.scale)):e.drawImage(this.src,0,0,this.src.width,this.src.height,0,0,this.destWidth,this.destHeight),this.dest},e.prototype.adjustSize=function(){var e=this.destWidth;this.dest.width!==e&&(this.dest.width=e);var t=this.destHeight;this.dest.height!==t&&(this.dest.height=t)},e.prototype.beautiful=function(){var t=this.src.getContext("2d");if(!t)throw new Error("cannot get CanvasRenderingContext2D from src");var i=t.getImageData(0,0,this.src.width,this.src.height),n=t.createImageData(this.destWidth,this.destHeight);e.calculate(n,i),this.adjustSize();var r=this.dest.getContext("2d");if(!r)throw new Error("cannot get CanvasRenderingContext2D from dest");return r.putImageData(n,0,0),this.dest},e.prototype.beautifulWorker=function(t){var i=this,n=new Worker(e.createWorkerURL());e.activeWorker=n,n.onmessage=function(e){i.adjustSize();var n=i.dest.getContext("2d");if(!n)throw new Error("cannot get CanvasRenderingContext2D from dest");for(var r=n.createImageData(i.destWidth,i.destHeight),a=new Uint8Array(e.data.dest.ab),o=new Uint8Array(r.data.buffer,r.data.byteOffset,r.data.byteLength),s=0,l=o.length;l>s;s+=4)o[s]=a[s],o[s+1]=a[s+1],o[s+2]=a[s+2],o[s+3]=a[s+3];n.putImageData(r,0,0),t(i.dest)};var r=this.src.getContext("2d");if(!r)throw new Error("cannot get CanvasRenderingContext2D from src");var a=r.getImageData(0,0,this.src.width,this.src.height),o=this.dest.getContext("2d");if(!o)throw new Error("cannot get CanvasRenderingContext2D from dest");var s=o.createImageData(this.destWidth,this.destHeight);n.postMessage({useOld:this.useOld,src:{ab:a.data.buffer,width:a.width,height:a.height},dest:{ab:s.data.buffer,width:s.width,height:s.height},scale:this.scale},[a.data.buffer,s.data.buffer])},e.createWorkerURL=function(){if(e.workerURL)return e.workerURL;var t="\n'use strict';\nimportScripts('"+location.protocol+"//"+location.host+location.pathname.replace(/[^\/]*$/,"")+"js/downscaler.js');\nvar calculate20160127 = "+e.calculate20160127.toString()+";\nonmessage = function(e) {\n    var d = e.data;\n    if (d.useOld) {\n        calculate20160127({\n            data: new Uint8ClampedArray(d.dest.ab),\n            width: d.dest.width,\n            height: d.dest.height\n        }, {\n            data: new Uint8ClampedArray(d.src.ab),\n            width: d.src.width,\n            height: d.src.height\n        }, d.scale);\n    } else {\n        DownScaler.scale({\n            data: new Uint8ClampedArray(d.src.ab),\n            width: d.src.width,\n            height: d.src.height\n        }, {\n            data: new Uint8ClampedArray(d.dest.ab),\n            width: d.dest.width,\n            height: d.dest.height\n        }, 2.2);\n    }\n    postMessage({dest: d.dest}, [d.dest.ab]);\n};";return e.workerURL=URL.createObjectURL(new Blob([t],{type:"text/javascript"})),e.workerURL},e.revokeWorkerURL=function(){e.workerURL&&(URL.revokeObjectURL(e.workerURL),e.workerURL="")},e.calculate20160127=function(e,t,i){for(var n=new Float32Array(e.data.length),r=new Uint8Array(t.data.buffer,t.data.byteOffset,t.data.byteLength),a=new Uint8Array(e.data.buffer,e.data.byteOffset,e.data.byteLength),o=e.width,s=o<<2,l=t.width,c=t.height,d=i*i,h=0,u=0,f=0,p=0,v=0,m=0,g=0,w=0,y=0,b=0,x=0,k=0,S=0,A=!1,E=!1,L=0,C=0,_=0,T=0,M=0;c>M;++M)for(p=M*i,w=0|p,v=w*s,E=w!==(0|p+i),E&&(k=w+1-p,S=p+i-w-1),h=0;l>h;++h,u+=4)f=h*i,g=0|f,m=v+(g<<2),A=g!==(0|f+i),A&&(b=g+1-f,x=f+i-g-1),L=r[u],C=r[u+1],_=r[u+2],T=r[u+3],0!==T&&(255>T&&(L=L*T*32897>>23,C=C*T*32897>>23,_=_*T*32897>>23),A||E?A&&!E?(y=b*i,n[m]+=L*y,n[m+1]+=C*y,n[m+2]+=_*y,n[m+3]+=T*y,y=x*i,n[m+4]+=L*y,n[m+5]+=C*y,n[m+6]+=_*y,n[m+7]+=T*y):E&&!A?(y=k*i,n[m]+=L*y,n[m+1]+=C*y,n[m+2]+=_*y,n[m+3]+=T*y,m+=s,y=S*i,n[m]+=L*y,n[m+1]+=C*y,n[m+2]+=_*y,n[m+3]+=T*y):(y=b*k,n[m]+=L*y,n[m+1]+=C*y,n[m+2]+=_*y,n[m+3]+=T*y,y=x*k,n[m+4]+=L*y,n[m+5]+=C*y,n[m+6]+=_*y,n[m+7]+=T*y,m+=s,y=b*S,n[m]+=L*y,n[m+1]+=C*y,n[m+2]+=_*y,n[m+3]+=T*y,y=x*S,n[m+4]+=L*y,n[m+5]+=C*y,n[m+6]+=_*y,n[m+7]+=T*y):(n[m]+=L*d,n[m+1]+=C*d,n[m+2]+=_*d,n[m+3]+=T*d));var U=a.length;for(u=0,y=0;U>u;u+=4)y=255/n[u+3],a[u]=n[u]*y,a[u+1]=n[u+1]*y,a[u+2]=n[u+2]*y,a[u+3]=n[u+3]},e.calculate=function(e,t){for(var i=new Float32Array(e.data.length),n=new Uint8Array(t.data.buffer,t.data.byteOffset,t.data.byteLength),r=new Uint8Array(e.data.buffer,e.data.byteOffset,e.data.byteLength),a=e.width,o=e.height,s=a<<2,l=t.width,c=t.height,d=a/l,h=o/c,u=d*h,f=0,p=0,v=0,m=0,g=0,w=0,y=0,b=0,x=0,k=0,S=0,A=0,E=0,L=!1,C=!1,_=0,T=0,M=0,U=0,j=0;c>j;++j)for(m=j*h,b=0|m,g=b*s,C=b!==(0|m+h),C&&(A=b+1-m,E=m+h-b-1),f=0;l>f;++f,p+=4)v=f*d,y=0|v,w=g+(y<<2),L=y!==(0|v+d),L&&(k=y+1-v,S=v+d-y-1),_=n[p],T=n[p+1],M=n[p+2],U=n[p+3],0!==U&&(255>U&&(_=_*U*32897>>23,T=T*U*32897>>23,M=M*U*32897>>23),L||C?L&&!C?(x=k*d,i[w]+=_*x,i[w+1]+=T*x,i[w+2]+=M*x,i[w+3]+=U*x,x=S*d,i[w+4]+=_*x,i[w+5]+=T*x,i[w+6]+=M*x,i[w+7]+=U*x):C&&!L?(x=A*h,i[w]+=_*x,i[w+1]+=T*x,i[w+2]+=M*x,i[w+3]+=U*x,w+=s,x=E*h,i[w]+=_*x,i[w+1]+=T*x,i[w+2]+=M*x,i[w+3]+=U*x):(x=k*A,i[w]+=_*x,i[w+1]+=T*x,i[w+2]+=M*x,i[w+3]+=U*x,x=S*A,i[w+4]+=_*x,i[w+5]+=T*x,i[w+6]+=M*x,i[w+7]+=U*x,w+=s,x=k*E,i[w]+=_*x,i[w+1]+=T*x,i[w+2]+=M*x,i[w+3]+=U*x,x=S*E,i[w+4]+=_*x,i[w+5]+=T*x,i[w+6]+=M*x,i[w+7]+=U*x):(i[w]+=_*u,i[w+1]+=T*u,i[w+2]+=M*u,i[w+3]+=U*u));var z=r.length;for(p=0,x=0;z>p;p+=4)x=255/i[p+3],r[p]=i[p]*x,r[p+1]=i[p+1]*x,r[p+2]=i[p+2]*x,r[p+3]=i[p+3]},e}();i.DownScaler=n},{}],6:[function(e,t,i){"use strict";function n(e,t){var i=new FileReader;i.onload=function(e){return t(i.result)},i.readAsArrayBuffer(new Blob([e]))}function r(e){var t=new Uint8Array(e),i="",n=0,r=0,a=0,o=0;for(t.length>=3&&239===t[0]&&187===t[1]&&191===t[2]&&(n=3);n<t.length;)if(r=t[n],128>r)i+=String.fromCharCode(r),n++;else if(r>191&&224>r){
if(n+1>=t.length)throw"UTF-8 Decode failed. Two byte character was truncated.";a=t[n+1],i+=String.fromCharCode((31&r)<<6|63&a),n+=2}else{if(n+2>=t.length)throw"UTF-8 Decode failed. Multi byte character was truncated.";a=t[n+1],o=t[n+2],i+=String.fromCharCode((15&r)<<12|(63&a)<<6|63&o),n+=3}return i}function a(e){var t=0,i=e.replace(/\r/g,"").split("\n");i.shift();for(var n=0,r=i;n<r.length;n++){var a=r[n];a.length>2&&"//"===a.substring(0,2)&&++t}return t}var o,s=e("./crc32");!function(e){e[e.ShowLayerTree=0]="ShowLayerTree",e[e.ShowFaview=1]="ShowFaview",e[e.ShowFaviewAndReadme=2]="ShowFaviewAndReadme"}(o=i.FaviewMode||(i.FaviewMode={}));var l=function(){function e(e){this.json_=[{id:"root",text:e,type:"root",state:{opened:!0},children:[]}]}return Object.defineProperty(e.prototype,"json",{get:function(){return this.json_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.json_[0]},enumerable:!0,configurable:!0}),e.prototype.add=function(t,i,n){var r,a=this.json_,o=t.split("/");o.unshift(e.encodeName(this.root.text));for(var s=0;s<o.length;++s){var l=e.decodeName(o[s]);for(r=0;r<a.length;++r)if(a[r].text===l){a=a[r].children?a[r].children:a[r].children=[],r=-1;break}r===a.length&&(s===o.length-1?a.push(e.createNode(l,i,n)):(a.push(e.createNode(l,"folder")),a=a[a.length-1].children))}},e.createNode=function(e,t,i){switch(t){case"item":return{text:e,type:t,data:{value:i?i:""},children:[]};case"folder":return{text:e,type:t,state:{opened:!0},children:[]};case"filter":return{text:e,type:t,data:{value:i?i:""},state:{opened:!0},children:[]}}throw new Error("unknown node type: "+t)},e.encodeName=function(e){return e.replace(/[\x00-\x1f\x22\x25\x27\x2f\x5c\x7e\x7f]/g,function(e){return"%"+("0"+e[0].charCodeAt(0).toString(16)).slice(-2)})},e.decodeName=function(e){return decodeURIComponent(e)},e}(),c=function(){function e(e,t,i){this.defaultRootName=t,this.psdHash="",this.faviewMode=1,this.uniqueId=Date.now().toString()+Math.random().toString().substring(2),this.changedTimer=0,this.tree=e,this.jq=jQuery(this.tree),this.initTree(i)}return Object.defineProperty(e.prototype,"rootName",{get:function(){var e=this.jst.get_node("root");return e&&e.text?e.text:this.defaultRootName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"json",{get:function(){return this.jst.get_json()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pfv",{get:function(){var e=this,t=this.json;if(1!==t.length)throw new Error("sorry but favorite tree data is broken");var i=[],n=["[PSDToolFavorites-v1]"],r=function(t){for(var a=0,o=t;a<o.length;a++){var s=o[a];switch(i.push(l.encodeName(s.text)),s.type){case"root":n.push("root-name/"+i[0]),n.push("faview-mode/"+e.faviewMode.toString()),n.push(""),i.pop(),s.children&&s.children.length&&r(s.children),i.push("");break;case"folder":s.children&&s.children.length?r(s.children):(n.push("//"+i.join("/")+"~folder"),n.push(""));break;case"filter":n.push("//"+i.join("/")+"~filter"),s.data&&s.data.value&&n.push(s.data.value),n.push(""),s.children&&s.children.length&&r(s.children);break;case"item":n.push("//"+i.join("/")),s.data&&s.data.value&&n.push(s.data.value),n.push("")}i.pop()}};return r(t),n.join("\n")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renameNodes",{get:function(){var e=[],t=function(e,i){for(var n=0,r=e;n<r.length;n++){var a=r[n];if(!a.id)throw new Error("node does not have id");i.push({id:a.id,text:a.text,originalText:a.text,children:[]}),a.children&&a.children.length&&t(a.children,i[i.length-1].children)}};return t(this.json,e),e},enumerable:!0,configurable:!0}),e.prototype.bulkRename=function(e){var t=this,i=function(e,n){for(var r=0,a=e;r<a.length;r++){var o=a[r];o.originalText!==o.text&&t.jst.rename_node(o.id,n?"_":o.text),i(o.children,n)}};i(e,!0),i(e,!1)},e.prototype.jstCheck=function(e,t,i){switch(e){case"create_node":return"root"!==t.type;case"rename_node":return!0;case"delete_node":return"root"!==t.type;case"move_node":return"root"!==t.type&&"#"!==i.id&&"item"!==i.type;case"copy_node":return"root"!==t.type&&"#"!==i.id&&"item"!==i.type}return!1},e.prototype.clearSelection=function(){0!==this.jst.get_top_selected().length&&(this.jst.deselect_all(),this.onClearSelection&&this.onClearSelection())},e.prototype.get=function(e){return this.jst.get_node(e)},e.prototype.edit=function(e){var t=e;void 0===e&&(t=this.jst.get_top_selected()),this.jst.edit(t)},e.prototype.update=function(e,t){var i;if(e)i=this.jst.get_node(e);else{var n=this.jst.get_top_selected();if(!n.length)return;i=n[0]}t.type&&this.jst.set_type(i,t.type),t.data&&(i.data=t.data)},e.prototype.getFirstFilter=function(e){for(var t=0,i=this.getParents(e,"filter");t<i.length;t++){var n=i[t];if(n.data)return n.data.value}return""},e.prototype.getAncestorFilters=function(e){for(var t=[],i=0,n=this.getParents(e,"filter");i<n.length;i++){var r=n[i];r.data&&t.push(r.data.value)}return t},e.prototype.getParents=function(e,t){for(var i=[],n=this.jst.get_node(e.parent);n;n=this.jst.get_node(n.parent))void 0!==t&&t!==n.type||i.push(n);return i},e.prototype.remove=function(e){var t=e;void 0===e&&(t=this.jst.get_top_selected()),this.clearSelection();try{this.jst.delete_node(t)}catch(i){this.jst.delete_node(this.jst.create_node(null,"dummy","last")),this.jst.deselect_all()}},e.prototype.createItemNode=function(e,t){return void 0!==t&&""!==t||(t="New Item"),{text:t,type:"item",data:{value:e},children:[]}},e.prototype.createFolderNode=function(e){return void 0!==e&&""!==e||(e="New Folder"),{text:e,type:"folder",children:[]}},e.prototype.createFilterNode=function(e,t){return void 0!==t&&""!==t||(t="New Filter"),{text:t,type:"filter",data:{value:e},children:[]}},e.prototype.insertNode=function(e){var t=this.jst.get_top_selected(!0);if(0===t.length)return this.jst.create_node("root",e,"last");var i=t[0];if("item"!==i.type){var n=this.jst.create_node(i,e,"last");return i.state.opened||this.jst.open_node(i,null),n}var r=this.jst.get_node(i.parent),a=r.children.indexOf(i.id);return this.jst.create_node(r,e,-1!==a?a+1:"last")},e.prototype.selectNode=function(e,t){this.clearSelection(),this.jst.select_node(e,!0),t&&this.jst.edit(e)},e.prototype.addItem=function(e,t,i){var n=this.insertNode(this.createItemNode(e,t));return this.selectNode(n,i),n},e.prototype.addFolder=function(e,t){var i=this.insertNode(this.createFolderNode(e));return this.selectNode(i,t),i},e.prototype.addFilter=function(e,t,i){var n=this.insertNode(this.createFilterNode(e,t));return this.selectNode(n,i),n},e.prototype.addFolders=function(e){for(var t=[],i=0,n=e;i<n.length;i++){var r=n[i];t.push(this.insertNode(this.createFolderNode(r)))}this.clearSelection();for(var a=0,o=t;a<o.length;a++){var s=o[a];this.jst.select_node(s,!0)}return t},e.prototype.jstChanged=function(){var e=this;this.changedTimer&&clearTimeout(this.changedTimer),this.changedTimer=setTimeout(function(){e.changedTimer=0,e.onModified&&e.onModified(),e.updateLocalStorage()},32)},e.prototype.jstSelectionChanged=function(){var e=this.jst.get_top_selected(!0);if(0!==e.length){var t=e[0];if("item"!==t.type)return void(this.onClearSelection&&this.onClearSelection());try{this.onSelect&&this.onSelect(t)}catch(i){console.error(i),alert(i)}}},e.prototype.jstCopyNode=function(e,t){var i=this,n=function(e,t){var r=i.suggestUniqueName(e);switch(e.text!==r&&i.jst.rename_node(e,r),e.type){case"item":e.data={value:t.data.value};break;case"folder":for(var a=0;a<e.children.length;++a)n(i.jst.get_node(e.children[a]),i.jst.get_node(t.children[a]));break;case"filter":e.data={value:t.data.value};for(var a=0;a<e.children.length;++a)n(i.jst.get_node(e.children[a]),i.jst.get_node(t.children[a]))}};n(t.node,t.original)},e.prototype.jstMoveNode=function(e,t){var i=this.suggestUniqueName(t.node,t.text);t.text!==i&&this.jst.rename_node(t.node,i)},e.prototype.jstCreateNode=function(e,t){var i=this.suggestUniqueName(t.node);t.node.text!==i&&this.jst.rename_node(t.node,i)},e.prototype.jstRenameNode=function(e,t){var i=this.suggestUniqueName(t.node,t.text);t.text!==i&&this.jst.rename_node(t.node,i)},e.prototype.jstDoubleClick=function(e){var t=this.jst.get_node(e.target);switch(t.type){case"item":case"folder":case"filter":this.onDoubleClick&&this.onDoubleClick(t);break;default:this.jst.toggle_node(t)}},e.prototype.suggestUniqueName=function(e,t){var i=this.jst.get_node(e),n=this.jst.get_node(i.parent),r=new Set,a=n.children;if(a&&a.length)for(var o=0,s=a;o<s.length;o++){var l=s[o],c="string"==typeof l?l:l.id;c!==i.id&&r.add(this.jst.get_text(c))}var d=t?t:i.text;if(!r.has(d))return d;t+=" ";for(var h=2;r.has(t+h);)++h;return t+h},e.prototype.initTree=function(e,t){var i=this;this.jq.jstree("destroy"),this.jq.jstree({core:{animation:!1,check_callback:this.jstCheck,dblclick_toggle:!1,themes:{dots:!1},data:t?t:new l(this.defaultRootName).json},types:{root:{icon:!1},item:{icon:"glyphicon glyphicon-picture"},folder:{icon:"glyphicon glyphicon-folder-open"},filter:{icon:"glyphicon glyphicon-filter"}},plugins:["types","dnd","wholerow"]}),this.jst=this.jq.jstree(),this.jq.on("changed.jstree",function(e){return i.jstSelectionChanged()}),this.jq.on(["set_text.jstree","create_node.jstree","rename_node.jstree","delete_node.jstree","move_node.jstree","copy_node.jstree","cut.jstree","paste.jstree"].join(" "),function(e){return i.jstChanged()}),this.jq.on("copy_node.jstree",function(e,t){return i.jstCopyNode(e,t)}),this.jq.on("move_node.jstree",function(e,t){return i.jstMoveNode(e,t)}),this.jq.on("create_node.jstree",function(e,t){return i.jstCreateNode(e,t)}),this.jq.on("rename_node.jstree",function(e,t){return i.jstRenameNode(e,t)}),this.jq.on("dblclick.jstree",function(e){return i.jstDoubleClick(e)}),this.jq.on("ready.jstree",function(t){e&&e()})},e.prototype.updateLocalStorage=function(){var e=this,t=this.pfv;n(t,function(i){for(var n=e.getPFVListFromLocalStorage(),r=!1,o="pfv"+s.crc32(i).toString(16),l=0;l<n.length;++l)n[l].id!==e.uniqueId||n[l].hash!==e.psdHash?n[l].id===o&&n[l].hash===e.psdHash&&n.splice(l,1):(n.splice(l,1),r=!0);if(r||0!==a(t)){for(e.uniqueId=o,n.push({id:e.uniqueId,time:(new Date).getTime(),hash:e.psdHash,data:t});n.length>8;)n.shift();localStorage.psdtool_pfv=JSON.stringify(n)}})},e.prototype.getPFVListFromLocalStorage=function(){return"psdtool_pfv"in localStorage?JSON.parse(localStorage.psdtool_pfv):[]},e.prototype.getPFVFromLocalStorage=function(e){var t=this.getPFVListFromLocalStorage();if(t.length)for(var i=0,n=t;i<n.length;i++){var r=n[i];if(r.hash===e)return r}},e.prototype.loadFromArrayBuffer=function(e){return this.loadFromString(r(e),"pfv"+s.crc32(e).toString(16))},e.prototype.loadFromString=function(e,t){var i=this,r=function(t){var n=i.stringToNodeTree(e);i.initTree(function(){i.uniqueId=t,i.faviewMode=n.faviewMode,i.onLoaded&&i.onLoaded()},n.root)};return void 0!==t?r(t):n(e,function(e){r("pfv"+s.crc32(e).toString(16))}),!0},e.prototype.stringToNodeTree=function(e){var t=e.replace(/\r/g,"").split("\n");if("[PSDToolFavorites-v1]"!==t.shift())throw new Error("given PFV file does not have a valid header");for(var i,n=new l(this.defaultRootName),r={"root-name":this.defaultRootName,"faview-mode":2..toString()},a="",o="",s=[],c=!0,d=0,h=t;d<h.length;d++){var u=h[d];""!==u&&(u.length>2&&"//"===u.substring(0,2)?(c?(n.root.text=r["root-name"],c=!1):n.add(a,o,s.join("\n")),a=u.substring(2),-1!==a.indexOf("~")?(s=a.split("~"),a=s[0],o=s[1]):o="item",s=[]):c?(a=u.substring(0,u.indexOf("/")),i=l.decodeName(u.substring(a.length+1)),i&&(r[a]=i)):s.push(u))}c?n.root.text=r["root-name"]:n.add(a,o,s.join("\n"));var f,p=parseInt(r["faview-mode"],10);switch(p){case 0:case 1:case 2:f=p;break;default:f=2}return{root:n.json,faviewMode:f}},e}();i.Favorite=c,i.countEntries=a;var d=function(){function e(e,t,i){var n=this;this.favorite=e,this.rootSel=t,this.root=i,this.closed_=!0,this.treeRoots=[],i.addEventListener("click",function(e){return n.click(e)},!1),i.addEventListener("change",function(e){return n.change(e)},!1),i.addEventListener("input",function(e){return n.input(e)},!1),i.addEventListener("keyup",function(e){return n.keyup(e)},!1),t.addEventListener("change",function(e){return n.change(e)},!1),t.addEventListener("keyup",function(e){return n.keyup(e)},!1)}return Object.defineProperty(e.prototype,"roots",{get:function(){return this.treeRoots.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedRootIndex",{get:function(){return this.rootSel.selectedIndex},set:function(e){this.rootSel.selectedIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){for(var e=[],t=0;t<this.rootSel.length;++t){for(var i=[],n=this.treeRoots[t].getElementsByTagName("select"),r=0;r<n.length;++r){var a=n[r];if(a instanceof HTMLSelectElement){var o=a.getAttribute("data-caption");if(!o)throw new Error("could not get caption");for(var s={caption:o,items:[],selectedIndex:a.selectedIndex},l=0;l<a.length;++l){var c=a.options[l];s.items.push({name:c.textContent||"",value:c.value})}i.push(s)}}var d=this.rootSel.options[t];e.push({name:d.textContent||"",value:d.value,selects:i})}return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"closed",{get:function(){return this.closed_},enumerable:!0,configurable:!0}),e.prototype.serialize=function(){for(var e={rootSelectedValue:this.rootSel.value,items:{}},t=0;t<this.treeRoots.length;++t){for(var i={},n=this.treeRoots[t].getElementsByTagName("select"),r=0;r<n.length;++r){var a=n[r].getAttribute("data-id");if(!a)throw new Error("id is not defined");i[a]={value:n[r].value,lastMod:parseInt(n[r].getAttribute("data-lastmod")||"0",10)}}var o=this.rootSel.options[t];o instanceof HTMLOptionElement&&(e.items[o.value]=i)}return e},e.prototype.deserialize=function(e){for(var t=0;t<this.rootSel.length;++t){var i=this.rootSel.options[t];if(i instanceof HTMLOptionElement&&i.value in e.items){for(var n=e.items[i.value],r=this.treeRoots[t].getElementsByTagName("select"),a=0;a<r.length;++a){var o=r[a];if(o instanceof HTMLSelectElement){var s=o.getAttribute("data-id");if(!s)throw new Error("id is not defined");if(s in n)for(var l=0;l<o.length;++l){var c=o.options[l];if(c instanceof HTMLOptionElement&&c.value===n[s].value){if(o.selectedIndex=l,o.setAttribute("data-lastmod",n[s].lastMod.toString()),!o.parentElement)throw new Error("unexpected behavior");var d=o.parentElement.querySelector("input[type=range]");d instanceof HTMLInputElement&&(d.value=l.toString());break}}}}e.rootSelectedValue===i.value&&(this.rootSel.selectedIndex=t)}}},e.prototype.rootChanged=function(){for(var e=0;e<this.treeRoots.length;++e)this.rootSel.selectedIndex===e?this.treeRoots[e].style.display="block":this.treeRoots[e].style.display="none";this.onRootChanged&&this.onRootChanged()},e.prototype.changed=function(e){if(e.setAttribute("data-lastmod",Date.now().toString()),!e.parentElement)throw new Error("unexpected behavior");var t=e.parentElement.querySelector("input[type=range]");t instanceof HTMLInputElement&&(t.value=e.selectedIndex.toString()),this.onChange&&this.onChange(this.favorite.get(e.value))},e.prototype.keyup=function(e){var t=e.target;t instanceof HTMLSelectElement&&(t.blur(),t.focus())},e.prototype.change=function(e){var t=e.target;if(t instanceof HTMLSelectElement){if(t===this.rootSel)return void this.rootChanged();this.changed(t)}else if(t instanceof HTMLInputElement&&"range"===t.type){if(!t.parentElement)throw new Error("unexpected behavior");var i=t.parentElement.querySelector("select");i instanceof HTMLSelectElement&&(i.selectedIndex=parseInt(t.value,10),this.changed(i))}},e.prototype.input=function(e){var t=e.target;if(t instanceof HTMLInputElement&&"range"===t.type){if(!t.parentElement)throw new Error("unexpected behavior");var i=t.parentElement.querySelector("select");i instanceof HTMLSelectElement&&(i.selectedIndex=parseInt(t.value,10),this.changed(i))}},e.prototype.click=function(e){var t=e.target;if(t instanceof HTMLButtonElement){var i=0;if(t.classList.contains("psdtool-faview-prev")?i=-1:t.classList.contains("psdtool-faview-next")&&(i=1),0===i)return;if(!t.parentElement)throw new Error("unexpected behavior");var n=t.parentElement.querySelector("select");n instanceof HTMLSelectElement&&(n.selectedIndex=(n.length+n.selectedIndex+i)%n.length,n.focus(),this.changed(n))}},e.prototype.addNode=function(e,t){if(!e.id)throw new Error("node id is not defined");var i=e.text.replace(/^\*/,""),n=document.createElement("li"),r=document.createElement("span");r.className="glyphicon glyphicon-asterisk",n.appendChild(r),n.appendChild(document.createTextNode(" "+i)),t.appendChild(n);var a=document.createElement("select");a.className="form-control psdtool-faview-select",a.setAttribute("data-id",e.id),a.setAttribute("data-caption",i);var o,s,l=document.createElement("ul"),c=0,d=0;if(e.children&&e.children.length)for(var h=0,u=e.children;h<u.length;h++){var f=u[h];switch("string"==typeof f&&(f=this.favorite.get(f)),f.type){case"item":if(o=document.createElement("option"),o.textContent=f.text,!f.id)throw new Error("node id is not defined");o.value=f.id,1===++c&&(s=f.id),a.appendChild(o);break;case"folder":case"filter":this.addNode(f,l),++d}}if(c>0&&s&&""!==this.favorite.getFirstFilter(this.favorite.get(s))){var p=document.createElement("input");p.type="range",p.max=(c-1).toString(),p.value="0";var v=document.createElement("button");v.className="btn btn-default psdtool-faview-prev",v.innerHTML="&lt;",v.tabIndex=-1;var m=document.createElement("button");m.className="btn btn-default psdtool-faview-next",m.innerHTML="&gt;",m.tabIndex=-1;var g=document.createElement("div");g.className="psdtool-faview-select-container",1===c&&(v.disabled=!0,a.disabled=!0,p.disabled=!0,m.disabled=!0),g.appendChild(v),g.appendChild(a),g.appendChild(p),g.appendChild(m),n.appendChild(g)}d>0&&n.appendChild(l)},e.prototype.addRoot=function(e){for(var t=0,i=e;t<i.length;t++){var n=i[t];if(n.text.length>1&&"*"===n.text.charAt(0)&&n.id){var r=document.createElement("option");r.value=n.id,r.textContent=n.text.substring(1),this.rootSel.appendChild(r);var a=document.createElement("ul");if(n.children)for(var o=0,s=n.children;o<s.length;o++){var l=s[o];if("string"!=typeof l)switch(l.type){case"folder":case"filter":this.addNode(l,a)}}var c=document.createElement("li");c.style.display="none",c.appendChild(a),this.treeRoots.push(c),this.root.appendChild(c);for(var d=c.getElementsByTagName("select"),h=0;h<d.length;++h)d[h].setAttribute("data-lastmod",(d.length-h).toString())}n.children&&this.addRoot(n.children)}},e.prototype.start=function(e){this.treeRoots=[],this.rootSel.innerHTML="",this.root.innerHTML="",this.addRoot(this.favorite.json),void 0!==e&&this.deserialize(e),this.roots>0&&this.rootChanged(),this.closed_=!1},e.prototype.refresh=function(){this.start(this.serialize())},e.prototype.getActive=function(){for(var e=this.treeRoots[this.rootSel.selectedIndex].getElementsByTagName("select"),t=[],i=0;i<e.length;++i)t.push({n:this.favorite.get(e[i].value),lastMod:parseInt(e[i].getAttribute("data-lastmod")||"0",10)});t.sort(function(e,t){return e.lastMod===t.lastMod?0:e.lastMod<t.lastMod?-1:1});for(var n=[],r=0,a=t;r<a.length;r++){var i=a[r];n.push(i.n)}return n},e.prototype.close=function(){this.treeRoots=[],this.rootSel.innerHTML="",this.root.innerHTML="",this.closed_=!0},e}();i.Faview=d},{"./crc32":4}],7:[function(e,t,i){"use strict";var n;!function(e){e[e.NoFlip=0]="NoFlip",e[e.FlipX=1]="FlipX",e[e.FlipY=2]="FlipY",e[e.FlipXY=3]="FlipXY"}(n=i.FlipType||(i.FlipType={}));var r=function(){function e(t,i,n,r,a){this.input=t,this.displayName_=i,this.name_=n,this.children=[],this.parent=this,this.internalName_=e.encodeLayerName(this.name,a),r.length?this.fullPath_=r.join("/")+"/"+this.internalName_:this.fullPath_=this.internalName_}return Object.defineProperty(e.prototype,"checked",{get:function(){return this.input.checked},set:function(e){this.input.checked=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"disabled",{get:function(){return this.input.disabled},set:function(e){this.input.disabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayName",{get:function(){return this.displayName_.data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"internalName",{get:function(){return this.internalName_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullPath",{get:function(){return this.fullPath_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRoot",{get:function(){return this===this.parent},enumerable:!0,configurable:!0}),e.encodeLayerName=function(e,t){return e.replace(/[\x00-\x1f\x22\x25\x27\x2f\x5c\x7e\x7f]/g,function(e){return"%"+("0"+e[0].charCodeAt(0).toString(16)).slice(-2)})+(0===t?"":"\\"+t.toString())},e}();i.Node=r;var a=function(){function e(e,t,i){var n=this;this.disableExtendedFeature=e,this.treeRoot=t,this.root=new r(document.createElement("input"),document.createTextNode(""),"",[],0),this.nodes={},this.flipX=[],this.flipY=[],this.flipXY=[],this.flip_=0;var a=[],o=function(e,t,i,s){for(var l={},c={},d=0,h=i;d<h.length;d++){var u=h[d];u.Name in c?l[u.SeqID]=++c[u.Name]:l[u.SeqID]=c[u.Name]=0}for(var f=i.length-1;f>=0;--f){var p=n.createElements(i[f],s),v=new r(p.input,p.text,i[f].Name,a,l[i[f].SeqID]);v.parent=t,t.children.push(v),n.nodes[i[f].SeqID]=v;var m=document.createElement("ul");a.push(v.internalName),o(m,v,i[f].Children,i[f].SeqID),a.pop(),v.li=document.createElement("li"),i[f].Folder&&v.li.classList.add("psdtool-folder"),v.li.appendChild(p.div),v.li.appendChild(m),e.appendChild(v.li)}};o(t,this.root,i.Children,-1),this.registerClippingGroup(i.Children),this.disableExtendedFeature||this.registerFlippingGroup(),this.normalize(),this.flip=this.flip}return Object.defineProperty(e.prototype,"text",{get:function(){var e=[],t=[],i=function(n){for(var r=0,a=n.children;r<a.length;r++){var o=a[r];e.push(t.join("")+o.name),t.push("	"),i(o),t.pop()}};return i(this.root),e.join("\n")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"flip",{get:function(){return this.flip_},set:function(e){switch(this.flip_=e,this.treeRoot.classList.remove("psdtool-flip-x","psdtool-flip-y","psdtool-flip-xy"),e){case 0:this.doFlip(this.flipX,!1),this.doFlip(this.flipY,!1),this.doFlip(this.flipXY,!1);break;case 1:this.doFlip(this.flipY,!1),this.doFlip(this.flipXY,!1),this.doFlip(this.flipX,!0),this.treeRoot.classList.add("psdtool-flip-x");break;case 2:this.doFlip(this.flipXY,!1),this.doFlip(this.flipX,!1),this.doFlip(this.flipY,!0),this.treeRoot.classList.add("psdtool-flip-y");break;case 3:this.doFlip(this.flipX,!1),this.doFlip(this.flipY,!1),this.doFlip(this.flipXY,!0),this.treeRoot.classList.add("psdtool-flip-xy")}},enumerable:!0,configurable:!0}),e.prototype.flipSerialize=function(e){var t=function(e,i){for(var n,r=0,a=e.children;r<a.length;r++){var o=a[r];i.children[o.internalName]=n={checked:o.checked,children:{}},t(o,n)}},i={checked:e.checked,children:{}};return t(e,i),i},e.prototype.flipDeserialize=function(e,t){var i=function(e,t){for(var n,r=0,a=e.children;r<a.length;r++){var o=a[r];o.internalName in t.children&&(n=t.children[o.internalName],o.checked=n.checked,i(o,n))}};i(e,t)},e.prototype.doFlip=function(e,t){for(var i=0,n=e;i<n.length;i++){var r=n[i];if(t&&r.normal.checked){var a=this.flipSerialize(r.normal);this.flipDeserialize(r.flipped,a),r.flipped.checked=!0,r.normal.checked=!1}else if(!t&&r.flipped.checked){var a=this.flipSerialize(r.flipped);this.flipDeserialize(r.normal,a),r.normal.checked=!0,r.flipped.checked=!1}}},e.prototype.createElements=function(e,t){var i=document.createElement("label"),n=document.createElement("input"),r=e.Name;if(!this.disableExtendedFeature&&r.length>1)switch(r.charAt(0)){case"!":n.className="psdtool-layer-visible psdtool-layer-force-visible",n.name="l"+e.SeqID,n.type="checkbox",n.checked=!0,n.disabled=!0,n.style.display="none",r=r.substring(1);break;case"*":n.className="psdtool-layer-visible psdtool-layer-radio",n.name="r_"+t,n.type="radio",n.checked=e.Visible,r=r.substring(1)}if(n.name||(n.className="psdtool-layer-visible",n.name="l"+e.SeqID,n.type="checkbox",n.checked=e.Visible),this.disableExtendedFeature||(r=this.parseToken(r).name),n.setAttribute("data-seq",e.SeqID.toString()),i.appendChild(n),e.Clipping){var a=document.createElement("img");a.className="psdtool-clipped-mark",a.src="img/clipped.svg",a.alt="clipped mark",i.appendChild(a)}if(e.Folder){var o=document.createElement("span");o.className="psdtool-icon glyphicon glyphicon-folder-open",o.setAttribute("aria-hidden","true"),i.appendChild(o)}else{var s=document.createElement("canvas");if(s.className="psdtool-thumbnail",s.width=96,s.height=96,e.Canvas){var l=e.Width,c=e.Height;l>c?(l=s.width,c=s.width/e.Width*c):(c=s.height,l=s.height/e.Height*l);var d=s.getContext("2d");if(!d)throw new Error("cannot get CanvasRenderingContext2D for make thumbnail");d.drawImage(e.Canvas.canvas,(s.width-l)/2,(s.height-c)/2,l,c)}i.appendChild(s)}var h=document.createTextNode(r);i.appendChild(h);var u=document.createElement("div");return u.className="psdtool-layer-name",u.appendChild(i),{text:h,div:u,input:n}},e.prototype.updateClass=function(){function e(t){if(t.checked){if(t.li.classList.remove("psdtool-hidden"),t.clip)for(var i=0;i<t.clip.length;++i)t.clip[i].li.classList.remove("psdtool-hidden-by-clipping")}else if(t.li.classList.add("psdtool-hidden"),t.clip)for(var i=0;i<t.clip.length;++i)t.clip[i].li.classList.add("psdtool-hidden-by-clipping");for(var i=0;i<t.children.length;++i)e(t.children[i])}for(var t=0;t<this.root.children.length;++t)e(this.root.children[t])},e.prototype.registerClippingGroup=function(e){for(var t,i=[],n=e.length-1;n>=0;--n)if(this.registerClippingGroup(e[n].Children),t=this.nodes[e[n].SeqID],e[n].Clipping)i.unshift(t);else{if(i.length){for(var r=0;r<i.length;++r)i[r].clippedBy=t;t.clip=i}i=[]}},e.prototype.parseToken=function(e){for(var t=[],i=e.split(":"),n=i.length-1;n>=0;--n)switch(i[n]){case"flipx":case"flipy":case"flipxy":t.push(i[n]),i.pop();break;default:return{tokens:t,name:i.join(":")}}throw new Error("cannot parse token from name: "+e)},e.prototype.registerFlippingGroup=function(){var e=this,t=function(i){for(var n=0,r=i.children;n<r.length;n++){var a=r[n];t(a);for(var o=e.parseToken(a.name),s=[],l=0,c=o.tokens;l<c.length;l++){var d=c[l];switch(d){case"flipx":s.push(1);break;case"flipy":s.push(2);break;case"flipxy":s.push(3)}}if(0!==s.length){for(var h=void 0,u=0,f=i.children;u<f.length;u++){var p=f[u];if(p.name===o.name){h=p;break}}if(h)for(var v=0,m=s;v<m.length;v++){var g=m[v];switch(g){case 1:h.li.classList.add("psdtool-item-flip-x-orig"),a.li.classList.add("psdtool-item-flip-x"),e.flipX.push({normal:h,flipped:a});break;case 2:h.li.classList.add("psdtool-item-flip-y-orig"),a.li.classList.add("psdtool-item-flip-y"),e.flipY.push({normal:h,flipped:a});break;case 3:h.li.classList.add("psdtool-item-flip-xy-orig"),a.li.classList.add("psdtool-item-flip-xy"),e.flipXY.push({normal:h,flipped:a})}}}}};t(this.root)},e.prototype.getAllNode=function(){var e,t=[];for(var i in this.nodes)this.nodes.hasOwnProperty(i)&&(e=this.nodes[i],e.checked&&t.push(e));return t},e.prototype.serialize=function(e){var t=this.getAllNode();if(!t.length)return"";if(e){for(var i=[],n=0,r=t;n<r.length;n++){var a=r[n];i.push("/"+a.fullPath)}return i.join("\n")}var o,s=[],l={};for(o=0;o<t.length;++o)s.push({node:t[o],fullPathSlash:t[o].fullPath+"/",index:o}),l[t[o].fullPath]=!0;s.sort(function(e,t){return e.fullPathSlash>t.fullPathSlash?1:e.fullPathSlash<t.fullPathSlash?-1:0});var c,d;for(o=0;o<s.length;++o){for(d=s[o].node.fullPath.split("/"),c=0;c<d.length;++c)if(!l[d.slice(0,c+1).join("/")]){s.splice(o--,1),c=-1;break}-1!==c&&o>0&&0===s[o].fullPathSlash.indexOf(s[o-1].fullPathSlash)&&s.splice(--o,1)}s.sort(function(e,t){return e.index>t.index?-1:e.index<t.index?1:0}),d=[];for(var h=0,u=s;h<u.length;h++){var f=u[h];d.push(f.node.fullPath)}return d.join("\n")},e.prototype.buildDeserializeTree=function(e){for(var t,i,n,r="/"===e.charAt(0),a={children:{},checked:!0,allLayer:r},o=e.replace(/\r/g,"").split("\n"),s=0,l=o;s<l.length;s++){var c=l[s];for(n=c.split("/"),t=r?1:0,i=a;t<n.length;++t)n[t]in i.children||(i.children[n[t]]={children:{},checked:!r}),i=i.children[n[t]];r&&(i.checked=!0)}return a},e.prototype.apply=function(e,t,i){for(var n={},r=0,a=t.children;r<a.length;r++){var o=a[r];n[o.internalName]=!0;var s=void 0;e&&(s=e.children[o.internalName]),e&&s?(s.checked&&(o.checked=!0),this.apply(s,o,i)):(o.checked=!1,i&&this.apply(null,o,i))}},e.prototype.deserialize=function(e){var t=this.serialize(!0);try{var i=this.buildDeserializeTree(e);i.allLayer&&(this.clear(),this.normalize()),this.apply(i,this.root,i.allLayer),this.flip=this.flip}catch(n){throw this.apply(this.buildDeserializeTree(t),this.root,!0),this.flip=this.flip,n}},e.prototype.buildFilterTree=function(e){for(var t,i,n={children:{}},r=0,a=e.replace(/\r/g,"").split("\n");r<a.length;r++){var o=a[r];i=o.split("/"),t=n;for(var s=0,l=i;s<l.length;s++){var c=l[s];c in t.children||(t.children[c]={children:{}}),t=t.children[c]}}return n},e.prototype.applyWithFilter=function(e,t,i){for(var n={},r=0,a=i.children;r<a.length;r++){var o=a[r];n[o.internalName]=!0;var s=void 0;if(t&&(s=t.children[o.internalName]),t&&s){var l=void 0;e&&(l=e.children[o.internalName]),e&&l?(l.checked&&(o.checked=!0),this.applyWithFilter(l,s,o)):o.checked=!1}}},e.prototype.deserializePartial=function(e,t,i){var n=this.serialize(!0);try{if(void 0!==e)if(""===e)this.clear();else{var r=this.buildDeserializeTree(e);r.allLayer&&(this.clear(),this.normalize()),this.apply(r,this.root,r.allLayer)}var a=this.buildDeserializeTree(t);if(a.allLayer)throw new Error("cannot use allLayer mode in LayerTree.deserializePartial");this.applyWithFilter(a,this.buildFilterTree(i),this.root),this.flip=this.flip}catch(o){throw this.apply(this.buildDeserializeTree(n),this.root,!0),this.flip=this.flip,o}},e.prototype.clear=function(){for(var e in this.nodes)this.nodes.hasOwnProperty(e)&&(this.nodes[e].checked=!1)},e.prototype.normalize=function(){var e=document.getElementById("layer-tree");if(!e)throw new Error("#layer-tree not found");for(var t=e.querySelectorAll(".psdtool-layer-force-visible"),i=0;i<t.length;++i)t[i].checked=!0;for(var n={},r=e.querySelectorAll(".psdtool-layer-radio"),i=0;i<r.length;++i){var a=r[i];if(!(a instanceof HTMLInputElement))throw new Error("found .psdtool-layer-radio that are not HTMLInputElement");if(!(a.name in n)){n[a.name]=!0;var o=e.querySelectorAll('.psdtool-layer-radio[name="'+a.name+'"]:checked');o.length||(a.checked=!0)}}},e}();i.LayerTree=a;var o=function(){function e(e,t){var i=this;this.root=new r(document.createElement("input"),document.createTextNode(""),"",[],0),this.nodes={};var n=[],a=function(e,t,o){for(var s={},l={},c=0,d=o;c<d.length;c++){var h=d[c];h.Name in l?s[h.SeqID]=++l[h.Name]:s[h.SeqID]=l[h.Name]=0}for(var u=o.length-1;u>=0;--u){var f=i.createElements(o[u]),p=new r(f.input,f.text,o[u].Name,n,s[o[u].SeqID]);p.parent=t,t.children.push(p),i.nodes[o[u].SeqID]=p,p.li=document.createElement("li");var v=document.createElement("ul");n.push(p.internalName),a(v,p,o[u].Children),n.pop(),p.li.appendChild(f.label),p.li.appendChild(v),e.appendChild(p.li)}};a(e,this.root,t.Children)}return e.prototype.createElements=function(e){var t=document.createElement("input");t.type="checkbox",t.checked=!0,t.setAttribute("data-seq",e.SeqID.toString());var i=document.createTextNode(e.Name),n=document.createElement("label");return n.appendChild(t),n.appendChild(i),{text:i,label:n,input:t}},e.prototype.getAllNode=function(){var e,t=[],i=0;for(var n in this.nodes)this.nodes.hasOwnProperty(n)&&(e=this.nodes[n],e.disabled||(++i,e.checked&&t.push(e)));return t.length===i?[]:t},e.prototype.serialize=function(){var e=this.getAllNode();if(!e.length)return"";var t,i=[],n={};
for(t=0;t<e.length;++t)i.push({node:e[t],fullPathSlash:e[t].fullPath+"/",index:t}),n[e[t].fullPath]=!0;i.sort(function(e,t){return e.fullPathSlash>t.fullPathSlash?1:e.fullPathSlash<t.fullPathSlash?-1:0});var r,a;for(t=0;t<i.length;++t){for(a=i[t].node.fullPath.split("/"),r=0;r<a.length;++r)if(!n[a.slice(0,r+1).join("/")]){i.splice(t--,1),r=-1;break}-1!==r&&t>0&&0===i[t].fullPathSlash.indexOf(i[t-1].fullPathSlash)&&i.splice(--t,1)}for(i.sort(function(e,t){return e.index>t.index?-1:e.index<t.index?1:0}),a=[],t=0;t<i.length;++t)a.push(i[t].node.fullPath);return a.join("\n")},e.prototype.buildDeserializeTree=function(e){for(var t,i,n={children:{},checked:!0},r=e.replace(/\r/g,"").split("\n"),a=0,o=r;a<o.length;a++){var s=o[a];i=s.split("/"),t=n;for(var l=0,c=i;l<c.length;l++){var d=c[l];d in t.children||(t.children[d]={children:{},checked:!0}),t=t.children[d]}}return n},e.prototype.apply=function(e,t,i){for(var n={},r=0,a=t.children;r<a.length;r++){var o=a[r];if(!o.disabled){n[o.internalName]=!0;var s=void 0;e&&(s=e.children[o.internalName]),e&&s?(o.checked=s.checked,this.apply(s,o,i)):(i&&(o.disabled=!0),o.checked=!1,this.apply(null,o,i))}}},e.prototype.deserialize=function(e,t){var i=this.serialize();try{for(var n in this.nodes)this.nodes.hasOwnProperty(n)&&(this.nodes[n].disabled=!1,this.nodes[n].checked=!1);for(var r=t.length-1;r>=0;--r)this.apply(this.buildDeserializeTree(t[r]),this.root,!0);if(""===e)return;this.apply(this.buildDeserializeTree(e),this.root,!1)}catch(a){throw this.apply(this.buildDeserializeTree(i),this.root,!1),a}},e}();i.Filter=o},{}],8:[function(e,t,i){"use strict";function n(e,t,i,n,r){for(var a=0;r>a;++a)e[i++]=t[n++]}function r(e,t,i,n,r){for(var a=new DataView(e.buffer),o=i+r;o>i;i+=4,++n)a.setInt32(i,t[n],!0)}function a(e,t,i){for(var n=0;i>n;++n)e[t++]=0}var o=function(){function e(){var t=this;this.worker=new Worker(e.createWorkerURL()),this._callbacks=[],this.worker.onmessage=function(e){var i=t._callbacks.shift();i&&(e.data.compressed?i(e.data.compressed,!0):i(e.data.original,!1))}}return e.prototype.compressHC=function(e){var t=this;return new Promise(function(i){t._callbacks.push(function(e,t){return i([e,t])}),t.worker.postMessage({buffer:e},[e])})},Object.defineProperty(e.prototype,"tasks",{get:function(){return this._callbacks.length},enumerable:!0,configurable:!0}),e._compress=function(e,t,i){var n=i.compressBlockBound(e.byteLength);(!t||t.byteLength<n)&&(t=new Uint8Array(n));var r=i.compressBlockHC(new Uint8Array(e),t);return r>e.byteLength?[void 0,t]:[t.slice(0,r).buffer,t]},e.createWorkerURL=function(){return e.workerURL?e.workerURL:(e.workerURL=URL.createObjectURL(new Blob(["\n'use strict';\nimportScripts('"+location.protocol+"//"+location.host+location.pathname.replace(/[^\/]*$/,"")+"js/lz4.js');\nvar compBuffer, compress = "+e._compress.toString()+";\nonmessage = function(e){\n    var r = compress(e.data.buffer, compBuffer, LZ4);\n    if (r[0]) {\n        postMessage({ compressed: r[0] }, [r[0]]);\n    } else {\n        postMessage({ original: e.data.buffer }, [e.data.buffer]);\n    }\n    compBuffer = r[1];\n};"],{type:"text/javascript"})),e.workerURL)},e}(),s=function(){function e(e,t){this.queueMax=t,this._compresser=[];for(var i=0;e>i;++i)this._compresser.push(new o)}return e.prototype._waitReadyCompressers=function(e){var t=this;return new Promise(function(i){var n=function(){for(var r=0;r<t._compresser.length;++r)if(t._compresser[r].tasks<=e)return void i(t._compresser[r]);setTimeout(n,40)};n()})},e.prototype._compressHC=function(e){return this._waitReadyCompressers(this.queueMax).then(function(t){return t.compressHC(e)})},e.compressHC=function(t){return e._instance||(e._instance=new e(2,3)),e._instance._compressHC(t)},e}(),l=function(){function e(e){if(this.bufferSize=e,this.buffers=[],this.buffer=new Uint8Array(this.bufferSize),this.used=0,1048576!==e&&4194304!==e)throw new Error("unsupported buffer size: "+e)}return e.prototype.compress=function(e){e&&a(this.buffer,e,this.buffer.length-e),this.onFilter&&this.onFilter(e?new Uint8Array(this.buffer.buffer,0,e):this.buffer);var t=this.buffer.buffer;this.buffer=new Uint8Array(this.bufferSize),this.used=0;var i=s.compressHC(t);return this.buffers.push(i),i},e.prototype.addInt32Array=function(e){for(var t=[];;){if(this.bufferSize-this.used>=e.byteLength)return r(this.buffer,e,this.used,0,e.byteLength),this.used+=e.byteLength,Promise.all(t);var i=this.bufferSize-this.used;r(this.buffer,e,this.used,0,i),e=new Int32Array(e.buffer,e.byteOffset+i,e.byteLength-i>>2),t.push(this.compress())}},e.prototype.addUint8Array=function(e){for(var t=[];;){if(this.bufferSize-this.used>=e.byteLength)return n(this.buffer,e,this.used,0,e.byteLength),this.used+=e.byteLength,Promise.all(t);var i=this.bufferSize-this.used;n(this.buffer,e,this.used,0,i),e=new Uint8Array(e.buffer,e.byteOffset+i,e.byteLength-i),t.push(this.compress())}},e.prototype.finish=function(){var e=this;return 0!==this.used&&this.compress(this.used),Promise.all(this.buffers).then(function(t){var i=[],n=0,r=new ArrayBuffer(7),a=new DataView(r);switch(a.setUint32(0,407708164,!0),e.bufferSize){case 1048576:a.setUint8(4,96),a.setUint8(5,96),a.setUint8(6,81);break;case 4194304:a.setUint8(4,96),a.setUint8(5,112),a.setUint8(6,115)}i.push(r),n+=r.byteLength;for(var o=0,s=t;o<s.length;o++){var l=s[o],c=l[0],d=l[1],h=new ArrayBuffer(4);new DataView(h).setUint32(0,c.byteLength|(d?0:2147483648),!0),i.push(h,c),n+=h.byteLength+c.byteLength}return i.push(new ArrayBuffer(4)),n+=4,[i,n]})},e}();i.Streamer=l},{}],9:[function(e,t,i){"use strict";function n(e,t){var i=e.getElementById(t);if(!i)throw new Error("#"+t+" not found");return i}var r=e("es6-promise");r.polyfill();var a=e("./renderer"),o=e("./favorite"),s=e("./layertree"),l=e("./tileder"),c=e("./zipper"),d=e("./primar"),h=function(){function e(e,t){this.bar=n(document,"progress-dialog-progress-bar"),this.text=document.createTextNode("");var i=n(document,"progress-dialog-label");i.innerHTML="",i.appendChild(document.createTextNode(e));var r=n(document,"progress-dialog-progress-caption");r.innerHTML="",r.appendChild(this.text),this.update(0,t),this.dialog=jQuery("#progress-dialog"),this.dialog.data("bs.modal")?this.dialog.modal("show"):this.dialog.modal()}return e.prototype.close=function(){this.dialog.modal("hide")},e.prototype.update=function(e,t){var i=Math.min(100,Math.max(0,100*e));this.bar.style.width=i+"%",this.bar.setAttribute("aria-valuenow",i.toFixed(0)+"%"),this.text.data=i.toFixed(0)+"% "+t},e}(),u=function(){function e(e){this.favorite=e}return e.prototype.init=function(){var e=this,t=n(document,"filter-tree");if(!(t instanceof HTMLUListElement))throw new Error("#filter-tree is not an UL element");this.treeRoot=t,this.treeRoot.innerHTML="",this.treeRoot.addEventListener("click",function(t){var i=t.target;if(i instanceof HTMLInputElement){for(var n=i.parentElement;!(n instanceof HTMLLIElement);){if(!n)throw new Error("li tag is not found");n=n.parentElement}for(var r=i.checked,a=n.querySelectorAll("input"),o=0;o<a.length;++o){var s=a[o];s instanceof HTMLInputElement&&(s.checked=r)}if(r)for(var l=n.parentElement;l!==e.treeRoot&&l;l=l.parentElement)if(l instanceof HTMLLIElement){var c=l.querySelector("input");c instanceof HTMLInputElement&&(c.checked=!0)}e.updateClass(),e.update()}},!1);var i=n(document,"use-filter");if(!(i instanceof HTMLInputElement))throw new Error("#filter-tree is not an INPUT element");this.useFilter=i,this.useFilter.addEventListener("click",function(t){e.updateClass(),e.update()},!1);var r=n(document,"filter-dialog");if(!(r instanceof HTMLDivElement))throw new Error("#filter-dialog is not an DIV element");this.dialog=r,jQuery(this.dialog).on("shown.bs.modal",function(t){var i=e.favorite.getAncestorFilters(e.node);"filter"===e.node.type?(e.useFilter.checked=!0,e.root.deserialize(e.node.data?e.node.data.value:"",i)):(e.useFilter.checked=!1,e.root.deserialize("",i)),e.updateClass()})},e.prototype.load=function(e){this.treeRoot||this.init(),this.root=new s.Filter(this.treeRoot,e)},e.prototype.updateClass=function(){this.useFilter.checked?this.treeRoot.classList.remove("disabled"):this.treeRoot.classList.add("disabled");for(var e=this.treeRoot.querySelectorAll("input"),t=0,i=void 0,n=void 0;t<e.length;++t)if(i=e[t],i instanceof HTMLInputElement&&i.parentElement){for(n=i.parentElement;n&&n.parentElement&&"LI"!==n.tagName;)n=n.parentElement;i.disabled?n.classList.add("disabled"):n.classList.remove("disabled"),i.checked?n.classList.add("checked"):n.classList.remove("checked")}},e.prototype.update=function(){if(this.useFilter.checked){var e=this.root.serialize();if(e)return void(this.onUpdate&&this.onUpdate(this.node.id||"","filter",e))}this.onUpdate&&this.onUpdate(this.node.id||"","folder","")},e.prototype.show=function(e){this.node=e;var t=jQuery(this.dialog);t.data("bs.modal")?t.modal("show"):t.modal()},e}(),f=function(){function e(e){var t=this;this.favorite=e;var i=n(document,"faview-mode");if(!(i instanceof HTMLSelectElement))throw new Error("#faview-mode is not a SELECT element");this.faviewMode=i,this.faviewMode.addEventListener("change",function(e){return t.update()});var r=n(document,"faview-setting-dialog");if(!(r instanceof HTMLDivElement))throw new Error("#faview-setting-dialog is not an DIV element");this.dialog=r,jQuery(this.dialog).on("shown.bs.modal",function(e){t.faviewMode.selectedIndex=t.favorite.faviewMode})}return e.prototype.update=function(){this.favorite.faviewMode=this.faviewMode.selectedIndex,this.onUpdate&&this.onUpdate()},e}(),p=function(){function e(){this.sideBodyScrollPos={},this.normalModeState=""}return e.prototype.init=function(){var t=this;e.initDropZone("dropzone",function(e){var i,n;for(i=0;i<e.length;++i)if(n=e[i].name.substring(e[i].name.length-4).toLowerCase(),".pfv"===n){t.droppedPFV=e[i];break}for(i=0;i<e.length;++i)if(n=e[i].name.substring(e[i].name.length-4).toLowerCase(),".pfv"!==n)return void t.loadAndParse(e[i])}),this.initUI(),n(document,"samplefile").addEventListener("click",function(e){var i=n(document,"samplefile").getAttribute("data-filename");i&&t.loadAndParse(i)},!1),window.addEventListener("resize",function(e){return t.resized()},!1),window.addEventListener("hashchange",function(e){return t.hashchanged()},!1),this.hashchanged();for(var i=document.querySelectorAll(".psdtool-loading"),r=0;r<i.length;++r)i[r].classList.add("psdtool-loaded"),i[r].classList.remove("psdtool-loading")},e.prototype.hashchanged=function(){var e=decodeURIComponent(location.hash.substring(1));"load:"===e.substring(0,5)&&this.loadAndParse(e.substring(5))},e.prototype.resized=function(){var e=n(document,"main-container"),t=n(document,"misc-ui"),i=n(document,"preview-container"),r=i.style.display;i.style.display="none",i.style.width=e.clientWidth+"px",i.style.height=e.clientHeight-t.offsetHeight+"px",i.style.display=r;var a=n(document,"side-container"),o=n(document,"side-head"),s=n(document,"side-body");r=s.style.display,s.style.display="none",s.style.width=a.clientWidth+"px",s.style.height=a.clientHeight-o.offsetHeight+"px",s.style.display=r;for(var l=document.querySelectorAll(".psdtool-tab-toolbar"),c=0;c<l.length;++c){var d=l[c];if(d instanceof HTMLElement){for(var h=d.parentElement;h&&!h.classList.contains("psdtool-tab-pane");)h=h.parentElement;h&&(h.style.paddingTop=d.clientHeight+"px")}}},e.prototype.loadAndParse=function(t){var i=this,r=n(document,"file-open-ui"),a=n(document,"error-report-ui"),o=n(document,"main");r.style.display="block",a.style.display="none",o.style.display="none",Mousetrap.pause();var s=n(document,"error-message"),l=document.createTextNode("");s.innerHTML="",s.appendChild(l);var c=new h("Loading...","Getting ready...");e.loadAsBlob(function(e){return c.update(e,"Receiving file...")},t).then(function(e){return i.parse(function(e){return c.update(e,"Loading file...")},e)}).then(function(){c.close(),r.style.display="none",a.style.display="none",o.style.display="block",Mousetrap.unpause(),i.resized()},function(e){c.close(),r.style.display="block",a.style.display="block",o.style.display="none",Mousetrap.pause(),l.data=e.toString(),console.error(e)})},e.prototype.parse=function(e,t){var i=this,r=m.deferred();return PSD.parseWorker(t.buffer,e,function(e){try{i.psdRoot=e,i.loadLayerTree(e),i.filterDialog.load(e),i.loadRenderer(e),i.maxPixels.value=(i.optionAutoTrim.checked?i.renderer.Height:i.renderer.CanvasHeight).toString(),i.seqDlPrefix.value=t.name,i.seqDlNum.value="0";for(var a=document.querySelectorAll(".psdtool-show-readme"),o=0,s=void 0;o<a.length;++o)s=a[o],s instanceof HTMLElement&&(""!==e.Readme?s.classList.remove("hidden"):s.classList.add("hidden"));if(n(document,"readme").textContent=e.Readme,i.favorite.psdHash=e.Hash,i.droppedPFV){var l=new FileReader;l.onload=function(){i.favorite.loadFromArrayBuffer(l.result)},l.readAsArrayBuffer(i.droppedPFV)}else{var c=i.favorite.getPFVFromLocalStorage(e.Hash);c&&c.time/1e3>e.PFVModDate?i.favorite.loadFromString(c.data,c.id):e.PFV&&i.favorite.loadFromString(e.PFV)}i.redraw(),r.resolve(!0)}catch(d){r.reject(d)}},function(e){return r.reject(e)}),r.promise},e.prototype.pfvOnDrop=function(e){var t=this;this.leaveReaderMode();var i,n,r=function(){if(n=e[i].name.substring(e[i].name.length-4).toLowerCase(),".pfv"===n){var r=new FileReader;return r.onload=function(e){t.favorite.loadFromArrayBuffer(r.result)&&jQuery("#import-dialog").modal("hide")},r.readAsArrayBuffer(e[i]),{value:void 0}}};for(i=0;i<e.length;++i){var a=r();if("object"==typeof a)return a.value}},e.prototype.initFavoriteUI=function(){var t=this,i=n(document,"favorite-tree");this.favorite=new o.Favorite(i,i.getAttribute("data-root-name")||"My Favorites"),this.favorite.onModified=function(){t.needRefreshFaview=!0},this.favorite.onLoaded=function(){switch(t.startFaview(),t.favorite.faviewMode){case 0:t.toggleTreeFaview(!1);break;case 1:t.faview.closed||t.toggleTreeFaview(!0);break;case 2:t.faview.closed||(t.toggleTreeFaview(!0),""!==t.psdRoot.Readme&&jQuery("#readme-dialog").modal("show"))}},this.favorite.onClearSelection=function(){return t.leaveReaderMode()},this.favorite.onSelect=function(e){if("item"!==e.type||!e.data)return void t.leaveReaderMode();try{t.enterReaderMode(e.data.value,t.favorite.getFirstFilter(e),e.text+".png")}catch(i){console.error(i),alert(i)}},this.favorite.onDoubleClick=function(e){try{switch(e.type){case"item":e.data&&t.leaveReaderMode(e.data.value,t.favorite.getFirstFilter(e));break;case"folder":case"filter":t.filterDialog.show(e)}}catch(i){console.error(i),alert(i)}},this.filterDialog=new u(this.favorite),this.filterDialog.onUpdate=function(e,i,n){t.favorite.update(e,{type:i,data:{value:n}}),t.favorite.updateLocalStorage(),t.needRefreshFaview=!0},jQuery("button[data-psdtool-tree-add-item]").on("click",function(e){t.leaveReaderMode(),t.favorite.addItem(t.layerRoot.serialize(!1),void 0,!0)}),Mousetrap.bind("mod+b",function(e){e.preventDefault();var i=document.querySelector("button[data-psdtool-tree-add-item]"),n=i?i.getAttribute("data-caption"):null,r=prompt(n?n:"item name",t.lastCheckedNode?t.lastCheckedNode.displayName:"New Item");null!==r&&(t.leaveReaderMode(),t.favorite.addItem(t.layerRoot.serialize(!1),r,!1))}),jQuery("button[data-psdtool-tree-add-folder]").on("click",function(e){t.favorite.addFolder(void 0,!0)}),Mousetrap.bind("mod+d",function(e){e.preventDefault();var i=document.querySelector("button[data-psdtool-tree-add-folder]"),n=i?i.getAttribute("data-caption"):null,r=prompt(n?n:"item name","New Folder");null!==r&&(t.favorite.clearSelection(),t.favorite.addFolder(r,!0))}),jQuery("button[data-psdtool-tree-rename]").on("click",function(e){return t.favorite.edit()}),Mousetrap.bind("f2",function(e){e.preventDefault(),t.favorite.edit()}),jQuery("button[data-psdtool-tree-remove]").on("click",function(e){return t.favorite.remove()}),Mousetrap.bind("shift+mod+g",function(e){var i=e.target;if(i instanceof HTMLElement&&i.classList.contains("psdtool-layer-visible")){if(e.preventDefault(),!i.classList.contains("psdtool-layer-radio"))return;if(i instanceof HTMLInputElement){for(var n=t.layerRoot.serialize(!0),r=[],a=void 0,o=document.querySelectorAll('input[name="'+i.name+'"].psdtool-layer-radio'),s=0;s<o.length;++s)a=t.layerRoot.nodes[parseInt(o[s].getAttribute("data-seq")||"0",10)],a.li.classList.contains("psdtool-item-flip-x")||a.li.classList.contains("psdtool-item-flip-y")||a.li.classList.contains("psdtool-item-flip-xy")||(a.checked=!0,t.favorite.addItem(t.layerRoot.serialize(!1),a.displayName,!1),r.push(a.displayName));t.layerRoot.deserialize(n),t.redraw(),alert(r.length+" favorite item(s) has been added.\n\n"+r.join("\n"))}}}),e.initDropZone("pfv-dropzone",function(e){return t.pfvOnDrop(e)}),e.initDropZone("pfv-dropzone2",function(e){return t.pfvOnDrop(e)}),jQuery("#import-dialog").on("shown.bs.modal",function(i){var r=n(document,"pfv-recents");r.innerHTML="";for(var a,s=t.favorite.getPFVListFromLocalStorage(),l=s.length-1;l>=0;--l)a=document.createElement("button"),a.type="button",a.className="list-group-item",s[l].hash===t.psdRoot.Hash&&(a.className+=" list-group-item-info"),a.setAttribute("data-dismiss","modal"),function(e,i,n){e.addEventListener("click",function(e){t.leaveReaderMode(),t.favorite.loadFromString(i,n)},!1)}(a,s[l].data,s[l].id),a.appendChild(document.createTextNode(o.countEntries(s[l].data)+" item(s) / Created at "+e.formateDate(new Date(s[l].time)))),r.appendChild(a)}),jQuery("#bulk-create-folder-dialog").on("shown.bs.modal",function(e){return t.bulkCreateFolderTextarea.focus()});var r=n(document,"bulk-create-folder-textarea");if(!(r instanceof HTMLTextAreaElement))throw new Error("element not found: #bulk-create-folder-textarea");this.bulkCreateFolderTextarea=r,n(document,"bulk-create-folder").addEventListener("click",function(e){for(var i=[],n=0,r=t.bulkCreateFolderTextarea.value.replace(/\r/g,"").split("\n");n<r.length;n++){var a=r[n];a=a.trim(),""!==a&&i.push(a)}t.favorite.addFolders(i),t.bulkCreateFolderTextarea.value=""},!1);var a=new Map;jQuery("#bulk-rename-dialog").on("shown.bs.modal",function(e){a.clear();var i=function(e,t){for(var n=0,r=t;n<r.length;n++){var o=r[n],s=document.createElement("input");a.set(s,o),s.className="form-control",s.value=o.text,function(e){e.onblur=function(t){var i=a.get(e);i&&(i.text=e.value.trim())}}(s);var l=document.createElement("li");l.appendChild(s);var c=document.createElement("ul");l.appendChild(c),i(c,o.children),e.appendChild(l)}},r=n(document,"bulk-rename-tree");t.bulkRenameData=t.favorite.renameNodes,r.innerHTML="",i(r,t.bulkRenameData)}),n(document,"bulk-rename").addEventListener("click",function(e){var i=1,r=n(document,"rename-digits");r instanceof HTMLSelectElement&&(i=parseInt(r.value,10));var o=0,r=n(document,"rename-start-number");r instanceof HTMLInputElement&&(o=parseInt(r.value,10));for(var s=n(document,"bulk-rename-tree").querySelectorAll("input"),l=0;l<s.length;++l){var r=s[l];if(r instanceof HTMLInputElement&&""===r.value){r.value=("0000"+o.toString()).slice(-i);var c=a.get(r);c&&(c.text=r.value),++o}}t.favorite.bulkRename(t.bulkRenameData)},!1),n(document,"export-favorites-pfv").addEventListener("click",function(i){saveAs(new Blob([t.favorite.pfv],{type:"text/plain"}),e.cleanForFilename(t.favorite.rootName)+".pfv")},!1),n(document,"export-favorites-zip").addEventListener("click",function(e){t.exportZIP(!1)},!1),n(document,"export-favorites-zip-filter-solo").addEventListener("click",function(e){t.exportZIP(!0)},!1);for(var s=document.querySelectorAll("[data-export-faview]"),l=0;l<s.length;++l)!function(e){e.addEventListener("click",function(i){return"prima"===e.getAttribute("data-export-faview")?void t.exportFaviewPRIMA():void t.exportFaview("standard"===e.getAttribute("data-export-faview"),"flat"===e.getAttribute("data-structure"))})}(s[l]);n(document,"export-tiled").addEventListener("click",function(e){var i=n(document,"tiled-export-naming-rule");if(!(i instanceof HTMLSelectElement))throw new Error("#tiled-export-naming-rule is not SELECT");var r=n(document,"tiled-export-format");if(!(r instanceof HTMLSelectElement))throw new Error("#tiled-export-format is not SELECT");var a=n(document,"tiled-export-usetsx");if(!(a instanceof HTMLSelectElement))throw new Error("#tiled-export-usetsx is not SELECT");var o=n(document,"tiled-export-compress");if(!(o instanceof HTMLSelectElement))throw new Error("#tiled-export-compress is not SELECT");var s=i.value.split(","),l=r.value.split(","),c="yes"===a.value,d="deflate"===o.value;if(2!==s.length||2!==l.length)throw new Error("tiled export form data is invalid");t.exportFaviewTiled(s[0],"flat"===s[1],l[0],l[1],d,c)},!1),n(document,"export-layer-structure").addEventListener("click",function(e){saveAs(new Blob([t.layerRoot.text],{type:"text/plain"}),"layer.txt")},!1);for(var c=document.querySelectorAll(".psdtool-toggle-tree-faview"),l=0;l<c.length;++l)c[l].addEventListener("click",function(e){return t.toggleTreeFaview()},!1);this.faviewSettingDialog=new f(this.favorite),this.faviewSettingDialog.onUpdate=function(){return t.favorite.updateLocalStorage()}},e.prototype.toggleTreeFaview=function(e){var t=n(document,"layer-tree-pane");void 0===e&&(e=!t.classList.contains("faview-active")),e?(t.classList.add("faview-active"),this.faviewOnRootChanged()):t.classList.remove("faview-active")},e.prototype.startFaview=function(){var e=this;if(this.resized(),!this.faview){var t=void 0,i=void 0,r=n(document,"faview-root-node");if(!(r instanceof HTMLSelectElement))throw new Error("element not found: #faview-root-node");t=r;var r=n(document,"faview-tree");if(!(r instanceof HTMLUListElement))throw new Error("element not found: #faview-tree");i=r,this.faview=new o.Faview(this.favorite,t,i),this.faview.onRootChanged=function(){return e.faviewOnRootChanged()},this.faview.onChange=function(t){return e.faviewOnChange(t)}}n(document,"layer-tree-toolbar").classList.remove("hidden"),this.faview.start(),this.needRefreshFaview=!1,0===this.faview.roots?this.endFaview():this.resized()},e.prototype.refreshFaview=function(){this.faview&&!this.faview.closed||this.startFaview(),this.needRefreshFaview&&(this.faview.refresh(),this.needRefreshFaview=!1,0===this.faview.roots&&this.endFaview())},e.prototype.faviewOnRootChanged=function(){this.leaveReaderMode();for(var e=0,t=this.faview.getActive();e<t.length;e++){var i=t[e];i.data&&this.layerRoot.deserializePartial(void 0,i.data.value,this.favorite.getFirstFilter(i))}this.redraw()},e.prototype.faviewOnChange=function(e){e.data&&this.leaveReaderMode(e.data.value,this.favorite.getFirstFilter(e))},e.prototype.endFaview=function(){n(document,"layer-tree-toolbar").classList.add("hidden"),this.toggleTreeFaview(!1),this.resized(),this.faview.close()},e.prototype.exportZIP=function(t){var i=this,n=[],r=[],a=[],o=function(t){for(var s=0,l=t;s<l.length;s++){var c=l[s];switch("string"==typeof c&&(c=i.favorite.get(c)),r.push(e.cleanForFilename(c.text.replace(/^\*/,""))),c.type){case"root":r.pop(),c.children&&c.children.length&&o(c.children),r.push("");break;case"folder":n.unshift(c),c.children&&c.children.length&&o(c.children),n.shift();break;case"filter":n.unshift(c),c.children&&c.children.length&&o(c.children),n.shift();break;case"item":for(var d=void 0,h=0,u=n;h<u.length;h++){var f=u[h];if("filter"===f.type){d=f.data?f.data.value:"";break}}d?a.push({name:r.join("\\")+".png",value:c.data?c.data.value:"",filter:d}):a.push({name:r.join("\\")+".png",value:c.data?c.data.value:""});break;default:throw new Error("unknown item type: "+c.type)}r.pop()}},s=this.favorite.json;o(s);var l=this.layerRoot.serialize(!0),d=new c.Zipper,u=new h("Exporting...",""),f=!1,p=function(e,t){d.dispose(function(e){}),console.error(t),f||alert(e+": "+t),u.close()};window.addEventListener("unload",function(){f=!0},!1);var v=0,m=function(){return++v<a.length+1?void u.update(v/(a.length+1),1===v?"drawing...":"("+v+"/"+a.length+") "+a[v-1].name):(i.layerRoot.deserialize(l),u.update(1,"building a zip..."),void d.generate(function(t){u.close(),saveAs(t,e.cleanForFilename(i.favorite.rootName)+".zip"),d.dispose(function(e){})},function(e){return p("cannot create a zip archive",e)}))};d.init(function(){d.addCompress("favorites.pfv",new Blob([i.favorite.pfv],{type:"text/plain; charset=utf-8"}),m,function(e){return p("cannot write pfv to a zip archive",e)});var n=0,r=function(){"filter"in a[n]?i.layerRoot.deserializePartial(t?"":l,a[n].value,a[n].filter||""):i.layerRoot.deserialize(a[n].value),i.render(function(t,i){1===t&&e.canvasToBlob(i).then(function(e){d.add(a[n].name,e,m,function(e){return p("cannot write png to a zip archive",e)}),++n<a.length&&setTimeout(r,0)})})};r()},function(e){return p("cannot create a zip archive",e)})},e.prototype.exportFaview=function(t,i){var n=this,r=new c.Zipper,a=new h("Exporting...",""),o=!1,s=function(e,t){r.dispose(function(e){}),a.close(),console.error(t),o||alert(e+": "+t)};window.addEventListener("unload",function(){o=!0},!1),r.init(function(){n.enumerateFaview(function(n,o,l,c,d){var h=n.map(function(i,n){return e.cleanForFilename((n&&t?i.caption+"-":"")+i.name)}).join(i?"_":"\\")+".png";e.canvasToBlob(o).then(function(e){r.add(h,e,d,function(e){return s("cannot write png to a zip archive",e)})}),a.update(l/c,h)},function(){a.update(1,"building a zip..."),r.generate(function(e){saveAs(e,"simple-view.zip"),r.dispose(function(e){}),a.close()},function(e){return s("cannot create a zip archive",e)})})},function(e){return s("cannot create a zip archive",e)})},e.prototype.exportFaviewTiled=function(t,i,n,r,a,o){var s,d=this;switch(n){case"tmx":s="tmx";break;case"json":s="json";break;case"js":s="js";break;case"raw":switch(r){case"csv":s="csv";break;case"bin":s="bin"}}var u=new c.Zipper,f=new l.Tileder,p=new h("Exporting...",""),v=!1,m=function(e,t){u.dispose(function(e){}),p.close(),console.error(t),v||alert(e+": "+t)};window.addEventListener("unload",function(){v=!0},!1);var g=0,w=0,y=!1,b=function(){++w,y&&w===g&&(p.update(1,"building a zip..."),u.generate(function(e){saveAs(e,"tiled.zip"),u.dispose(function(e){}),p.close()},function(e){return m("cannot create a zip archive",e)}))};u.init(function(){d.enumerateFaview(function(n,r,a,o,s){var l=n.map(function(i,n){switch(t){case"standard":return e.cleanForFilename((n?i.caption+"-":"")+i.name);case"compact":return e.cleanForFilename(i.name);case"index":return i.index}}).join(i?"_":"\\");p.update(a/o/2,l),f.add(l,r,s)},function(){f.finish("binz"===r,function(t,i,n){++g,e.canvasToBlob(t.getImage(document)).then(function(e){u.add(t.filename+".png",e,function(){p.update(.5,t.filename+".png"),b(),o&&(++g,u.addCompress(t.filename+".tsx",new Blob([t["export"]()],{type:"text/xml; charset=utf-8"}),function(){p.update(.5,t.filename+".tsx"),b()},function(e){return m("cannot write tsx to a zip archive",e)}))},function(e){return m("cannot write png to a zip archive",e)})})},function(e,t,i){var l=a?u.addCompress:u.add;l=l.bind(u),++g,l(e.name+"."+s,e["export"](n,r,o),function(){p.update(t/i/2+.5,e.name+"."+s),b()},function(e){return m("cannot write file to a zip archive",e)})},function(){++g,y=!0,b()})});var c={format:s,flatten:i,namingStyle:t,roots:d.faview.items.map(function(t){return{name:t.name,captions:t.selects.map(function(t){return e.cleanForFilename(t.caption)}),selects:t.selects.map(function(t){return t.items.map(function(t){return e.cleanForFilename(t.name)})})}})};"js"===n?(++g,u.addCompress("faview.js",new Blob(["onFaviewLoaded(",JSON.stringify(c),");"],{type:"text/javascript; charset=utf-8"}),function(){return b()},function(e){return m("cannot write faview.js to a zip archive",e)}),++g,u.addCompress("viewer.html",new Blob([l.getViewer()],{type:"text/html; charset=utf-8"}),function(){return b()},function(e){return m("cannot write viewer.html to a zip archive",e)})):(++g,u.addCompress("faview.json",new Blob([JSON.stringify(c)],{type:"application/json; charset=utf-8"}),function(){return b()},function(e){return m("cannot write faview.json to a zip archive",e)}))},function(e){return m("cannot create a zip archive",e)})},e.prototype.exportFaviewPRIMA=function(){var t=new l.Tileder,i=new h("Exporting...",""),n=0,r=0,a=16,o=this.faview.items.map(function(t){return{name:t.name,captions:t.selects.map(function(t){return e.cleanForFilename(t.caption)}),selects:t.selects.map(function(t){return t.items.map(function(t){return e.cleanForFilename(t.name)})})}});this.enumerateFaview(function(e,a,o,s,l){0===n&&(n=a.width,r=a.height),i.update(o/s,o+"/"+s),t.add("",a,l)},function(){var e=new d.Primar(n,r,a);t.finish(!1,function(t,n,r){i.update(n/r,"compressing tsxes..."),e.addTsx(t)},function(t,n,r){i.update(n/r,"compressing images..."),0===n&&e.setImageTotal(r),e.addImage(t)},function(){i.update(1,"building a file... (sometimes it takes a long time)"),e.generate(o).then(function(e){saveAs(e,"tiled.prima"),i.close()})})})},e.prototype.enumerateFaview=function(e,t){var i=this;this.refreshFaview();for(var n=this.faview.items,r=0,a=0,o=n;a<o.length;a++){var s=o[a];if(s.selects.length){for(var l=1,c=0,d=s.selects;c<d.length;c++){var h=d[c];l*=h.items.length}r+=l}}if(r){var u,f=this.layerRoot.serialize(!0),p=0,v=[],m=function(t,n,a){var o=u[t],s=o.items[n];v.push({caption:o.caption,name:s.name,index:n});var l=i.favorite.get(s.value);i.layerRoot.deserializePartial(void 0,l.data?l.data.value:"",i.favorite.getFirstFilter(l));var c=function(){v.pop(),n<o.items.length-1?m(t,n+1,a):a()};t<u.length-1?u[t+1].items.length?m(t+1,0,c):c():i.render(function(t,i){1===t&&e(v,i,++p,r,c)})},g=function(e,t){var i=n[e];v.push({caption:"root",name:i.name,index:e}),u=i.selects;var r=function(){v.pop(),++e>=n.length?t():g(e,t)};u.length&&u[0].items.length?m(0,0,r):r()};g(0,function(){i.layerRoot.deserialize(f),t()})}},e.prototype.initUI=function(){var t=this;this.optionAutoTrim=e.getInputElement("#option-auto-trim"),this.optionSafeMode=e.getInputElement("#option-safe-mode"),this.optionUseOldResizer=e.getInputElement("#option-use-old-resizer");var i=document.querySelectorAll(".psdtool-tab-toolbar");this.sideBody=n(document,"side-body"),this.sideBody.addEventListener("scroll",function(e){for(var n=t.sideBody.scrollTop+"px",r=0;r<i.length;++r){var a=i[r];a instanceof HTMLElement&&(a.style.top=n)}},!1),this.sideBodyScrollPos={},jQuery('a[data-toggle="tab"]').on("hide.bs.tab",function(e){var i=e.target.getAttribute("href");i&&(t.sideBodyScrollPos[i]={left:t.sideBody.scrollLeft,top:t.sideBody.scrollTop})}).on("shown.bs.tab",function(e){var i=e.target.getAttribute("href");i&&(i in t.sideBodyScrollPos&&(t.sideBody.scrollLeft=t.sideBodyScrollPos[i].left,t.sideBody.scrollTop=t.sideBodyScrollPos[i].top),t.resized())}),jQuery('a[data-toggle="tab"][href="#layer-tree-pane"]').on("show.bs.tab",function(e){t.leaveReaderMode(),t.refreshFaview()}),this.initFavoriteUI(),this.previewBackground=n(document,"preview-background");var r=n(document,"preview");if(!(r instanceof HTMLCanvasElement))throw new Error("element not found: #preview");this.previewCanvas=r,this.previewCanvas.addEventListener("dragstart",function(e){var i=t.previewCanvas.toDataURL(),n=t.previewCanvas.getAttribute("data-filename");if(n){var r=i.indexOf(";");i=i.substring(0,r)+";filename="+encodeURIComponent(n)+i.substring(r)}try{e.dataTransfer.setData("text",i),e.dataTransfer.setData("text/uri-list",i),e.dataTransfer.setData("text/plain",i)}catch(e){}},!1),jQuery("#main").on("splitpaneresize",function(e){return t.resized()}).splitPane();var a=n(document,"flip-x");a instanceof HTMLInputElement&&(this.flipX=a),jQuery(this.flipX).on("change",function(e){return t.redraw()});var o=n(document,"flip-y");o instanceof HTMLInputElement&&(this.flipY=o),jQuery(this.flipY).on("change",function(e){return t.redraw()});var s=n(document,"fixed-side");if(!(s instanceof HTMLSelectElement))throw new Error("element not found: #fixed-side");this.fixedSide=s,this.fixedSide.addEventListener("change",function(e){return t.redraw()},!1);var l;this.maxPixels=e.getInputElement("#max-pixels"),this.maxPixels.addEventListener("blur",function(i){var n=e.normalizeNumber(t.maxPixels.value);
n!==l&&(l=n,t.maxPixels.value=n,t.redraw())},!1),this.seqDlPrefix=e.getInputElement("#seq-dl-prefix"),this.seqDlNum=e.getInputElement("#seq-dl-num");var c=n(document,"seq-dl");if(!(c instanceof HTMLButtonElement))throw new Error("element not found: #seq-dl");this.seqDl=c,this.seqDl.addEventListener("click",function(i){var n=t.seqDlPrefix.value;if(""===t.seqDlNum.value)return void t.save(n+".png");var r=parseInt(e.normalizeNumber(t.seqDlNum.value),10);0>r&&(r=0),t.save(n+("0000"+r).slice(-4)+".png"),t.seqDlNum.value=(r+1).toString()},!1),Mousetrap.pause()},e.prototype.redraw=function(){var e=this;this.seqDl.disabled=!0,this.render(function(t,i){e.previewBackground.style.width=i.width+"px",e.previewBackground.style.height=i.height+"px",e.seqDl.disabled=1!==t,e.previewCanvas.draggable=1===t,setTimeout(function(){e.previewCanvas.width=i.width,e.previewCanvas.height=i.height;var t=e.previewCanvas.getContext("2d");if(!t)throw new Error("cannot get CanvasRenderingContext2D");t.drawImage(i,0,0)},0)}),this.layerRoot.updateClass()},e.prototype.save=function(t){e.canvasToBlob(this.previewCanvas).then(function(e){saveAs(e,t)})},e.prototype.loadRenderer=function(e){this.renderer=new a.Renderer(e);var t=this.layerRoot.nodes,i=this.renderer.nodes;for(var n in i)i.hasOwnProperty(n)&&!function(e,t){e.getVisibleState=function(){return t.checked}}(i[n],t[n])},e.prototype.render=function(e){var t=this.optionAutoTrim.checked,i=this.optionUseOldResizer.checked,n=t?this.renderer.Width:this.renderer.CanvasWidth,r=t?this.renderer.Height:this.renderer.CanvasHeight,a=parseInt(this.maxPixels.value,10),o=1;switch(this.fixedSide.value){case"w":n>a&&(o=a/n);break;case"h":r>a&&(o=a/r)}(1>n*o||1>r*o)&&(o=n>r?1/r:1/n);var s,l;this.flipX.checked?this.flipY.checked?(s=3,l=3):(s=1,l=1):this.flipY.checked?(s=2,l=2):(s=0,l=0),this.layerRoot.flip!==s&&(this.layerRoot.flip=s),this.renderer.render(o,t,l,i,e)},e.prototype.initLayerTree=function(){var e=this,t=n(document,"layer-tree");if(!(t instanceof HTMLUListElement))throw new Error("#layer-tree is not an UL element");this.layerTree=t,this.layerTree.innerHTML="",this.layerTree.addEventListener("click",function(t){var i=t.target;if(i instanceof HTMLInputElement&&i.classList.contains("psdtool-layer-visible")){var n=e.layerRoot.nodes[parseInt(i.getAttribute("data-seq")||"0",10)];i.checked&&(e.lastCheckedNode=n);for(var r=n.parent;!r.isRoot;r=r.parent)r.checked=!0;n.clippedBy&&(n.clippedBy.checked=!0),e.redraw()}},!1)},e.prototype.loadLayerTree=function(e){this.layerTree||this.initLayerTree(),this.layerRoot=new s.LayerTree(this.optionSafeMode.checked,this.layerTree,e)},e.prototype.enterReaderMode=function(e,t,i){this.previewBackground.classList.contains("reader")||(this.previewBackground.classList.add("reader"),this.normalModeState=this.layerRoot.serialize(!0)),t?this.layerRoot.deserializePartial(this.normalModeState,e,t):this.layerRoot.deserialize(e),i&&this.previewCanvas.setAttribute("data-filename",i),this.redraw()},e.prototype.leaveReaderMode=function(e,t){if(this.previewBackground.classList.contains("reader")&&this.previewBackground.classList.remove("reader"),e)this.previewCanvas.removeAttribute("data-filename"),t?this.normalModeState?this.layerRoot.deserializePartial(this.normalModeState,e,t):this.layerRoot.deserializePartial(void 0,e,t):this.layerRoot.deserialize(e);else{if(!this.normalModeState)return;this.previewCanvas.removeAttribute("data-filename"),this.layerRoot.deserialize(this.normalModeState)}this.redraw(),this.normalModeState=""},e.getInputElement=function(e){var t=document.querySelector(e);if(t instanceof HTMLInputElement)return t;throw new Error("element not found "+e)},e.cleanForFilename=function(e){return e.replace(/[\x00-\x1f\x22\x2a\x2f\x3a\x3c\x3e\x3f\x7c\x7f]+/g,"_")},e.formateDate=function(e){var t=e.getFullYear()+"-";return t+=("0"+(e.getMonth()+1)).slice(-2)+"-",t+=("0"+e.getDate()).slice(-2)+" ",t+=("0"+e.getHours()).slice(-2)+":",t+=("0"+e.getMinutes()).slice(-2)+":",t+=("0"+e.getSeconds()).slice(-2)},e.extractFilePrefixFromUrl=function(e){return e=e.replace(/#[^#]*$/,""),e=e.replace(/\?[^?]*$/,""),e=e.replace(/^.*?([^\/]+)$/,"$1"),e=e.replace(/\..*$/i,"")+"_"},e.initDropZone=function(e,t){var i=n(document,e);i.addEventListener("dragenter",function(e){return i.classList.add("psdtool-drop-active"),e.preventDefault(),e.stopPropagation(),!1},!1),i.addEventListener("dragover",function(e){return i.classList.add("psdtool-drop-active"),e.preventDefault(),e.stopPropagation(),!1},!1),i.addEventListener("dragleave",function(e){return i.classList.remove("psdtool-drop-active"),e.preventDefault(),e.stopPropagation(),!1},!1),i.addEventListener("drop",function(e){return i.classList.remove("psdtool-drop-active"),e.dataTransfer.files.length>0&&t(e.dataTransfer.files),e.preventDefault(),e.stopPropagation(),!1},!1);var r=i.querySelector("input[type=file]");if(r instanceof HTMLInputElement){var a=r;r.addEventListener("change",function(e){a.files&&a.files.length&&t(a.files),a.value=""},!1)}},e.canvasToBlob=function(e){return new Promise(function(t,i){if(HTMLCanvasElement.prototype.toBlob)return void e.toBlob(function(e){return e?void t(e):void i("could not get Blob")});for(var n=atob(e.toDataURL().split(",")[1]),r=new Uint8Array(n.length),a=0,o=n.length;o>a;++a)r[a]=n.charCodeAt(a);t(new Blob([r],{type:"image/png"}))})},e.normalizeNumber=function(e){return e.replace(/[\uff10-\uff19]/g,function(e){return(e[0].charCodeAt(0)-65296).toString()})},e.loadAsBlobCrossDomain=function(t,i){var n=m.deferred();if("https:"===location.protocol&&"http:"===i.substring(0,5))return setTimeout(function(){return n.reject(new Error("cannot access to the insecure content from HTTPS."))},0),n.promise;var r,a=document.createElement("iframe"),o=setTimeout(function(){r&&(r.onmessage=void 0),document.body.removeChild(a),n.reject(new Error("something went wrong"))},2e4);return a.setAttribute("sandbox","allow-scripts allow-same-origin"),a.onload=function(s){var l=new MessageChannel;r=l.port1,r.onmessage=function(r){if(o&&(clearTimeout(o),o=0),r.data&&r.data.type)switch(r.data.type){case"complete":return document.body.removeChild(a),r.data.data?(t(1),void n.resolve({buffer:r.data.data,name:r.data.name?r.data.name:e.extractFilePrefixFromUrl(i)})):void n.reject(new Error("something went wrong"));case"error":return document.body.removeChild(a),void n.reject(new Error(r.data.message?r.data.message:"could not receive data"));case"progress":return void("loaded"in r.data&&"total"in r.data&&t(r.data.loaded/r.data.total))}},a.contentWindow.postMessage(location.protocol,i.replace(/^([^:]+:\/\/[^\/]+).*$/,"$1"),[l.port2])},a.src=i,a.style.display="none",document.body.appendChild(a),n.promise},e.loadAsBlobFromString=function(t,i){if("xd:"===i.substring(0,3))return this.loadAsBlobCrossDomain(t,i.substring(3));var n=m.deferred(),r=new XMLHttpRequest;return r.open("GET",i),r.responseType="blob",r.onload=function(a){return t(1),200===r.status?void n.resolve({buffer:r.response,name:e.extractFilePrefixFromUrl(i)}):void n.reject(new Error(r.status+" "+r.statusText))},r.onerror=function(e){console.error(e),n.reject(new Error("could not receive data"))},r.onprogress=function(e){return t(e.loaded/e.total)},r.send(null),n.promise},e.loadAsBlob=function(e,t){if(t instanceof File){var i=t,n=m.deferred();return setTimeout(function(){n.resolve({buffer:i,name:i.name.replace(/\..*$/i,"")+"_"})},0),n.promise}return this.loadAsBlobFromString(e,t)},e}();i.Main=p,function(){var e=Mousetrap.prototype.stopCallback;Mousetrap.prototype.stopCallback=function(t,i,n){return this.paused||!i.classList.contains("psdtool-layer-visible")&&!i.classList.contains("psdtool-faview-select")?e.call(this,t,i,n):!1},Mousetrap.init()}();var v=new p;document.addEventListener("DOMContentLoaded",function(e){return v.init()},!1)},{"./favorite":6,"./layertree":7,"./primar":10,"./renderer":11,"./tileder":12,"./zipper":13,"es6-promise":1}],10:[function(e,t,i){"use strict";var n=e("./lz4s"),r=function(){function e(e,t,i){var r=this;this.width=e,this.height=t,this.tileSize=i,this.bufferSize=1024*(this.width*this.height<16777216?1:4)*1024,this.tsxes=[],this.imageWriter=new n.Streamer(this.bufferSize),this.skipped=0,this.pos=0,this.useSubFilter=!1,this.imageIndex=0,this.imageWriter.onFilter=function(e){return r.imageWriterFilter(e)}}return e.prototype.addTsx=function(e){var t=new n.Streamer(4194304),i=0,r=0,a=0,o=0;t.onFilter=function(e){for(var t=i,n=r,s=a,l=o,c=0,d=e.byteLength;d>c;)e[c]-=t,t+=e[c++],e[c]-=n,n+=e[c++],e[c]-=s,s+=e[c++],e[c]-=l,l+=e[c++];i=t,r=n,a=s,o=l},t.addUint8Array(new Uint8Array(e.data)),this.tsxes.push(t.finish().then(function(t){var i=t[0],n=t[1],r=new ArrayBuffer(8),a=new DataView(r);return a.setUint32(0,e.width,!0),a.setUint32(4,e.height,!0),i.unshift(r),[i,n+8]}))},e.prototype.imageWriterFilter=function(e){if(this.useSubFilter){if(!this.firstMap)throw new Error("firstMap is not ready");var t=this.firstMap.byteLength;if(this.skipped<t){if(this.skipped+e.byteLength<=t)return void(this.skipped+=e.byteLength);var i=t-this.skipped;e=new Uint8Array(e.buffer,e.byteOffset+i,e.length-i),this.skipped+=i}for(var n=new DataView(this.firstMap.buffer,this.firstMap.byteOffset,this.firstMap.byteLength),r=new DataView(e.buffer,e.byteOffset,e.byteLength),a=r.byteLength,o=0,s=this.pos;a>o;){for(var l=0,c=Math.min(a-o,t-s);c>l;o+=4,s+=4,l+=4)r.setInt32(o,r.getInt32(o,!0)-n.getInt32(s,!0),!0);s===t&&(s=0)}this.pos=s}},e.prototype.setImageTotal=function(e){this.imageIndices=new DataView(new ArrayBuffer(4*e))},e.prototype.addImage=function(e){this.imageIndices&&this.imageIndices.setUint32(4*e.index,this.imageIndex++,!0);var t=new Int32Array(e.data);if(!this.firstMap)for(var i=this.firstMap=new Int32Array(t.length),n=0,r=t.length;r>n;++n)i[n]=t[n];this.imageWriter.addInt32Array(t)},e.prototype.generate=function(e){var t=this,i=this.imageWriter.finish().then(function(e){for(var t=e[0],i=e[1],r=new n.Streamer(4194304),a=0,o=t;a<o.length;a++){var s=o[a];r.addUint8Array(new Uint8Array(s))}return r.finish().then(function(e){var t=e[0],n=e[1];return[i,t,n]})});return Promise.all([Promise.all(this.tsxes),i]).then(function(i){var n=i[0],r=i[1],a=r[0],o=r[1],s=r[2],l=t.imageIndices;if(!l)throw new Error("image indexes is not initialized.");for(var c=8+l.byteLength+12+s,d=0,h=n;d<h.length;d++){var u=h[d],f=u[1];c+=8+f}var p=[],v=new Blob([JSON.stringify(e)],{type:"application/json; charset=utf-8"}),m=new DataView(new ArrayBuffer(34));m.setUint32(0,1179011410,!0),m.setUint32(4,26+v.size+c,!0),m.setUint32(8,1095650884,!0),m.setUint32(12,10,!0),m.setUint32(16,t.width,!0),m.setUint32(20,t.height,!0),m.setUint16(24,t.tileSize,!0),m.setUint32(26,1314018384,!0),m.setUint32(30,v.size,!0),p.push(m.buffer,v);for(var g=0,w=n;g<w.length;g++){var y=w[g],b=y[0],f=y[1],m=new DataView(new ArrayBuffer(8));m.setUint32(0,541543753,!0),m.setUint32(4,f,!0),p.push(m.buffer),Array.prototype.push.apply(p,b)}var m=new DataView(new ArrayBuffer(8));m.setUint32(0,1347241033,!0),m.setUint32(4,l.byteLength,!0),p.push(m.buffer,l.buffer);var m=new DataView(new ArrayBuffer(12));return m.setUint32(0,1162627412,!0),m.setUint32(4,s+4,!0),m.setUint32(8,a,!0),p.push(m.buffer),Array.prototype.push.apply(p,o),new Blob(p,{type:"application/octet-binary"})})},e}();i.Primar=r},{"./lz4s":8}],11:[function(e,t,i){"use strict";var n,r=e("./blend/blend"),a=e("./downscaler");!function(e){e[e.NoFlip=0]="NoFlip",e[e.FlipX=1]="FlipX",e[e.FlipY=2]="FlipY",e[e.FlipXY=3]="FlipXY"}(n=i.FlipType||(i.FlipType={}));var o=function(){function e(e){var t=this;if(this.buffer=document.createElement("canvas"),this._visible=!1,this.getVisibleState=function(){return t._visible},this.state="",this.nextState="",this.children=[],this.clipping=!1,this.clip=[],this.x=0,this.y=0,this.width=0,this.height=0,this.maskX=0,this.maskY=0,this.maskWidth=0,this.maskHeight=0,this.maskDefaultColor=0,this.parent=this,!e)return void(this.id=-1);this.id=e.SeqID;var i=e.Width,n=e.Height;0>=i*n||(this.buffer=document.createElement("canvas"),this.buffer.width=i,this.buffer.height=n,this.image=e.Canvas,this.x=e.X,this.y=e.Y,this.width=i,this.height=n,this.mask=e.Mask,this.maskX=e.MaskX,this.maskY=e.MaskY,this.maskWidth=e.MaskWidth,this.maskHeight=e.MaskHeight,this.maskDefaultColor=e.MaskDefaultColor,this.clipping=e.Clipping,this.blendMode=e.BlendMode,this.opacity=e.Opacity,this._visible=e.Visible,this.blendClippedElements=e.BlendClippedElements)}return Object.defineProperty(e.prototype,"visible",{get:function(){return this.getVisibleState()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stateHash",{get:function(){return e.calcHash(this.state).toString(16)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nextStateHash",{get:function(){return e.calcHash(this.nextState).toString(16)},enumerable:!0,configurable:!0}),e.calcHash=function(e){if(0===e.length)return 0;for(var t,i=0,n=0;n<e.length;++n)t=e.charCodeAt(n),i=(i<<5)-i+t,i|=0;return i},e}();i.Node=o;var s=function(){function e(e){this.psd=e,this.canvas=document.createElement("canvas"),this.root=new o(void 0),this.nodes={},this.buildTree(this.root,e),this.root.buffer=document.createElement("canvas"),this.root.buffer.width=e.Width,this.root.buffer.height=e.Height,this.registerClippingGroup(this.root)}return e.prototype.draw=function(e,t,i,n,a,o){switch(o){case"clear":case"copy":case"destination":case"source-over":case"destination-over":case"source-in":case"destination-in":case"source-out":case"destination-out":case"source-atop":case"destination-atop":case"xor":return e.globalAlpha=a,e.globalCompositeOperation=o,void e.drawImage(t,i,n)}var s=t.getContext("2d");if(!s)throw new Error("cannot get CanvasRenderingContext2D");r.blend(e,s,i,n,t.width,t.height,a,o)},e.prototype.clear=function(e){e.globalAlpha=1,e.globalCompositeOperation="source-over",e.clearRect(0,0,e.canvas.width,e.canvas.height)},Object.defineProperty(e.prototype,"Width",{get:function(){return this.psd.Width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Height",{get:function(){return this.psd.Height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CanvasWidth",{get:function(){return this.psd.CanvasWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CanvasHeight",{get:function(){return this.psd.CanvasHeight},enumerable:!0,configurable:!0}),e.prototype.buildTree=function(e,t){for(var i,n=0,r=t.Children;n<r.length;n++){var a=r[n];i=new o(a),i.parent=e,this.buildTree(i,a),e.children.push(i),this.nodes[i.id]=i}},e.prototype.registerClippingGroup=function(e){for(var t=[],i=void 0,n=e.children.length-1;n>=0;--n)if(i=e.children[n],this.registerClippingGroup(i),i.clipping)t.unshift(i);else{if(t.length){for(var r=0,a=t;r<a.length;r++){var o=a[r];o.clippedBy=i}i.clippingBuffer=document.createElement("canvas"),i.clippingBuffer.width=i.width,i.clippingBuffer.height=i.height,Array.prototype.push.apply(i.clip,t)}t=[]}},e.prototype.render=function(e,t,i,n,r){var a=this,o=Date.now();this.root.nextState="";for(var s=0,l=this.root.children;s<l.length;s++){var c=l[s];c.clipping&&"pass-through"!==c.blendMode||this.calculateNextState(c,c.opacity/255,c.blendMode)&&(this.root.nextState+=c.nextStateHash+"+")}var d=this.root.buffer;if(this.root.state!==this.root.nextState){var h=d.getContext("2d");if(!h)throw new Error("cannot get CanvasRenderingContext2D");this.clear(h);for(var u=0,f=this.root.children;u<f.length;u++){var c=f[u];c.clipping&&"pass-through"!==c.blendMode||this.drawLayer(h,c,-this.psd.X,-this.psd.Y,c.opacity/255,c.blendMode)}this.root.state=this.root.nextState}console.log("rendering: "+(Date.now()-o)),o=Date.now(),this.downScale(d,e,n,function(n,s){console.log("scaling: "+(Date.now()-o)+"(phase:"+n+")");var l=t?a.psd.Width:a.psd.CanvasWidth,c=t?a.psd.Height:a.psd.CanvasHeight,d=a.canvas;d.width=0|l*e,d.height=0|c*e;var h=d.getContext("2d");if(!h)throw new Error("cannot get CanvasRenderingContext2D");switch(a.clear(h),h.save(),i){case 1:h.translate(d.width,0),h.scale(-1,1);break;case 2:h.translate(0,d.height),h.scale(1,-1);break;case 3:h.translate(d.width,d.height),h.scale(-1,-1)}h.drawImage(s,t?0:0|a.psd.X*e,t?0:0|a.psd.Y*e),h.restore(),r(n,d)})},e.prototype.downScale=function(e,t,i,n){if(1===t)return void n(1,e);var r=new a.DownScaler(e,t,i);n(0,r.fast()),setTimeout(function(){return r.beautifulWorker(function(e){return n(1,e)})},0)},e.prototype.calculateNextState=function(e,t,i){if(!e.visible||0===t)return!1;if(e.nextState="",e.children.length){"pass-through"===i&&(e.nextState+=e.parent.nextStateHash+"+");for(var n=0;n<e.children.length;++n){var r=e.children[n];r.clipping&&"pass-through"!==r.blendMode||this.calculateNextState(e.children[n],r.opacity/255,r.blendMode)&&(e.nextState+=e.children[n].nextStateHash+"+")}}else e.image&&(e.nextState=e.id.toString());if(e.mask&&(e.nextState+="|lm"),!e.clip.length||"pass-through"===i)return!0;if(e.nextState+="|cm"+(e.blendClippedElements?"1":"0")+":",e.blendClippedElements){for(var n=0,a=void 0;n<e.clip.length;++n)a=e.clip[n],this.calculateNextState(e.clip[n],a.opacity/255,a.blendMode)&&(e.nextState+=e.clip[n].nextStateHash+"+");return!0}e.nextState+=Date.now()+"_"+Math.random()+":";for(var o=0,s=e.clip;o<s.length;o++){var a=s[o];this.calculateNextState(a,1,"source-over")&&(e.nextState+=a.nextStateHash+"+")}return!0},e.prototype.drawLayer=function(e,t,i,n,r,a){if(!t.visible||0===r||!t.children.length&&!t.image)return!1;var o=t.buffer;if(t.state===t.nextState)return"pass-through"===a?this.draw(e,o,i+t.x,n+t.y,1,"copy-all"):this.draw(e,o,i+t.x,n+t.y,r,a),!0;var s=o.getContext("2d");if(!s)throw new Error("cannot get CanvasRenderingContext2D for BackBuffer");if(this.clear(s),t.children.length)if("pass-through"===a){this.draw(s,t.parent.buffer,-i-t.x,-n-t.y,1,"source-over");for(var l=0,c=t.children;l<c.length;l++){var d=c[l];d.clipping&&"pass-through"!==d.blendMode||this.drawLayer(s,d,-t.x,-t.y,d.opacity*r/255,d.blendMode)}}else for(var h=0,u=t.children;h<u.length;h++){var d=u[h];d.clipping&&"pass-through"!==d.blendMode||this.drawLayer(s,d,-t.x,-t.y,d.opacity/255,d.blendMode)}else t.image&&this.draw(s,t.image.canvas,0,0,1,"source-over");if(t.mask&&this.draw(s,t.mask.canvas,t.maskX-t.x,t.maskY-t.y,1,t.maskDefaultColor?"destination-out":"destination-in"),!t.clip.length||"pass-through"===a)return"pass-through"===a?this.draw(e,o,i+t.x,n+t.y,1,"copy-all"):this.draw(e,o,i+t.x,n+t.y,r,a),t.state=t.nextState,!0;var f=t.clippingBuffer;if(!f)throw new Error("clippingBuffer not found");var p=f.getContext("2d");if(!p)throw new Error("cannot get CanvasRenderingContext2D for ClipBackBuffer");if(t.blendClippedElements){this.draw(p,o,0,0,1,"copy-opaque");for(var v=0,m=t.clip;v<m.length;v++){var d=m[v];d.clipping&&"pass-through"!==d.blendMode&&this.drawLayer(p,d,-t.x,-t.y,d.opacity/255,d.blendMode)}return this.draw(p,o,0,0,1,"copy-alpha"),t.clippingBuffer=o,t.buffer=f,"pass-through"===a?this.draw(e,f,i+t.x,n+t.y,1,"copy-all"):this.draw(e,f,i+t.x,n+t.y,r,a),t.state=t.nextState,!0}this.draw(e,o,i+t.x,n+t.y,r,a),this.clear(p);for(var g=0,w=t.clip;g<w.length;g++){var d=w[g];this.drawLayer(p,d,-t.x,-t.y,1,"source-over")&&(this.draw(p,o,0,0,1,"destination-in"),this.draw(e,f,i+t.x,n+t.y,d.opacity/255,d.blendMode),this.clear(p))}return t.state=t.nextState,!0},e}();i.Renderer=s},{"./blend/blend":3,"./downscaler":5}],12:[function(e,t,i){"use strict";function n(e,t,i){for(var n=new Array(e.length),r=0;r<e.length;++r)n[r]='<tile gid="'+e[r].toString()+'"/>';return t+n.join(t+i)+i}function r(e,t,i){for(var n=new Array(e.length-e.length/(t-1)|0),r=0,a=0,o=0;r<e.length;++r,++a,++o)o+1===t&&r+1<e.length?(n[a]=e[r].toString()+i+e[++r].toString(),o=0):n[a]=e[r].toString();return n.join(",")}function a(){return'<!DOCTYPE html>\n<meta charset="utf-8">\n<title>Tiled Viewer</title>\n<style>\nbody{margin:0}\n#ui,#view{float:left}\n#selects{padding:0 0.5em}\n#selects li{padding:0;margin:0 0 1em 0;list-style:none}\n#selects select,input[type=range]{display:block;margin: 2px 0;min-width:192px}\n#view{background-image: url(data:image/gif;base64,R0lGODlhYABgAKEBAMzMzP///////////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQACgD/ACwAAAAAYABgAAAC/oxvoKuIzNyBSyYKbMDZcv15GDiKFHmaELqqkVvBjdxJoV3iqd7yrx8DzoQ1x82YQ+6UPebPGYQOpcVH0rrENrVPbtQ7BVcnV3LWvEV31V922D2+cM7ydH19b+ff+/im3MeC90dHaGc4eCQmqIfYqAjHyOc4CRlII+lnSakJyJkJiilKFEo6SlWKerq4Gtl6aRqrqiHLWut6Czu7a8uL66vbK/w7HEx8bJz8+bqc2wz8XByNPK28ee2JXah9yJ2YDb4dPvctbt49Xo5+rt7+mP7OHr9O714Jfy+fXz9v36n/j98+f6mkeeuHcGDCgASZHVQI0U9Bag8ZLpxoDZ/F+ogYq3ms2BGkQ40hSY4EWBLlSYEbW6Zk+bKhM5EzycFcKRMaTZ0ma6r0eRNoToM9ef40GhTpUIpFiR51mhTq0oxPqcW8iBOrUK1KuUr1yrQq1ahhyY6d+rFpWbQ7v3LM+nZr3K5zxbRdC/Zs3rRi+Zr1y1at3rp4CQ92CRexXMV0Gbt1XBjy4auGad2dnJiyZMB7L3Ou7Dm04M+bRfc1/Rd14NOjVXfW6Bp069msa6emfdv26ty8d/t+rRt4b+G/ZQevrDl55uWLlTdn3th5dOiPpVenHtl6duyYn3tvHLs07uLij5cfbhz9efLau0//fh3+dvnu47+HVgAAIfkEAQoAAgAsAAAAAGAAYAAAAv4MjhfLm9naQ5FNVc3NembAXeC3kZ75hGUlqie7Ri0K0ZSNwa8cS731cwQ7KdxIV0TWlDdmjrfzRYFTYZW4hCa1WenW26V+xWHr2FzGNrlrcJv8RsfVT3cdfpfn6Uf2fjPj1Gc3iFeod8jncqZotJgW6JcYSfg4R2lo+TeEiag5yRl61dko+HnqmGqqKom6+trKWimbSetpWxor46rbOwv761sLPCx8S3xsnBvMXNyc/LzsPA1NLV2Nfa1Nyi3K2D3qDSl+Sb4Zjv7tAa6ePu5eDn/eTv9eH38/b7+Pz6/fD/CfQFDyCOYz6A9hQIUDeUVjl9ChNYgLJWbrxDCjxf1t5jTiotjwY8eNID0i41iQ5EiRKVkeVNnyZEmYL11GtFkRJ4iZOk0q4ylzZdCYP4UWJfrQaFKkE5U2ZXrRaVSoKGsOtXoU6zOfS7U+9ToVbNWbV8lmNdsV7Ve1YdmOzVkW7lm5aemutdsW79udUvdyvRsybuC5g+sWBvw372HFif3SdAuUcOPIhif3pYzYomWqmBk/1tvZcc/Pi0UL3iw2tOrLrDm3Tv0acuyApiWTRi3btW7Yu3Pz/u07OOjZpVf3Hn68OHHccZgrT+48+u3po6ufpn7dum3tlbFvzw7+u/juOmuTD39+fGbu69G3V++ZfXz38+Gbf58+/4ICACH5BAEKAAMALAAAAABgAGAAAAL+TICJxqza2kvRTVDNxXnnc31eF5KTWFajxKlptMIve5oPWru5vNO3DQFShAtii/fTJZFBZZM5dEahRWmVevQ9tVPu1Zu19MRLMK5M3qa76287rJm9z+r42I7G10F3ft6/F2NmRMemxyE4R7hoBQdo+Oh2KBnpmDhpKYdZSHlZyZnZ5zmq+cmIBZp6Otio2rqq+CqLCrtZazrLSpsbu+urG+f62wtMbGzLizysXMx8jLsM3Sz9TCpaav2XHYjdff2t7R0Ozk0OuX0uXj7Ovu6eHoTeqQ7fXv8+b55vv48fyv/Pn7Bp8gLeO9gPocGEDBc6HFiNXkOIzipSs1iQ4sX8jYkm3sr4UeLDkPpGJuMoUiPIkyujtSSYkiRAlTFZ1nR5E2ZJmjtlFnkZsadNoTiJ6pzpUyFPpEOZFnV6VGBSj02lVlU61eRTq1ux8qLaFWxUr2G1jhUbFGparmfNriXbdinbt2gx5qTr1q5RvHLhrtGrFvBcwX4J10W513BexIEZD3ZcGPJhoIr7Tr5bOavlxUAvJ5bMGTPozaQ1m77quTHl0afLlkYd+vPq2aJpm8sM+7Xr1nF58/WNe3du4KyHGxeOvPdx5cl/Lwehm7l0582DT7dO/Xrx6tu121ZdO7xs8eDHm7eHPX337OzVf3/8PnL81PDJ1z9/X20BACH5BAEKAAMALAAAAABgAGAAAAL+jIGJxqza2kvRTVDPzeHi7HEhuJGTWFajmkar20qxdZoP/LG1ftuQTwEuhDlcj/dDBpVDZlG2MyalS2rT+qQdsagodPudhqvjazmr8WrFa3Lb/EZ3ZmlwvGuvs/VuPtwv93KGtzenBkjYZ5i3WCh45wPplPjXqPiISEQZSGdZienJeRi6Wap5OonKpTrIKrmaGgs72ypbS/t6q5vLm2nbS+rqizuse9kJmoy8PKrczMzoHA3tSH38jD2dXb19rf3NDe4dTj5u/mmN3q0uzl7ufi7aLv9ODyxdb/pbfJ9OH6+PWLB9AwXiAyis4C5+DBX2W/cPnsSIFAMudNjw4ET7iw/ncSyGkKDGiglHfsSI0mRJfydVimS5EmJLmC9lxvR4M1/OkAZp9rRZs4nLnziD6jTK8+JQpT6ZAiV6FGrSjlGdFpW6cWdWpFuxkuT6ldbUjE2pjk1ZluxTq1XNdmV7dqnbsHDfzp259q5WunrB4r0apq/Xv23VAhZcl6/hwmjzLo6btvHhx3YpK5bMWK5lwpAdK+w8GTPozJE1i658+rLp1aVbe2b92nVo2LNlk469DbHuzXs5o6Z9uzZu4cSDGx+N/Lft5KqXKx9+3Axz382hT++N3W/2wdsTU//efXdq8NrLczfvPad44NfRr3devXj78/TTu+fNoAAAIfkEAQoAAwAsAAAAAGAAYAAAAv6MA6l5javcgVE+ai/MlNkOcJ2IfaNZSiC5oa16wqmzugt725X80rE/a9QMOV4R2BP+lMHJ0tkkPqVRzZGZhGapW+sOedWGuWOvx/jFlofgtNhNhptDunPbrpaz8/h3P/43h6M3JVhHhxa454d418j3yDioWLgIGHnJAjmJaZjYaenpyEl6WPp5Omq6isqq2gr7KrvpShtrOytZq3vLm5u5C9wr/CuKe+yLTIy7VulcFRr93CUNPd1snU19TaiNve3dDT7+XS5uThmeTn7evo4Oyv3uHq9ezz6ff/+tbJz8vwygv4AEBxqshm8fvVT9EMJjKNDhwmAH5SnUB7GgRPyMFDde/Jixor2QbB52tEgS5cmRKxOmZDlMpMuWJmN6fDnTpkqdMIvdpDmRZ06fO5E0LHq0Z9KhS2sSVRoRaVSoGqVWpSrTadOgT5lO9XoVbFauWzlywan1a9qwa8ea7dr2p9C4Vt2CBPq27N25ZNX2ZfvXLtrAco36zXt4L1zCdQvrHYwYcGTBeBU/rgzZcuLMnDF75ju5MF2sjjd/Xhy6sWrSq8WWlqwZdmfQsSnTno269mvbhmWfvnz7t+ngxHPjBm5cuO/iyJsPT878ufPl0DUcl46d+nTe23d7bz3aNXjGrMuLNx8+Pfnz7Pll5/7+O/r16lPPt9+eawEAIfkEAQoAAwAsAAAAAGAAYAAAAv6MDal5HbvcgUoiCuzDGmfrdRw4SiFJiSkKqS0bwZXM0J9ZOie+8q8fA86ENeJNl2vskD3m7+cMRofTYvWoTE60l2bWuwV3oV9y2DyWltVndpq6hrflb2vcPsfXsXn+3uW2ISaIRhi4dOdnSLeo16iI2AfIGPlnM+lY+YgJybV5CcpzxUkaOmqaWGqkerqKKvlq6TrbWpsa+0l7qwvLK2vbC/y7K5xbrInsmTy4XNh8qFziHM1MPV2Nfa0Nnc29TWntLQ7eTf6dGW4+jl7Oft7ZDv/OSlwfbD98r5/Pb4zvv0/QsXTu1skzSC/gM3UMCzY8+DBhv4UOK0K0KBHgRPyCFztmpOgRF8iPHEnGMzkvDUqEIku2PPkypS+NNEfGZDnTZk6XO2H2lDnQZ1Cg/3QOxXk0IoqkGG8q/Ym0KE+mIaE+pbryqlShW4kqnNo16leuY71uJHvWbC61RsNqLSs2bdyaYOG+lXuXLlq9bOvibWoVMFangt0Wtnv47ODAVRc7NtwYctbEfOe2RRwZ8+TMfzlXznu58+bRhD3v6Ls39GfKqlv7XW36tevUsmvTvo06t2XbukHz3o1ldm/Wv33jBj489nHjyUkzdv5Yc2nokqdbfx6q+fXoordXxw6eO2zq0sN/Fy8cuXrm64kvd38NfXH47ZVrN1++VQEAIfkEAQoAAwAsAAAAAGAAYAAAAv6MD6l5Hbscgkw+CuylGmfrdZjIgaNZSiEKkS0bwYobq6edOiv+8rV+A+YaO2HP+CMGlcNJ01BkHqVJ59RahZ6em6uWG8XOZBXf2FxGntVp6trdFse/3m7W/pZ/0Ht2H/6nR5NHdxdWSIg3pxiIuHjIOPi4JEjWGGkpeQnJSem46YnJp0maaWozeupXmtq6qgrI+uoaC1tJezurW4v7Kcu7mws8LFzsa3vcKxqczLxM3Az9bDwdTb0CFtqZzV237a0d3m0oDj6e+E1+PrkO2v57Xa5uTj9vjy6P/45c3Z+uXw/gPXYBJyn7R3Cgu4ILFcKzBtFfvoQCK1K82NBiRvqMDyXuOzhxo8iOCEfyK0kyZMqPzrAxXPnypEqZLKWhpBkTZM14OyPe1Jmz5UygDnEWJaoR5lGhPSUi5Wg0aVSoT01WVSr16lSrTIPaHNp16demP8NmNUsVLdexMcmCZSuWp1e5cX2+pXsWbl68afX25bsWMNa/dt0anlsYsUdwWhurHRw4cd3Fk8v6jUx5r2TNmQl3xmxZ8FbIpEeb1nq48t3NnkOzBr36c2nHl2c/Pn2btmjdr23Xxv0bVe7hwYnvNt4b+PHizJc7T85btnLoyKVHd239dmrO2LvH9r699ffx4WGX9/08e3Pq69WnB6+403Xy8emr3lcAACH5BAEKAAMALAAAAABgAGAAAAL+jB+gq4jM3IFLGtosBjbhvoGfNkohSYkpCqktG8GVnJmlc9qr/vKxPwPWcLdHcXK8JD07YtP4REaVU2bPeYVmpVtq1/rDhrVjbmSZEwfVQ/La3Ta/5XFv2T7H18F5/j4Nx0EjKETIZhjocueHSNeo98io2AfoOPmHlllVCXkZySk56DkqWlpIemp6iLqqoZr4ahnbORuaetuKC6sry0vra5srvDvcW/x7HEy8bMyM7KzcLP08HU19bZ0Nuq3Z0r3IvflNOY4pfv4Vnl7+yc4KrQ7uXhtPji5/b7+eb77vj/9PH8CBAgv2I3jQYLtN9OYBq5cw4sKAEt9VgzgRYUb4hRaxYeyozWGyjw35baxYkuLJlSBJPhQJ7wPMizM91gxpsuVNlyN3+syZUqNOoC+J9jQaEylNpTaZ4lTZMihHqSiLQqXKEuvQq1aFav3adWrYqke5lvU6NmvarWjPil3102xSuUvpNrX7tO1cvXX53vWb9+1ewX0J/zUcmOxgxYUZH/4D1q3jxGolV158uXHmx5sps0XME/PnyaE1j+5cmvPp1aLiAk7tObJo2aZpq7Ydey1u2Lxdg/ZNGjhq4VF1G7fM+vhs5bWZ33aeG/lu4tOd9rZOHfp1qNmla+++3Lv48OSbjzdf/vl59emjt9/+GvzF6ng/FgAAOw==)}\n</style>\n<div id="ui">\n  <div id="root"></div>\n  <ul id="selects"></ul>\n</div>\n<canvas id="view"></canvas>\n<script>\nvar tileMapLoadedCallbacks = {};\nfunction onTileMapLoaded(name, data) {\n  if (!(name in tileMapLoadedCallbacks)) {\n    return;\n  }\n  tileMapLoadedCallbacks[name](data);\n  delete tileMapLoadedCallbacks[name];\n}\nfunction loadTileMap(url, callback){\n  var m = url.match(/\\..+$/);\n  switch (m && m[0]) {\n  case \'.json\':\n    var xhr = new XMLHttpRequest();\n    xhr.open(\'GET\', url, true);\n    xhr.onload = function(e) {\n      callback(JSON.parse(this.response));\n    };\n    xhr.send();\n    return;\n  case \'.js\':\n    tileMapLoadedCallbacks[url.replace(/\\//g, \'\\\\\').replace(/\\..+$/, \'\')] = callback;\n    var sc = document.createElement(\'script\');\n    sc.src = url;\n    document.body.appendChild(sc);\n    setTimeout(function(){\n      document.body.removeChild(sc);\n    }, 0);\n    return;\n  }\n  throw new Error(\'unsupported filetype: \'+url);\n}\nfunction decodeData(layer){\n  if (!(\'encoding\' in layer)) {\n    return layer.data;\n  }\n  switch (layer.encoding) {\n  case \'base64\':\n    var ab = base64ToArrayBuffer(layer.data);\n    if (\'compression\' in layer) {\n      switch (layer.compression) {\n      case \'zlib\':\n        ab = pako.inflate(ab).buffer;\n        break;\n      default:\n        throw new Error(\'unsupported compression: \'+layer.compression);\n      }\n    }\n    var i32a = new Int32Array(ab), r = new Array(i32a.length);\n    for (var i = 0; i < i32a.length; ++i) {\n      r[i] = i32a[i];\n    }\n    return r;\n  default:\n    throw new Error(\'unsupported encoding: \'+layer.encoding);\n  }\n}\nfunction base64ToArrayBuffer(s){\n  var bin = atob(s), u8a = new Uint8Array(bin.length);\n  for (var i = 0; i < bin.length; ++i) {\n    u8a[i] = bin.charCodeAt(i);\n  }\n  return u8a.buffer;\n}\nvar selectId = 0;\nfunction createSelect(caption, items, onChange){\n  var id = \'sel\' + (++selectId);\n\n  var label = document.createElement(\'label\');\n  label.textContent = caption;\n  label.htmlFor = id;\n\n  var sel = document.createElement(\'select\');\n  sel.id = id;\n  items.map(function(item, index){\n    var opt = document.createElement(\'option\');\n    opt.textContent = item;\n    opt.value = item;\n    sel.appendChild(opt);\n  });\n\n  var slider = document.createElement(\'input\');\n  slider.type = \'range\';\n  slider.max = items.length-1;\n  slider.value = 0;\n\n  sel.addEventListener(\'change\', function(e){\n    slider.value = sel.selectedIndex;\n    onChange(e);\n  }, false);\n  slider.addEventListener(\'input\', function(e){\n    sel.selectedIndex = slider.value;\n    var ev = document.createEvent("HTMLEvents");\n    ev.initEvent("change", false, true);\n    sel.dispatchEvent(ev);\n  }, false);\n\n  var li = document.createElement(\'li\');\n  li.appendChild(label);\n  li.appendChild(sel);\n  li.appendChild(slider);\n  return li;\n}\nfunction updateSelects(faview, rootIndex) {\n  var elem = document.getElementById(\'selects\');\n  elem.innerHTML = \'\';\n  function changed(){\n    updateCanvas(faview, document.getElementById(\'view\'));\n  }\n  var root = faview.roots[rootIndex];\n  root.selects.map(function(sel, i){\n    elem.appendChild(createSelect(root.captions[i], sel, changed));\n  });\n}\nfunction buildName(flatten, namingStyle, ext) {\n  var items = [], sels = document.querySelectorAll(\'select\');\n  for (var i = 0; i < sels.length; ++i){\n    switch (namingStyle) {\n    case \'standard\':\n      items.push(\n        (i ? document.querySelector("label[for=\'"+sels[i].id+"\']").textContent+\'-\' : \'\')+\n        sels[i].options[sels[i].selectedIndex].value\n      );\n      break;\n    case \'compact\':\n      items.push(sels[i].options[sels[i].selectedIndex].value);\n      break;\n    case \'index\':\n      items.push(sels[i].selectedIndex);\n      break;\n    }\n  }\n  return items.join(flatten ? \'_\' : \'/\') + \'.\' + ext;\n}\nfunction renderCanvas(tiled, canvas, images, layer){\n  var tsx = tiled.tilesets, tw = tiled.tilewidth, th = tiled.tileheight;\n  canvas.width = tiled.properties.originalwidth;\n  canvas.height = tiled.properties.originalheight;\n  var ctx = canvas.getContext(\'2d\');\n  var dx = 0, dy = 0, data = decodeData(layer);\n  for (var i = 0; i < data.length; ++i) {\n    var d = data[i]-1, img = 0;\n    while(d >= tsx[img].tilecount) {\n      d -= tsx[img++].tilecount;\n    }\n    var sx = d % tsx[img].columns, sy = (d - sx) / tsx[img].columns;\n    ctx.drawImage(images[img], sx * tw, sy * th, tw, th, dx * tw, dy * th, tw, th);\n    if (++dx == layer.width) {\n      dx = 0;\n      ++dy;\n    }\n  }\n}\nfunction updateCanvas(faview, canvas){\n  var path = buildName(faview.flatten, faview.namingStyle, faview.format);\n  loadTileMap(path, function(tiled){\n    var images, loading = 0;\n    function loaded(){\n      if (--loading) return;\n      tiled.layers.map(function(layer){\n        renderCanvas(tiled, canvas, images, layer);\n      });\n    }\n    images = tiled.tilesets.map(function(tsx){\n      ++loading;\n      var img = new Image();\n      img.src = path.replace(/[^\\/]+$/, \'\') + tsx.image.replace(/\\\\/g, \'/\');\n      img.onload = loaded;\n      return img;\n    });\n  });\n}\nfunction onFaviewLoaded(faview){\n  var sel = document.createElement(\'select\');\n  faview.roots.map(function(root){\n    var opt = document.createElement(\'option\');\n    opt.textContent = root.name;\n    opt.value = root.name;\n    sel.appendChild(opt);\n  });\n  sel.addEventListener(\'change\', function(e){\n    updateSelects(faview, e.currentTarget.selectedIndex);\n  }, false);\n  if (faview.roots.length <= 1) {\n    sel.style.display = \'none\';\n  }\n  document.getElementById(\'root\').appendChild(sel);\n  updateSelects(faview, 0);\n  updateCanvas(faview, document.getElementById(\'view\'));\n}\n</script>\n<script>\n/* pako 1.0.3 nodeca/pako */\n!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.pako=e()}}(function(){return function e(t,i,n){function a(o,s){if(!i[o]){if(!t[o]){var f="function"==typeof require&&require;if(!s&&f)return f(o,!0);if(r)return r(o,!0);var l=new Error("Cannot find module \'"+o+"\'");throw l.code="MODULE_NOT_FOUND",l}var d=i[o]={exports:{}};t[o][0].call(d.exports,function(e){var i=t[o][1][e];return a(i?i:e)},d,d.exports,e,t,i,n)}return i[o].exports}for(var r="function"==typeof require&&require,o=0;o<n.length;o++)a(n[o]);return a}({1:[function(e,t,i){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;i.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])}}return e},i.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,i,n,a){if(t.subarray&&e.subarray)return void e.set(t.subarray(i,i+n),a);for(var r=0;r<n;r++)e[a+r]=t[i+r]},flattenChunks:function(e){var t,i,n,a,r,o;for(n=0,t=0,i=e.length;t<i;t++)n+=e[t].length;for(o=new Uint8Array(n),a=0,t=0,i=e.length;t<i;t++)r=e[t],o.set(r,a),a+=r.length;return o}},r={arraySet:function(e,t,i,n,a){for(var r=0;r<n;r++)e[a+r]=t[i+r]},flattenChunks:function(e){return[].concat.apply([],e)}};i.setTyped=function(e){e?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,a)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,r))},i.setTyped(n)},{}],2:[function(e,t,i){"use strict";function n(e,t){if(t<65537&&(e.subarray&&o||!e.subarray&&r))return String.fromCharCode.apply(null,a.shrinkBuf(e,t));for(var i="",n=0;n<t;n++)i+=String.fromCharCode(e[n]);return i}var a=e("./common"),r=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var s=new a.Buf8(256),f=0;f<256;f++)s[f]=f>=252?6:f>=248?5:f>=240?4:f>=224?3:f>=192?2:1;s[254]=s[254]=1,i.string2buf=function(e){var t,i,n,r,o,s=e.length,f=0;for(r=0;r<s;r++)i=e.charCodeAt(r),55296===(64512&i)&&r+1<s&&(n=e.charCodeAt(r+1),56320===(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),r++)),f+=i<128?1:i<2048?2:i<65536?3:4;for(t=new a.Buf8(f),o=0,r=0;o<f;r++)i=e.charCodeAt(r),55296===(64512&i)&&r+1<s&&(n=e.charCodeAt(r+1),56320===(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),r++)),i<128?t[o++]=i:i<2048?(t[o++]=192|i>>>6,t[o++]=128|63&i):i<65536?(t[o++]=224|i>>>12,t[o++]=128|i>>>6&63,t[o++]=128|63&i):(t[o++]=240|i>>>18,t[o++]=128|i>>>12&63,t[o++]=128|i>>>6&63,t[o++]=128|63&i);return t},i.buf2binstring=function(e){return n(e,e.length)},i.binstring2buf=function(e){for(var t=new a.Buf8(e.length),i=0,n=t.length;i<n;i++)t[i]=e.charCodeAt(i);return t},i.buf2string=function(e,t){var i,a,r,o,f=t||e.length,l=new Array(2*f);for(a=0,i=0;i<f;)if(r=e[i++],r<128)l[a++]=r;else if(o=s[r],o>4)l[a++]=65533,i+=o-1;else{for(r&=2===o?31:3===o?15:7;o>1&&i<f;)r=r<<6|63&e[i++],o--;o>1?l[a++]=65533:r<65536?l[a++]=r:(r-=65536,l[a++]=55296|r>>10&1023,l[a++]=56320|1023&r)}return n(l,a)},i.utf8border=function(e,t){var i;for(t=t||e.length,t>e.length&&(t=e.length),i=t-1;i>=0&&128===(192&e[i]);)i--;return i<0?t:0===i?t:i+s[e[i]]>t?i:t}},{"./common":1}],3:[function(e,t,i){"use strict";function n(e,t,i,n){for(var a=65535&e|0,r=e>>>16&65535|0,o=0;0!==i;){o=i>2e3?2e3:i,i-=o;do a=a+t[n++]|0,r=r+a|0;while(--o);a%=65521,r%=65521}return a|r<<16|0}t.exports=n},{}],4:[function(e,t,i){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],5:[function(e,t,i){"use strict";function n(){for(var e,t=[],i=0;i<256;i++){e=i;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}function a(e,t,i,n){var a=r,o=n+i;e^=-1;for(var s=n;s<o;s++)e=e>>>8^a[255&(e^t[s])];return e^-1}var r=n();t.exports=a},{}],6:[function(e,t,i){"use strict";function n(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}t.exports=n},{}],7:[function(e,t,i){"use strict";var n=30,a=12;t.exports=function(e,t){var i,r,o,s,f,l,d,u,c,h,b,w,m,k,_,g,v,p,x,y,S,E,B,Z,A;i=e.state,r=e.next_in,Z=e.input,o=r+(e.avail_in-5),s=e.next_out,A=e.output,f=s-(t-e.avail_out),l=s+(e.avail_out-257),d=i.dmax,u=i.wsize,c=i.whave,h=i.wnext,b=i.window,w=i.hold,m=i.bits,k=i.lencode,_=i.distcode,g=(1<<i.lenbits)-1,v=(1<<i.distbits)-1;e:do{m<15&&(w+=Z[r++]<<m,m+=8,w+=Z[r++]<<m,m+=8),p=k[w&g];t:for(;;){if(x=p>>>24,w>>>=x,m-=x,x=p>>>16&255,0===x)A[s++]=65535&p;else{if(!(16&x)){if(0===(64&x)){p=k[(65535&p)+(w&(1<<x)-1)];continue t}if(32&x){i.mode=a;break e}e.msg="invalid literal/length code",i.mode=n;break e}y=65535&p,x&=15,x&&(m<x&&(w+=Z[r++]<<m,m+=8),y+=w&(1<<x)-1,w>>>=x,m-=x),m<15&&(w+=Z[r++]<<m,m+=8,w+=Z[r++]<<m,m+=8),p=_[w&v];i:for(;;){if(x=p>>>24,w>>>=x,m-=x,x=p>>>16&255,!(16&x)){if(0===(64&x)){p=_[(65535&p)+(w&(1<<x)-1)];continue i}e.msg="invalid distance code",i.mode=n;break e}if(S=65535&p,x&=15,m<x&&(w+=Z[r++]<<m,m+=8,m<x&&(w+=Z[r++]<<m,m+=8)),S+=w&(1<<x)-1,S>d){e.msg="invalid distance too far back",i.mode=n;break e}if(w>>>=x,m-=x,x=s-f,S>x){if(x=S-x,x>c&&i.sane){e.msg="invalid distance too far back",i.mode=n;break e}if(E=0,B=b,0===h){if(E+=u-x,x<y){y-=x;do A[s++]=b[E++];while(--x);E=s-S,B=A}}else if(h<x){if(E+=u+h-x,x-=h,x<y){y-=x;do A[s++]=b[E++];while(--x);if(E=0,h<y){x=h,y-=x;do A[s++]=b[E++];while(--x);E=s-S,B=A}}}else if(E+=h-x,x<y){y-=x;do A[s++]=b[E++];while(--x);E=s-S,B=A}for(;y>2;)A[s++]=B[E++],A[s++]=B[E++],A[s++]=B[E++],y-=3;y&&(A[s++]=B[E++],y>1&&(A[s++]=B[E++]))}else{E=s-S;do A[s++]=A[E++],A[s++]=A[E++],A[s++]=A[E++],y-=3;while(y>2);y&&(A[s++]=A[E++],y>1&&(A[s++]=A[E++]))}break}}break}}while(r<o&&s<l);y=m>>3,r-=y,m-=y<<3,w&=(1<<m)-1,e.next_in=r,e.next_out=s,e.avail_in=r<o?5+(o-r):5-(r-o),e.avail_out=s<l?257+(l-s):257-(s-l),i.hold=w,i.bits=m}},{}],8:[function(e,t,i){"use strict";function n(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function a(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new _.Buf16(320),this.work=new _.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function r(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=D,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new _.Buf32(we),t.distcode=t.distdyn=new _.Buf32(me),t.sane=1,t.back=-1,z):C}function o(e){var t;return e&&e.state?(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,r(e)):C}function s(e,t){var i,n;return e&&e.state?(n=e.state,t<0?(i=0,t=-t):(i=(t>>4)+1,t<48&&(t&=15)),t&&(t<8||t>15)?C:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=i,n.wbits=t,o(e))):C}function f(e,t){var i,n;return e?(n=new a,e.state=n,n.window=null,i=s(e,t),i!==z&&(e.state=null),i):C}function l(e){return f(e,_e)}function d(e){if(ge){var t;for(m=new _.Buf32(512),k=new _.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(x(S,e.lens,0,288,m,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;x(E,e.lens,0,32,k,0,e.work,{bits:5}),ge=!1}e.lencode=m,e.lenbits=9,e.distcode=k,e.distbits=5}function u(e,t,i,n){var a,r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new _.Buf8(r.wsize)),n>=r.wsize?(_.arraySet(r.window,t,i-r.wsize,r.wsize,0),r.wnext=0,r.whave=r.wsize):(a=r.wsize-r.wnext,a>n&&(a=n),_.arraySet(r.window,t,i-n,a,r.wnext),n-=a,n?(_.arraySet(r.window,t,i-n,n,0),r.wnext=n,r.whave=r.wsize):(r.wnext+=a,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=a))),0}function c(e,t){var i,a,r,o,s,f,l,c,h,b,w,m,k,we,me,ke,_e,ge,ve,pe,xe,ye,Se,Ee,Be=0,Ze=new _.Buf8(4),Ae=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return C;i=e.state,i.mode===X&&(i.mode=W),s=e.next_out,r=e.output,l=e.avail_out,o=e.next_in,a=e.input,f=e.avail_in,c=i.hold,h=i.bits,b=f,w=l,ye=z;e:for(;;)switch(i.mode){case D:if(0===i.wrap){i.mode=W;break}for(;h<16;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(2&i.wrap&&35615===c){i.check=0,Ze[0]=255&c,Ze[1]=c>>>8&255,i.check=v(i.check,Ze,2,0),c=0,h=0,i.mode=F;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",i.mode=ce;break}if((15&c)!==U){e.msg="unknown compression method",i.mode=ce;break}if(c>>>=4,h-=4,xe=(15&c)+8,0===i.wbits)i.wbits=xe;else if(xe>i.wbits){e.msg="invalid window size",i.mode=ce;break}i.dmax=1<<xe,e.adler=i.check=1,i.mode=512&c?q:X,c=0,h=0;break;case F:for(;h<16;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(i.flags=c,(255&i.flags)!==U){e.msg="unknown compression method",i.mode=ce;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=ce;break}i.head&&(i.head.text=c>>8&1),512&i.flags&&(Ze[0]=255&c,Ze[1]=c>>>8&255,i.check=v(i.check,Ze,2,0)),c=0,h=0,i.mode=L;case L:for(;h<32;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}i.head&&(i.head.time=c),512&i.flags&&(Ze[0]=255&c,Ze[1]=c>>>8&255,Ze[2]=c>>>16&255,Ze[3]=c>>>24&255,i.check=v(i.check,Ze,4,0)),c=0,h=0,i.mode=H;case H:for(;h<16;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}i.head&&(i.head.xflags=255&c,i.head.os=c>>8),512&i.flags&&(Ze[0]=255&c,Ze[1]=c>>>8&255,i.check=v(i.check,Ze,2,0)),c=0,h=0,i.mode=M;case M:if(1024&i.flags){for(;h<16;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}i.length=c,i.head&&(i.head.extra_len=c),512&i.flags&&(Ze[0]=255&c,Ze[1]=c>>>8&255,i.check=v(i.check,Ze,2,0)),c=0,h=0}else i.head&&(i.head.extra=null);i.mode=j;case j:if(1024&i.flags&&(m=i.length,m>f&&(m=f),m&&(i.head&&(xe=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),_.arraySet(i.head.extra,a,o,m,xe)),512&i.flags&&(i.check=v(i.check,a,m,o)),f-=m,o+=m,i.length-=m),i.length))break e;i.length=0,i.mode=K;case K:if(2048&i.flags){if(0===f)break e;m=0;do xe=a[o+m++],i.head&&xe&&i.length<65536&&(i.head.name+=String.fromCharCode(xe));while(xe&&m<f);if(512&i.flags&&(i.check=v(i.check,a,m,o)),f-=m,o+=m,xe)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=P;case P:if(4096&i.flags){if(0===f)break e;m=0;do xe=a[o+m++],i.head&&xe&&i.length<65536&&(i.head.comment+=String.fromCharCode(xe));while(xe&&m<f);if(512&i.flags&&(i.check=v(i.check,a,m,o)),f-=m,o+=m,xe)break e}else i.head&&(i.head.comment=null);i.mode=Y;case Y:if(512&i.flags){for(;h<16;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(c!==(65535&i.check)){e.msg="header crc mismatch",i.mode=ce;break}c=0,h=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=X;break;case q:for(;h<32;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}e.adler=i.check=n(c),c=0,h=0,i.mode=G;case G:if(0===i.havedict)return e.next_out=s,e.avail_out=l,e.next_in=o,e.avail_in=f,i.hold=c,i.bits=h,N;e.adler=i.check=1,i.mode=X;case X:if(t===Z||t===A)break e;case W:if(i.last){c>>>=7&h,h-=7&h,i.mode=le;break}for(;h<3;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}switch(i.last=1&c,c>>>=1,h-=1,3&c){case 0:i.mode=J;break;case 1:if(d(i),i.mode=ie,t===A){c>>>=2,h-=2;break e}break;case 2:i.mode=$;break;case 3:e.msg="invalid block type",i.mode=ce}c>>>=2,h-=2;break;case J:for(c>>>=7&h,h-=7&h;h<32;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if((65535&c)!==(c>>>16^65535)){e.msg="invalid stored block lengths",i.mode=ce;break}if(i.length=65535&c,c=0,h=0,i.mode=Q,t===A)break e;case Q:i.mode=V;case V:if(m=i.length){if(m>f&&(m=f),m>l&&(m=l),0===m)break e;_.arraySet(r,a,o,m,s),f-=m,o+=m,l-=m,s+=m,i.length-=m;break}i.mode=X;break;case $:for(;h<14;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(i.nlen=(31&c)+257,c>>>=5,h-=5,i.ndist=(31&c)+1,c>>>=5,h-=5,i.ncode=(15&c)+4,c>>>=4,h-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=ce;break}i.have=0,i.mode=ee;case ee:for(;i.have<i.ncode;){for(;h<3;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}i.lens[Ae[i.have++]]=7&c,c>>>=3,h-=3}for(;i.have<19;)i.lens[Ae[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,Se={bits:i.lenbits},ye=x(y,i.lens,0,19,i.lencode,0,i.work,Se),i.lenbits=Se.bits,ye){e.msg="invalid code lengths set",i.mode=ce;break}i.have=0,i.mode=te;case te:for(;i.have<i.nlen+i.ndist;){for(;Be=i.lencode[c&(1<<i.lenbits)-1],me=Be>>>24,ke=Be>>>16&255,_e=65535&Be,!(me<=h);){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(_e<16)c>>>=me,h-=me,i.lens[i.have++]=_e;else{if(16===_e){for(Ee=me+2;h<Ee;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(c>>>=me,h-=me,0===i.have){e.msg="invalid bit length repeat",i.mode=ce;break}xe=i.lens[i.have-1],m=3+(3&c),c>>>=2,h-=2}else if(17===_e){for(Ee=me+3;h<Ee;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}c>>>=me,h-=me,xe=0,m=3+(7&c),c>>>=3,h-=3}else{for(Ee=me+7;h<Ee;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}c>>>=me,h-=me,xe=0,m=11+(127&c),c>>>=7,h-=7}if(i.have+m>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=ce;break}for(;m--;)i.lens[i.have++]=xe}}if(i.mode===ce)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=ce;break}if(i.lenbits=9,Se={bits:i.lenbits},ye=x(S,i.lens,0,i.nlen,i.lencode,0,i.work,Se),i.lenbits=Se.bits,ye){e.msg="invalid literal/lengths set",i.mode=ce;break}if(i.distbits=6,i.distcode=i.distdyn,Se={bits:i.distbits},ye=x(E,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,Se),i.distbits=Se.bits,ye){e.msg="invalid distances set",i.mode=ce;break}if(i.mode=ie,t===A)break e;case ie:i.mode=ne;case ne:if(f>=6&&l>=258){e.next_out=s,e.avail_out=l,e.next_in=o,e.avail_in=f,i.hold=c,i.bits=h,p(e,w),s=e.next_out,r=e.output,l=e.avail_out,o=e.next_in,a=e.input,f=e.avail_in,c=i.hold,h=i.bits,i.mode===X&&(i.back=-1);break}for(i.back=0;Be=i.lencode[c&(1<<i.lenbits)-1],me=Be>>>24,ke=Be>>>16&255,_e=65535&Be,!(me<=h);){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(ke&&0===(240&ke)){for(ge=me,ve=ke,pe=_e;Be=i.lencode[pe+((c&(1<<ge+ve)-1)>>ge)],me=Be>>>24,ke=Be>>>16&255,_e=65535&Be,!(ge+me<=h);){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}c>>>=ge,h-=ge,i.back+=ge}if(c>>>=me,h-=me,i.back+=me,i.length=_e,0===ke){i.mode=fe;break}if(32&ke){i.back=-1,i.mode=X;break}if(64&ke){e.msg="invalid literal/length code",i.mode=ce;break}i.extra=15&ke,i.mode=ae;case ae:if(i.extra){for(Ee=i.extra;h<Ee;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}i.length+=c&(1<<i.extra)-1,c>>>=i.extra,h-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=re;case re:for(;Be=i.distcode[c&(1<<i.distbits)-1],me=Be>>>24,ke=Be>>>16&255,_e=65535&Be,!(me<=h);){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(0===(240&ke)){for(ge=me,ve=ke,pe=_e;Be=i.distcode[pe+((c&(1<<ge+ve)-1)>>ge)],me=Be>>>24,ke=Be>>>16&255,_e=65535&Be,!(ge+me<=h);){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}c>>>=ge,h-=ge,i.back+=ge}if(c>>>=me,h-=me,i.back+=me,64&ke){e.msg="invalid distance code",i.mode=ce;break}i.offset=_e,i.extra=15&ke,i.mode=oe;case oe:if(i.extra){for(Ee=i.extra;h<Ee;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}i.offset+=c&(1<<i.extra)-1,c>>>=i.extra,h-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=ce;break}i.mode=se;case se:if(0===l)break e;if(m=w-l,i.offset>m){if(m=i.offset-m,m>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=ce;break}m>i.wnext?(m-=i.wnext,k=i.wsize-m):k=i.wnext-m,m>i.length&&(m=i.length),we=i.window}else we=r,k=s-i.offset,m=i.length;m>l&&(m=l),l-=m,i.length-=m;do r[s++]=we[k++];while(--m);0===i.length&&(i.mode=ne);break;case fe:if(0===l)break e;r[s++]=i.length,l--,i.mode=ne;break;case le:if(i.wrap){for(;h<32;){if(0===f)break e;f--,c|=a[o++]<<h,h+=8}if(w-=l,e.total_out+=w,i.total+=w,w&&(e.adler=i.check=i.flags?v(i.check,r,w,s-w):g(i.check,r,w,s-w)),w=l,(i.flags?c:n(c))!==i.check){e.msg="incorrect data check",i.mode=ce;break}c=0,h=0}i.mode=de;case de:if(i.wrap&&i.flags){for(;h<32;){if(0===f)break e;f--,c+=a[o++]<<h,h+=8}if(c!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=ce;break}c=0,h=0}i.mode=ue;case ue:ye=R;break e;case ce:ye=O;break e;case he:return I;case be:default:return C}return e.next_out=s,e.avail_out=l,e.next_in=o,e.avail_in=f,i.hold=c,i.bits=h,(i.wsize||w!==e.avail_out&&i.mode<ce&&(i.mode<le||t!==B))&&u(e,e.output,e.next_out,w-e.avail_out)?(i.mode=he,I):(b-=e.avail_in,w-=e.avail_out,e.total_in+=b,e.total_out+=w,i.total+=w,i.wrap&&w&&(e.adler=i.check=i.flags?v(i.check,r,w,e.next_out-w):g(i.check,r,w,e.next_out-w)),e.data_type=i.bits+(i.last?64:0)+(i.mode===X?128:0)+(i.mode===ie||i.mode===Q?256:0),(0===b&&0===w||t===B)&&ye===z&&(ye=T),ye)}function h(e){if(!e||!e.state)return C;var t=e.state;return t.window&&(t.window=null),e.state=null,z}function b(e,t){var i;return e&&e.state?(i=e.state,0===(2&i.wrap)?C:(i.head=t,t.done=!1,z)):C}function w(e,t){var i,n,a,r=t.length;return e&&e.state?(i=e.state,0!==i.wrap&&i.mode!==G?C:i.mode===G&&(n=1,n=g(n,t,r,0),n!==i.check)?O:(a=u(e,t,r,r))?(i.mode=he,I):(i.havedict=1,z)):C}var m,k,_=e("../utils/common"),g=e("./adler32"),v=e("./crc32"),p=e("./inffast"),x=e("./inftrees"),y=0,S=1,E=2,B=4,Z=5,A=6,z=0,R=1,N=2,C=-2,O=-3,I=-4,T=-5,U=8,D=1,F=2,L=3,H=4,M=5,j=6,K=7,P=8,Y=9,q=10,G=11,X=12,W=13,J=14,Q=15,V=16,$=17,ee=18,te=19,ie=20,ne=21,ae=22,re=23,oe=24,se=25,fe=26,le=27,de=28,ue=29,ce=30,he=31,be=32,we=852,me=592,ke=15,_e=ke,ge=!0;i.inflateReset=o,i.inflateReset2=s,i.inflateResetKeep=r,i.inflateInit=l,i.inflateInit2=f,i.inflate=c,i.inflateEnd=h,i.inflateGetHeader=b,i.inflateSetDictionary=w,i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":5,"./inffast":7,"./inftrees":9}],9:[function(e,t,i){"use strict";var n=e("../utils/common"),a=15,r=852,o=592,s=0,f=1,l=2,d=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],u=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,i,b,w,m,k,_){var g,v,p,x,y,S,E,B,Z,A=_.bits,z=0,R=0,N=0,C=0,O=0,I=0,T=0,U=0,D=0,F=0,L=null,H=0,M=new n.Buf16(a+1),j=new n.Buf16(a+1),K=null,P=0;for(z=0;z<=a;z++)M[z]=0;for(R=0;R<b;R++)M[t[i+R]]++;for(O=A,C=a;C>=1&&0===M[C];C--);if(O>C&&(O=C),0===C)return w[m++]=20971520,w[m++]=20971520,_.bits=1,0;for(N=1;N<C&&0===M[N];N++);for(O<N&&(O=N),U=1,z=1;z<=a;z++)if(U<<=1,U-=M[z],U<0)return-1;if(U>0&&(e===s||1!==C))return-1;for(j[1]=0,z=1;z<a;z++)j[z+1]=j[z]+M[z];for(R=0;R<b;R++)0!==t[i+R]&&(k[j[t[i+R]]++]=R);if(e===s?(L=K=k,S=19):e===f?(L=d,H-=257,K=u,P-=257,S=256):(L=c,K=h,S=-1),F=0,R=0,z=N,y=m,I=O,T=0,p=-1,D=1<<O,x=D-1,e===f&&D>r||e===l&&D>o)return 1;for(var Y=0;;){Y++,E=z-T,k[R]<S?(B=0,Z=k[R]):k[R]>S?(B=K[P+k[R]],Z=L[H+k[R]]):(B=96,Z=0),g=1<<z-T,v=1<<I,N=v;do v-=g,w[y+(F>>T)+v]=E<<24|B<<16|Z|0;while(0!==v);for(g=1<<z-1;F&g;)g>>=1;if(0!==g?(F&=g-1,F+=g):F=0,R++,0===--M[z]){if(z===C)break;z=t[i+k[R]]}if(z>O&&(F&x)!==p){for(0===T&&(T=O),y+=N,I=z-T,U=1<<I;I+T<C&&(U-=M[I+T],!(U<=0));)I++,U<<=1;if(D+=1<<I,e===f&&D>r||e===l&&D>o)return 1;p=F&x,w[p]=O<<24|I<<16|y-m|0}}return 0!==F&&(w[y+F]=z-T<<24|64<<16|0),_.bits=O,0}},{"../utils/common":1}],10:[function(e,t,i){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],11:[function(e,t,i){"use strict";function n(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}t.exports=n},{}],"/lib/inflate.js":[function(e,t,i){"use strict";function n(e){if(!(this instanceof n))return new n(e);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var i=o.inflateInit2(this.strm,t.windowBits);if(i!==l.Z_OK)throw new Error(d[i]);this.header=new c,o.inflateGetHeader(this.strm,this.header)}function a(e,t){var i=new n(t);if(i.push(e,!0),i.err)throw i.msg;return i.result}function r(e,t){return t=t||{},t.raw=!0,a(e,t)}var o=e("./zlib/inflate"),s=e("./utils/common"),f=e("./utils/strings"),l=e("./zlib/constants"),d=e("./zlib/messages"),u=e("./zlib/zstream"),c=e("./zlib/gzheader"),h=Object.prototype.toString;n.prototype.push=function(e,t){var i,n,a,r,d,u,c=this.strm,b=this.options.chunkSize,w=this.options.dictionary,m=!1;if(this.ended)return!1;n=t===~~t?t:t===!0?l.Z_FINISH:l.Z_NO_FLUSH,"string"==typeof e?c.input=f.binstring2buf(e):"[object ArrayBuffer]"===h.call(e)?c.input=new Uint8Array(e):c.input=e,c.next_in=0,c.avail_in=c.input.length;do{if(0===c.avail_out&&(c.output=new s.Buf8(b),c.next_out=0,c.avail_out=b),i=o.inflate(c,l.Z_NO_FLUSH),i===l.Z_NEED_DICT&&w&&(u="string"==typeof w?f.string2buf(w):"[object ArrayBuffer]"===h.call(w)?new Uint8Array(w):w,i=o.inflateSetDictionary(this.strm,u)),i===l.Z_BUF_ERROR&&m===!0&&(i=l.Z_OK,m=!1),i!==l.Z_STREAM_END&&i!==l.Z_OK)return this.onEnd(i),this.ended=!0,!1;c.next_out&&(0!==c.avail_out&&i!==l.Z_STREAM_END&&(0!==c.avail_in||n!==l.Z_FINISH&&n!==l.Z_SYNC_FLUSH)||("string"===this.options.to?(a=f.utf8border(c.output,c.next_out),r=c.next_out-a,d=f.buf2string(c.output,a),c.next_out=r,c.avail_out=b-r,r&&s.arraySet(c.output,c.output,a,r,0),this.onData(d)):this.onData(s.shrinkBuf(c.output,c.next_out)))),0===c.avail_in&&0===c.avail_out&&(m=!0)}while((c.avail_in>0||0===c.avail_out)&&i!==l.Z_STREAM_END);return i===l.Z_STREAM_END&&(n=l.Z_FINISH),n===l.Z_FINISH?(i=o.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===l.Z_OK):n!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),c.avail_out=0,!0)},n.prototype.onData=function(e){this.chunks.push(e)},n.prototype.onEnd=function(e){e===l.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Inflate=n,i.inflate=a,i.inflateRaw=r,i.ungzip=a},{"./utils/common":1,"./utils/strings":2,"./zlib/constants":4,"./zlib/gzheader":6,"./zlib/inflate":8,"./zlib/messages":10,"./zlib/zstream":11}]},{},[])("/lib/inflate.js")});\n</script>\n<script src="faview.js"></script>';
}function o(e){var t=new Uint8Array(e),i="",n=0,r=0,a=0,o=0;for(t.length>=3&&239===t[0]&&187===t[1]&&191===t[2]&&(n=3);n<t.length;)if(r=t[n],128>r)i+=String.fromCharCode(r),n++;else if(r>191&&224>r){if(n+1>=t.length)throw"UTF-8 Decode failed. Two byte character was truncated.";a=t[n+1],i+=String.fromCharCode((31&r)<<6|63&a),n+=2}else{if(n+2>=t.length)throw"UTF-8 Decode failed. Multi byte character was truncated.";a=t[n+1],o=t[n+2],i+=String.fromCharCode((15&r)<<12|(63&a)<<6|63&o),n+=3}return i}var s=e("./crc32"),l=function(){function e(e,t){this.index=e.index,this.hash=e.hash,this.name=e.name,this.width=e.width,this.height=e.height,this.originalWidth=e.originalWidth,this.originalHeight=e.originalHeight,this.tileWidth=e.tileWidth,this.tileHeight=e.tileHeight,this.data=e.data,this.deflated=e.deflated,this.tileSet=t}return e.prototype["export"]=function(e,t,i){if(this.deflated&&"binz"!==t)throw new Error("cannot export by '"+t+"' when have the compressed data");if(!this.deflated&&"binz"===t)throw new Error("cannot export by '"+t+"' when have the uncompressed data");switch(e){case"tmx":return this.exportTMX(t,i);case"json":return this.exportJSON(t,i);case"js":return this.exportJS(t,i);case"raw":return this.exportRaw(t)}throw new Error("unknown file format: "+e)},e.prototype.exportRaw=function(e){switch(e){case"csv":return new Blob([r(new Int32Array(this.data),this.width,"\n")],{type:"text/csv; charset=utf-8"});case"bin":return new Blob([this.data],{type:"application/octet-binary"});default:throw new Error("unknown tile format: "+e)}},e.prototype.exportJSON=function(e,t){for(var i=[],n=new Array(this.name.split("\\").length).join("..\\"),r=0;r<this.tileSet.length;++r)t?i.push(this.tileSet[r].getTileSetReference(n)):i.push(this.tileSet[r].getTileSet(n));var a={width:this.width,height:this.height,tilewidth:this.tileWidth,tileheight:this.tileHeight,nextobjectid:1,orientation:"orthogonal",renderorder:"right-down",version:1,propertytypes:{originalwidth:"int",originalheight:"int"},properties:{originalwidth:this.originalWidth,originalheight:this.originalHeight},tilesets:i,layers:[{height:this.height,name:this.name,opacity:1,type:"tilelayer",visible:!0,width:this.width,x:0,y:0}]};switch(e){case"csv":a.layers[0].data=Array.prototype.slice.call(new Int32Array(this.data));break;case"bin":a.layers[0].encoding="base64",a.layers[0].data=o(f.encode(this.data));break;case"binz":a.layers[0].encoding="base64",a.layers[0].compression="zlib",a.layers[0].data=o(f.encode(this.data));break;default:throw new Error("unknown tile format: "+e)}return new Blob([JSON.stringify(a)],{type:"application/json; charset=utf-8"})},e.prototype.exportJS=function(e,t){return new Blob(["(function(name,data){\n if(typeof onTileMapLoaded === 'undefined') {\n  if(typeof TileMaps === 'undefined') TileMaps = {};\n  TileMaps[name] = data;\n } else {\n  onTileMapLoaded(name, data);\n }})(",JSON.stringify(this.name),", ",this.exportJSON(e,t),");"],{type:"text/javascript; charset=utf-8"})},e.prototype.exportTMX=function(e,t){for(var i=['<?xml version="1.0" encoding="UTF-8"?>\n','<map version="1.0" orientation="orthogonal" renderorder="right-down"',' width="'+this.width+'" height="'+this.height+'"',' tilewidth="'+this.tileWidth+'" tileheight="'+this.tileHeight+'" nextobjectid="1">\n',"	<properties>\n",'		<property name="originalWidth" type="int" value="'+this.originalWidth+'"/>\n','		<property name="originalHeight" type="int" value="'+this.originalHeight+'"/>\n',"	</properties>\n"],a=new Array(this.name.split("\\").length).join("..\\"),o=0;o<this.tileSet.length;++o)t?i.push("	"+this.tileSet[o].getTileSetReferenceTag(a)+"\n"):i.push("	"+this.tileSet[o].getTileSetTag(a)+"\n");switch(i.push('	<layer name="'+this.name+'" width="'+this.width+'" height="'+this.height+'">\n'),e){case"csv":i.push('		<data encoding="csv">\n'),i.push(r(new Int32Array(this.data),this.width,",\n"));break;case"xml":i.push("		<data>\n"),i.push(n(new Int32Array(this.data),"			","\n"));break;case"bin":i.push('		<data encoding="base64">\n			'),i.push(f.encode(this.data));break;case"binz":i.push('		<data encoding="base64" compression="zlib">\n			'),i.push(f.encode(this.data));break;default:throw new Error("unknown tile format: "+e)}return i.push("\n		</data>\n	</layer>\n</map>"),new Blob(i,{type:"text/xml; charset=utf-8"})},e}();i.Image=l;var c=function(){function e(e,t,i){this.tileWidth=e.tileWidth,this.tileHeight=e.tileHeight,this.tileCount=e.tileCount,this.columns=e.columns,this.width=e.width,this.height=e.height,this.data=e.data,this.gid=t,this.filename=i}return e.prototype.getImage=function(e){var t=new Uint8Array(this.data),i=Math.sqrt(t.length>>2),n=e.createElement("canvas");n.width=i,n.height=i;var r=n.getContext("2d");if(!r)throw new Error("cannot get CanvasRenderingContext2D");for(var a=r.createImageData(i,i),o=a.data,s=4*i,l=4*a.width,c=0;i>c;++c)for(var d=c*s,h=c*l,u=0;s>u;++u)o[h+u]=t[d+u];return r.putImageData(a,0,0),n},e.prototype["export"]=function(){return'<?xml version="1.0" encoding="UTF-8"?>\n<tileset name="'+this.filename+'" tilewidth="'+this.tileWidth+'" tileheight="'+this.tileHeight+'" tilecount="'+this.tileCount+'" columns="'+this.columns+'">\n   <image source="'+this.filename+'.png" width="'+this.width+'" height="'+this.height+'"/>\n</tileset>'},e.prototype.getTileSetReferenceTag=function(e){return'<tileset firstgid="'+this.gid+'" source="'+e+this.filename+'.tsx"/>'},e.prototype.getTileSetTag=function(e){return'<tileset firstgid="'+this.gid+'" name="'+this.filename+'"'+(' tilewidth="'+this.tileWidth+'" tileheight="'+this.tileHeight+'"')+(' tilecount="'+this.tileCount+'" columns="'+this.columns+'">')+('<image source="'+e+this.filename+'.png" width="'+this.width+'" height="'+this.height+'"/>')+"</tileset>"},e.prototype.getTileSetReference=function(e){return{firstgid:this.gid,source:e+this.filename+".tsx"}},e.prototype.getTileSet=function(e){return{columns:this.columns,firstgid:this.gid,image:e+this.filename+".png",imageheight:this.height,imagewidth:this.width,margin:0,name:this.filename,spacing:0,tilecount:this.tileCount,tileheight:this.tileHeight,tilewidth:this.tileWidth}},e}();i.Tsx=c;var d=function(){function e(){this._tileSize=16,this._chopper=[],this._tile=new Map,this._images=[],this.numWorkers=4,this.queueMax=3,this.index=0;for(var e=0;e<this.numWorkers;++e)this._chopper.push(new h)}return e.prototype._waitReadyChopper=function(e,t){var i=this,n=function(){for(var r=0;r<i._chopper.length;++r)if(i._chopper[r].tasks<=e)return void t(i._chopper[r]);setTimeout(function(){return n()},100)};n()},e.prototype._add=function(e,t,i,n,r){var a=this;return new Promise(function(o){a._waitReadyChopper(a.queueMax,function(s){s.chop(e,t,i,n,r,a._tileSize,function(e,t){t.forEach(function(e,t){var i=a._tile.get(t);i?i.p>e.p&&(i.p=e.p):a._tile.set(t,e)}),a._images.push(e)}),o()})})},e.prototype.add=function(e,t,i){var n;if(t instanceof HTMLImageElement){var r=document.createElement("canvas");r.width=t.width,r.height=t.height,n=r.getContext("2d"),n&&n.drawImage(t,0,0)}else n=t.getContext("2d");if(!n)throw new Error("cannot get CanvasRenderingContext2D");var a=n.getImageData(0,0,n.canvas.width,n.canvas.height);this._add(this.index++,e,a.data.buffer,t.width,t.height).then(i)},e.prototype.finish=function(e,t,i,n){var r=this,a=function(){for(var o=!0,s=0;s<r._chopper.length;++s)if(r._chopper[s].tasks>0){o=!1;break}if(o){var d=[],h=1;u.build(e,r._tile,r._images,r._tileSize,function(e,i,n){var r=new c(e,h,i.toString());d.push(r),h+=e.tileCount,t(r,i,n)},function(e,t,n){var r=new l(e,d);i(r,t,n)},n)}else setTimeout(function(){return a()},100)};a()},e}();i.Tileder=d;var h=function(){function e(){var t=this;this.worker=new Worker(e.createWorkerURL()),this._callbacks=[],this.worker.onmessage=function(e){var i=t._callbacks.shift();i&&i(e.data.data,e.data.tile)}}return e.prototype.chop=function(e,t,i,n,r,a,o){this._callbacks.push(o),this.worker.postMessage({index:e,name:t,buffer:i,width:n,height:r,tileSize:a},[i])},Object.defineProperty(e.prototype,"tasks",{get:function(){return this._callbacks.length},enumerable:!0,configurable:!0}),e._chop=function(e,t,i,n,r,a,o,s){for(var l=function(e){var t=32,i=new Array(t+1),n=e.length/t|0;i[0]=0;for(var r=0,a=0,o=0,s=0;r<e.length;++r)o+=e[r],++a===n&&(i[++s]=o,a=0,o=0);for(var l=0,r=1;r<i.length;++r)l=l<<1|(i[r]>i[r-1]?1:0);return l},c=[],d=new Map,h=a<<2,u=new Uint8ClampedArray(i),f=new Uint8Array(4*a*a),p=Math.floor(n/a),v=Math.floor(r/a),m=Math.ceil(n/a),g=Math.ceil(r/a),w=n-p*a,y=r-p*a,b=new Uint32Array(m*g),x=0;v>x;++x)for(var k=x*a,S=0;p>S;++S){for(var A=0;a>A;++A)for(var E=4*((k+A)*n+S*a),L=A*a*4,C=0;a>C;++C)f[L++]=u[E++],f[L++]=u[E++],f[L++]=u[E++],f[L++]=u[E++];var _=o(f.buffer,s);if(!d.has(_)){var T=f.slice().buffer;c.push(T),d.set(_,{h:_,p:1e6*x+S,b:T})}b[x*m+S]=_}if(w){f.fill(0);for(var x=0;v>x;++x){for(var k=x*a,A=0;a>A;++A)for(var E=4*((k+A)*n+p*a),L=A*h,C=0;w>C;++C)f[L++]=u[E++],f[L++]=u[E++],f[L++]=u[E++],f[L++]=u[E++];var _=o(f.buffer,s);if(!d.has(_)){var T=f.slice().buffer;c.push(T),d.set(_,{h:_,p:1e6*x+p,b:T})}b[x*m+p]=_}}if(y){f.fill(0);for(var k=v*a,S=0;p>S;++S){for(var A=0;y>A;++A)for(var E=4*((k+A)*n+S*a),L=A*h,C=0;a>C;++C)f[L++]=u[E++],f[L++]=u[E++],f[L++]=u[E++],f[L++]=u[E++];var _=o(f.buffer,s);if(!d.has(_)){var T=f.slice().buffer;c.push(T),d.set(_,{h:_,p:1e6*v+S,b:T})}b[v*m+S]=_}}if(w&&y){f.fill(0);for(var k=v*a,A=0;y>A;++A)for(var E=4*((k+A)*n+p*a),L=A*h,C=0;w>C;++C)f[L++]=u[E++],f[L++]=u[E++],f[L++]=u[E++],f[L++]=u[E++];var _=o(f.buffer,s);if(!d.has(_)){var T=f.slice().buffer;c.push(T),d.set(_,{h:_,p:1e6*v+p,b:T})}b[v*m+p]=_}return c.push(b.buffer),[{index:e,hash:l(b),name:t,width:m,height:g,originalWidth:n,originalHeight:r,tileWidth:a,tileHeight:a,data:b.buffer,deflated:!1},d,c]},e.createWorkerURL=function(){return e.workerURL?e.workerURL:(e.workerURL=URL.createObjectURL(new Blob(["\n'use strict';\nvar crcTable = new Uint32Array("+JSON.stringify(Array.from(new Int32Array(s.getCRCTable().buffer)))+");\nvar crc32 = "+s.crc32.toString()+";\nvar chop = "+e._chop.toString()+";\nonmessage = function(e){\n    var d = e.data;\n    var ret = chop(d.index, d.name, d.buffer, d.width, d.height, d.tileSize, crc32, crcTable);\n    postMessage({data: ret[0], tile: ret[1]}, ret[2]);\n};"],{type:"text/javascript"})),e.workerURL)},e}(),u=function(){function e(){}return e.build=function(t,i,n,r,a,o,s){var l=new Worker(e.createWorkerURL());l.onmessage=function(e){var t=e.data;t.image?(o(t.image,t.index,t.total),t.index===t.total-1&&s()):a(t.tsx,t.index,t.total)};var c=[];i.forEach(function(e){c.push(e.b)});for(var d=0,h=n;d<h.length;d++){var u=h[d];c.push(u.data)}l.postMessage({compressMap:t,tile:i,images:n,tileSize:r},c)},e._finish=function(e,t,i,n,r,a,o,s,l){for(var c=r(t,n,s,a),d=function(e){return e=(1431655765&e)+(e>>>1&1431655765),e=(858993459&e)+(e>>>2&858993459),e=(252645135&e)+(e>>>4&252645135),e=(16711935&e)+(e>>>8&16711935),(65535&e)+(e>>>16&65535)},h=0,u=0;u<i.length;++u)if(0===i[u].index){h=i[u].hash;break}i.sort(function(e,t){if(e.hash===t.hash)return e.index===t.index?0:e.index<t.index?-1:1;var i=d(e.hash^h),n=d(t.hash^h);return i>n?-1:1});for(var u=0;u<i.length;++u){for(var f=i[u],p=new Uint32Array(f.data),v=0;v<p.length;++v)p[v]=c.get(p[v])+1;e&&(f.data=o(new Uint8Array(f.data)).buffer,f.deflated=!0),l(f,u,i.length)}},e._calcImageSize=function(e,t){for(var i=t*e*e,n=64;1024>=n;n+=n)if(n*n>=i)return n;return 1024},e._buildTsx=function(e,t,i,n){var r=[];e.forEach(function(e){return r.push(e)});var a=r.length;r.sort(function(e,t){return e.p===t.p?e.h===t.h?0:e.h<t.h?-1:1:e.p<t.p?-1:1});for(var o=0,s=0;a>o;){var l=n(t,a-o)>>4;o+=l*l,++s}o=0;for(var c=new Map,d=0;s>d;++d){for(var h=n(t,a-o),u=4*h,f=h/t,p=new Uint8Array(h*u),l=h>>4,v=0;l>v&&a>o;++v)for(var m=v*t,g=0;l>g&&a>o;++g){for(var w=r[o],y=new Uint8Array(w.b),b=0;t>b;++b)for(var x=4*((m+b)*h+g*t),k=b*t*4,S=0;t>S;++S)p[x++]=y[k++],p[x++]=y[k++],p[x++]=y[k++],p[x++]=y[k++];c.set(w.h,o++)}i({tileWidth:t,tileHeight:t,tileCount:f*f,columns:f,width:h,height:h,data:p.buffer},d,s)}return c},e.createWorkerURL=function(){return e.workerURL?e.workerURL:(e.workerURL=URL.createObjectURL(new Blob(["\n'use strict';\nimportScripts('https://cdnjs.cloudflare.com/ajax/libs/pako/1.0.3/pako_deflate.min.js');\nvar calcImageSize = "+e._calcImageSize.toString()+";\nvar buildTsx = "+e._buildTsx.toString()+";\nvar compress = function(a){ return pako.deflate(a); };\nvar finish = "+e._finish.toString()+";\nonmessage = function(e){\n    var d = e.data;\n    var ret = finish(\n        d.compressMap,\n        d.tile,\n        d.images,\n        d.tileSize,\n        buildTsx,\n        calcImageSize,\n        compress,\n        function(tsx, index, total){\n            postMessage({tsx: tsx, index: index, total: total}, [tsx.data]);\n        },\n        function(image, index, total){\n            postMessage({image: image, index: index, total: total}, [image.data]);\n        }\n    );\n};"],{type:"text/javascript"})),e.workerURL)},e}();i.getViewer=a;var f=function(){function e(){}return e.encode=function(t){for(var i,n=new Uint8Array(t),r=n.byteLength,a=r%3,o=r-a,s=e.table,l=new Uint8Array(o/3*4+(a?4:0)),c=-1,d=0;o>d;d+=3)i=n[d]<<16|n[d+1]<<8|n[d+2],l[++c]=s[(16515072&i)>>18],l[++c]=s[(258048&i)>>12],l[++c]=s[(4032&i)>>6],l[++c]=s[63&i];return 1===a?(i=n[o],l[++c]=s[(252&i)>>2],l[++c]=s[(3&i)<<4],l[++c]=61,l[++c]=61):2===a&&(i=n[o]<<8|n[o+1],l[++c]=s[(64512&i)>>10],l[++c]=s[(1008&i)>>4],l[++c]=s[(15&i)<<2],l[++c]=61),l.buffer},e}();f.table=new Uint8Array([65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47])},{"./crc32":4}],13:[function(e,t,i){"use strict";var n=e("./crc32"),r="zipper",a="file",o=function(){function e(){this.id=Date.now().toString()+Math.random().toString().substring(2),this.fileInfos=[]}return e.prototype.init=function(e,t){var i=this,n=indexedDB.open(r,2);n.onupgradeneeded=function(e){var t=n.result;if(t instanceof IDBDatabase){try{t.deleteObjectStore(a)}catch(e){}return void t.createObjectStore(a)}throw new Error("req.result is not IDBDatabase")},n.onerror=function(e){return t(e)},n.onsuccess=function(t){var r=n.result;if(r instanceof IDBDatabase)return i.db=r,i.gc(function(e){}),void e();throw new Error("req.result is not IDBDatabase")}},e.prototype.dispose=function(e){this.db.onerror=e;var t=this.db.transaction(a,"readwrite");t.onerror=e;var i=t.objectStore(a);this.remove(i,this.id,e),this.gc(function(e){})},e.prototype.gc=function(e){var t=this;if(this.db){this.db.onerror=e;var i=this.db.transaction(a,"readwrite");i.onerror=e;var n=i.objectStore(a),r=n.openCursor(IDBKeyRange.bound("meta_","meta`",!1,!0)),o=(new Date).getTime()-6e4;r.onsuccess=function(i){var a=r.result;if(a&&a instanceof IDBCursorWithValue){if(a.value.lastMod.getTime()<o){var s=a.key;"string"==typeof s&&t.remove(n,s.split("_")[1],e)}return void a["continue"]()}},r.onerror=e}},e.gc=function(){(new e).init(function(){},function(e){})},e.prototype.remove=function(e,t,i){if(this.db){var n=e["delete"](IDBKeyRange.bound("body_"+t+"_","body_"+t+"`",!1,!0));n.onsuccess=function(i){e["delete"]("meta_"+t)}}},e.prototype.add=function(e,t,i,n){this.addCore(e,t,!1,i,n)},e.prototype.addCompress=function(e,t,i,n){this.addCore(e,t,!0,i,n)},e.prototype.addCore=function(e,t,i,n,r){var o=this;if(this.db){var l=this.fileInfos.length,c=new s(e,t,i,function(e){o.db.onerror=r;var t=o.db.transaction(a,"readwrite");t.onerror=r;var i=t.objectStore(a);i.put({lastMod:new Date},"meta_"+o.id);var s=i.put(new Blob([e],{type:"application/octet-binary"}),"body_"+o.id+"_"+l);s.onsuccess=function(e){return n()},s.onerror=r},r);this.fileInfos.push(c)}},e.prototype.generate=function(e,t){var i=this;if(!this.db)throw new Error("Zipper is already disposed");this.db.onerror=t;var n=this.db.transaction(a,"readwrite");n.onerror=t;var r=n.objectStore(a);r.put({lastMod:new Date},"meta_"+this.id),this.receiveFiles(function(t){var n=l.endOfCentralDirectorySize;i.fileInfos.forEach(function(e){n+=e.localFileHeaderSize+e.compressedFileSize+e.centralDirectoryRecordSize}),e(n>4294967295||i.fileInfos.length>65535?i.makeZIP64(t):i.makeZIP(t))},t)},e.prototype.receiveFiles=function(e,t){var i=this,n=this.fileInfos.length,r=new Array(this.fileInfos.length);this.db.onerror=t;var o=this.db.transaction(a,"readonly");o.onerror=t;var s=o.objectStore(a);this.fileInfos.forEach(function(a,o){var l=s.get("body_"+i.id+"_"+o);l.onsuccess=function(t){var i=l.result;i instanceof Blob&&(r[o]=i,--n||e(r))},l.onerror=t})},e.prototype.makeZIP=function(e){var t=[];this.fileInfos.forEach(function(i,n){t.push(i.toLocalFileHeader(),e[n])});var i=0,n=0;return this.fileInfos.forEach(function(e){t.push(e.toCentralDirectoryRecord(i)),i+=e.compressedFileSize+e.localFileHeaderSize,n+=e.centralDirectoryRecordSize}),t.push(l.buildEndOfCentralDirectory(this.fileInfos.length,n,i)),new Blob(t,{type:"application/zip"})},e.prototype.makeZIP64=function(e){var t=[],i=0;this.fileInfos.forEach(function(n,r){t.push(n.toLocalFileHeader64(i),e[r]),i+=n.compressedFileSize+n.localFileHeaderSize64}),i=0;var n=0;return this.fileInfos.forEach(function(e){t.push(e.toCentralDirectoryRecord64(i)),i+=e.compressedFileSize+e.localFileHeaderSize64,n+=e.centralDirectoryRecordSize64}),t.push(c.buildEndOfCentralDirectory(this.fileInfos.length,n,i)),new Blob(t,{type:"application/zip"})},e}();i.Zipper=o;var s=function(){function e(e,t,i,r,a){var o=this;this.date=new Date;var s=2;this.size=t.size,this.compressedSize=t.size,i?(this.compressionMethod=8,++s):this.compressionMethod=0;var c,d=new FileReader;d.onload=function(e){var t=d.result;if(t instanceof ArrayBuffer){if(c=t,o.crc=n.crc32(t),!--s)return void r(c);i&&l.deflate(t,function(e){c=e,o.compressedSize=e.byteLength,--s||r(c)})}},d.onerror=function(e){return a(d.error)},d.readAsArrayBuffer(t);var h=new FileReader;h.onload=function(e){var t=h.result;t instanceof ArrayBuffer&&(o.name=t,--s||r(c))},h.onerror=function(e){return a(h.error)},h.readAsArrayBuffer(new Blob([e]))}return Object.defineProperty(e.prototype,"fileSize",{get:function(){return this.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"compressedFileSize",{get:function(){return this.compressedSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localFileHeaderSize",{get:function(){return l.calcLocalFileHeaderSize(this.name)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localFileHeaderSize64",{get:function(){return c.calcLocalFileHeaderSize(this.name)},enumerable:!0,configurable:!0}),e.prototype.toLocalFileHeader=function(){return l.buildLocalFileHeader(this.name,this.crc,this.date,this.compressionMethod,this.size,this.compressedSize)},e.prototype.toLocalFileHeader64=function(e){return c.buildLocalFileHeader(this.name,this.crc,this.date,this.compressionMethod,this.size,this.compressedSize,e)},Object.defineProperty(e.prototype,"centralDirectoryRecordSize",{get:function(){return l.calcCentralDirectoryRecordSize(this.name)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"centralDirectoryRecordSize64",{get:function(){return c.calcCentralDirectoryRecordSize(this.name)},enumerable:!0,configurable:!0}),e.prototype.toCentralDirectoryRecord=function(e){return l.buildCentralDirectoryRecord(this.name,this.crc,this.date,this.compressionMethod,this.size,this.compressedSize,e)},e.prototype.toCentralDirectoryRecord64=function(e){return c.buildCentralDirectoryRecord(this.name,this.crc,this.date,this.compressionMethod,this.size,this.compressedSize,e)},e}(),l=function(){function e(){}return e.calcLocalFileHeaderSize=function(e){return 30+e.byteLength+9+e.byteLength},e.buildLocalFileHeader=function(t,i,r,a,o,s){var l=e.formatDate(r),c=new ArrayBuffer(30),d=new ArrayBuffer(9),h=new DataView(c);return h.setUint32(0,67324752,!0),h.setUint16(4,10,!0),h.setUint16(6,2048,!0),h.setUint16(8,a,!0),h.setUint16(10,65535&l,!0),h.setUint16(12,l>>>16&65535,!0),h.setUint32(14,i,!0),h.setUint32(18,s,!0),h.setUint32(22,o,!0),h.setUint16(26,t.byteLength,!0),h.setUint16(28,d.byteLength+t.byteLength,!0),h=new DataView(d),h.setUint16(0,28789,!0),h.setUint16(2,5+t.byteLength,!0),h.setUint8(4,1),h.setUint32(5,n.crc32(t),!0),new Blob([c,t,d,t])},e.calcCentralDirectoryRecordSize=function(e){return 46+e.byteLength+9+e.byteLength},e.buildCentralDirectoryRecord=function(t,i,r,a,o,s,l){var c=e.formatDate(r),d=new ArrayBuffer(46),h=new ArrayBuffer(9),u=new DataView(d);return u.setUint32(0,33639248,!0),u.setUint16(4,20,!0),u.setUint16(6,10,!0),u.setUint16(8,2048,!0),u.setUint16(10,a,!0),u.setUint16(12,65535&c,!0),u.setUint16(14,c>>>16&65535,!0),u.setUint32(16,i,!0),u.setUint32(20,s,!0),u.setUint32(24,o,!0),u.setUint16(28,t.byteLength,!0),u.setUint16(30,h.byteLength+t.byteLength,!0),u.setUint16(32,0,!0),u.setUint16(34,0,!0),u.setUint16(36,0,!0),u.setUint32(38,0,!0),u.setUint32(42,l,!0),u=new DataView(h),u.setUint16(0,28789,!0),u.setUint16(2,5+t.byteLength,!0),u.setUint8(4,1),u.setUint32(5,n.crc32(t),!0),new Blob([d,t,h,t])},e.formatDate=function(e){e||(e=new Date);var t=e.getFullYear()-1980<<9|e.getMonth()+1<<5|e.getDate(),i=e.getHours()<<11|e.getMinutes()<<5|e.getSeconds()/2;return t<<16|i},Object.defineProperty(e,"endOfCentralDirectorySize",{get:function(){return 22},enumerable:!0,configurable:!0}),e.buildEndOfCentralDirectory=function(e,t,i){var n=new ArrayBuffer(22),r=new DataView(n);return r.setUint32(0,101010256,!0),r.setUint16(4,0,!0),r.setUint16(6,0,!0),r.setUint16(8,e,!0),r.setUint16(10,e,!0),r.setUint32(12,t,!0),r.setUint32(16,i,!0),r.setUint16(20,0,!0),new Blob([n])},e.deflate=function(t,i){e.worker||(e.worker=new Worker(e.createWorkerURL()),e.worker.onmessage=function(t){var i=e.compressQueue.shift();i&&i(t.data)}),e.compressQueue.push(i),e.worker.postMessage(t,[t])},e.createWorkerURL=function(){return e.workerURL?e.workerURL:(e.workerURL=URL.createObjectURL(new Blob(["\n'use strict';\nimportScripts('https://cdnjs.cloudflare.com/ajax/libs/pako/1.0.3/pako_deflate.min.js');\nonmessage = function(e){\n   var b = pako.deflateRaw(e.data).buffer;\n   postMessage(b, [b]);\n}\n"],{type:"text/javascript"})),e.workerURL)},e}();l.compressQueue=[];var c=function(){function e(){}return e.calcLocalFileHeaderSize=function(e){return 30+e.byteLength+32+9+e.byteLength},e.buildLocalFileHeader=function(t,i,r,a,o,s,l){var c=e.formatDate(r),d=new ArrayBuffer(30),h=new ArrayBuffer(32),u=new ArrayBuffer(9),f=new DataView(d);return f.setUint32(0,67324752,!0),f.setUint16(4,45,!0),f.setUint16(6,2048,!0),f.setUint16(8,a,!0),f.setUint16(10,65535&c,!0),f.setUint16(12,c>>>16&65535,!0),f.setUint32(14,i,!0),f.setUint32(18,4294967295,!0),f.setUint32(22,4294967295,!0),f.setUint16(26,t.byteLength,!0),f.setUint16(28,h.byteLength+u.byteLength+t.byteLength,!0),f=new DataView(h),f.setUint16(0,1,!0),f.setUint16(2,28,!0),e.setUint64(f,4,o),e.setUint64(f,12,s),e.setUint64(f,20,l),f.setUint32(28,0),f=new DataView(u),f.setUint16(0,28789,!0),f.setUint16(2,5+t.byteLength,!0),f.setUint8(4,1),f.setUint32(5,n.crc32(t),!0),new Blob([d,t,h,u,t])},e.calcCentralDirectoryRecordSize=function(e){return 46+e.byteLength+32+9+e.byteLength},e.buildCentralDirectoryRecord=function(t,i,r,a,o,s,l){var c=e.formatDate(r),d=new ArrayBuffer(46),h=new ArrayBuffer(32),u=new ArrayBuffer(9),f=new DataView(d);return f.setUint32(0,33639248,!0),f.setUint16(4,45,!0),f.setUint16(6,45,!0),f.setUint16(8,2048,!0),f.setUint16(10,a,!0),f.setUint16(12,65535&c,!0),f.setUint16(14,c>>>16&65535,!0),f.setUint32(16,i,!0),f.setUint32(20,4294967295,!0),f.setUint32(24,4294967295,!0),f.setUint16(28,t.byteLength,!0),f.setUint16(30,h.byteLength+u.byteLength+t.byteLength,!0),f.setUint16(32,0,!0),f.setUint16(34,65535,!0),f.setUint16(36,0,!0),f.setUint32(38,0,!0),f.setUint32(42,4294967295,!0),f=new DataView(h),f.setUint16(0,1,!0),f.setUint16(2,28,!0),e.setUint64(f,4,o),e.setUint64(f,12,s),e.setUint64(f,20,l),f.setUint32(28,0),f=new DataView(u),f.setUint16(0,28789,!0),f.setUint16(2,5+t.byteLength,!0),f.setUint8(4,1),f.setUint32(5,n.crc32(t),!0),new Blob([d,t,h,u,t])},e.formatDate=function(e){e||(e=new Date);var t=e.getFullYear()-1980<<9|e.getMonth()+1<<5|e.getDate(),i=e.getHours()<<11|e.getMinutes()<<5|e.getSeconds()/2;return t<<16|i},Object.defineProperty(e,"endOfCentralDirectorySize",{get:function(){return 98},enumerable:!0,configurable:!0}),e.buildEndOfCentralDirectory=function(t,i,n){var r=new ArrayBuffer(22),a=new ArrayBuffer(56),o=new ArrayBuffer(20),s=new DataView(a);return s.setUint32(0,101075792,!0),e.setUint64(s,4,a.byteLength+o.byteLength+r.byteLength-12),s.setUint16(12,45,!0),s.setUint16(14,45,!0),s.setUint32(16,0,!0),s.setUint32(20,0,!0),e.setUint64(s,24,t),e.setUint64(s,32,t),e.setUint64(s,40,i),e.setUint64(s,48,n),s=new DataView(o),s.setUint32(0,117853008,!0),s.setUint32(4,0,!0),e.setUint64(s,8,n+i),s.setUint32(16,1,!0),s=new DataView(r),s.setUint32(0,101010256,!0),s.setUint16(4,65535,!0),s.setUint16(6,65535,!0),s.setUint16(8,65535,!0),s.setUint16(10,65535,!0),s.setUint32(12,4294967295,!0),s.setUint32(16,4294967295,!0),s.setUint16(20,0,!0),new Blob([a,o,r])},e.setUint64=function(e,t,i){e.setUint32(t,4294967295&i,!0),e.setUint32(t+4,Math.floor(i/4294967296),!0)},e}();o.gc()},{"./crc32":4}]},{},[9]);

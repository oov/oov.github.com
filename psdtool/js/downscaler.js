!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.DownScaler=t()}}(function(){return function t(e,r,n){function a(i,o){if(!r[i]){if(!e[i]){var d="function"==typeof require&&require;if(!o&&d)return d(i,!0);if(f)return f(i,!0);var u=new Error("Cannot find module '"+i+"'");throw u.code="MODULE_NOT_FOUND",u}var h=r[i]={exports:{}};e[i][0].call(h.exports,function(t){var r=e[i][1][t];return a(r?r:t)},h,h.exports,t,e,r,n)}return r[i].exports}for(var f="function"==typeof require&&require,i=0;i<n.length;i++)a(n[i]);return a}({1:[function(t,e,r){"use strict";function n(t,e){var r=t>>>16&65535,n=65535&t,a=e>>>16&65535,f=65535&e;return n*f+(r*f+n*a<<16>>>0)|0}function a(t,e){if(0===t)return e;for(;0!==e;)t>e?t-=e:e-=t;return t}function f(t,e){return w(t,e)/a(t,e)}function i(t,e){for(var r=new Uint8Array(t.data.buffer,t.data.byteOffset,t.data.byteLength),n=new Uint8Array(e.data.buffer,e.data.byteOffset,e.data.byteLength),a=t.width,i=e.width,o=0|f(a,i),d=o/a|0,u=o/i|0,h=new Int32Array(i+1),y=new Int32Array(i+1),b=0;i>=b;++b)y[b]=w(u,b+1)%d,h[b]=w(u,b)/d|0;for(var s=e.height,v=t.width<<2,c=e.width<<2,l=0;s>l;++l)for(var g=w(l,c),p=w(l,v),A=0,U=0;i>A;++A){var L=h[A],O=h[A+1],m=d-U;U=y[A];var x=0,q=0,I=0,M=0,C=0;0!==m&&(C=w(r[p+3],m),q+=w(r[p+0],C),I+=w(r[p+1],C),M+=w(r[p+2],C),x+=C,p+=4);for(var b=L+1;O>b;++b)C=w(r[p+3],d),q+=w(r[p+0],C),I+=w(r[p+1],C),M+=w(r[p+2],C),x+=C,p+=4;0!==U&&(C=w(r[p+3],U),q+=w(r[p+0],C),I+=w(r[p+1],C),M+=w(r[p+2],C),x+=C),0===x?(n[g+0]=0,n[g+1]=0,n[g+2]=0,n[g+3]=0):(n[g+0]=q/x|0,n[g+1]=I/x|0,n[g+2]=M/x|0,n[g+3]=x/u|0),g+=4}}function o(t,e){for(var r=new Uint8Array(t.data.buffer,t.data.byteOffset,t.data.byteLength),n=new Uint8Array(e.data.buffer,e.data.byteOffset,e.data.byteLength),a=t.height,i=e.height,o=f(a,i),d=o/a|0,u=o/i|0,h=new Int32Array(i+1),y=new Int32Array(i+1),b=0;i>=b;++b)y[b]=w(u,b+1)%d,h[b]=w(u,b)/d|0;for(var s=t.width<<2,v=e.width<<2,c=0;v>c;c+=4)for(var l=c,g=c,p=0,A=0;i>p;++p){var U=h[p],L=h[p+1],O=d-A;A=y[p];var m=0,x=0,q=0,I=0,M=0;0!==O&&(M=w(r[g+3],O),x+=w(r[g+0],M),q+=w(r[g+1],M),I+=w(r[g+2],M),m+=M,g+=s);for(var b=U+1;L>b;++b)M=w(r[g+3],d),x+=w(r[g+0],M),q+=w(r[g+1],M),I+=w(r[g+2],M),m+=M,g+=s;0!==A&&(M=w(r[g+3],A),x+=w(r[g+0],M),q+=w(r[g+1],M),I+=w(r[g+2],M),m+=M),0===m?(n[l+0]=0,n[l+1]=0,n[l+2]=0,n[l+3]=0):(n[l+0]=x/m|0,n[l+1]=q/m|0,n[l+2]=I/m|0,n[l+3]=m/u|0),l+=v}}function d(t){for(var e=new Uint8ClampedArray(256),r=0;256>r;++r)e[r]=255*Math.pow(r/255,t);return new Uint8Array(e.buffer,0,256)}function u(t,e){for(var r=d(e),n=new Uint8Array(t.data.buffer,t.data.byteOffset,t.data.byteLength),a=t.data.byteLength,f=0;a>f;f+=4)n[f+0]=r[n[f+0]],n[f+1]=r[n[f+1]],n[f+2]=r[n[f+2]]}function h(t,e,r){if(t.width<e.width||t.height<e.height)throw new Error("upscale is not supported");if(void 0!==r&&u(t,r),t.height!==e.height)if(t.width!==e.width){var n={width:e.width,height:t.height,data:new Uint8ClampedArray(w(e.width<<2,t.height))};i(t,n),o(n,e)}else o(t,e);else if(t.width!==e.width)i(t,e);else for(var a=new Uint8Array(t.data.buffer,t.data.byteOffset,t.data.byteLength),f=new Uint8Array(e.data.buffer,e.data.byteOffset,e.data.byteLength),d=t.data.byteLength,h=0;d>h;++h)f[h]=a[h];void 0!==r&&u(e,1/r)}var w=Math.imul?Math.imul:n;r.scale=h},{}]},{},[1])(1)});
